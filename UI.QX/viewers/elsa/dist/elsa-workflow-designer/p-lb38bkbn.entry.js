import{r as registerInstance,c as createEvent,h,g as getElement,H as Host}from"./p-5341f061.js";var ActivityDisplayMode;!function(t){t.Design="Design",t.Edit="Edit"}(ActivityDisplayMode||(ActivityDisplayMode={}));class ActivityEditor{constructor(t){registerInstance(this,t),this.activityDefinitions=[],this.submit=createEvent(this,"update-activity",7)}async onSubmit(t){t.preventDefault();const e=new FormData(t.target),i=await this.renderer.updateEditor(e);this.submit.emit(i),this.show=!1}componentDidRender(){$(this.el.querySelector(".modal")).modal(this.show?"show":"hide")}render(){const t=this.activity;if(!t)return null;const e=this.activityDefinitions.find(e=>e.type==t.type);if(e)return h("div",null,h("div",{class:"modal",tabindex:"-1",role:"dialog"},h("div",{class:"modal-dialog modal-xl",role:"document"},h("div",{class:"modal-content"},h("form",{onSubmit:t=>this.onSubmit(t)},h("div",{class:"modal-header"},h("h5",{class:"modal-title"},"Edit ",e.displayName),h("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},h("span",{"aria-hidden":"true"},"×"))),h("div",{class:"modal-body"},h("wf-activity-renderer",{activity:t,activityDefinition:e,displayMode:ActivityDisplayMode.Edit,ref:t=>this.renderer=t})),h("div",{class:"modal-footer"},h("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancel"),h("button",{type:"submit",class:"btn btn-primary"},"Save")))))));console.error(`No activity of type ${this.activity.type} exists in the library.`)}get el(){return getElement(this)}static get style(){return""}}class ActivityPicker{constructor(t){registerInstance(this,t),this.activityDefinitions=[],this.filterText="",this.selectedCategory=null,this.onFilterTextChanged=t=>{this.filterText=t.target.value},this.selectCategory=t=>{this.selectedCategory=t},this.renderActivity=t=>h("div",{class:"card activity"},h("div",{class:"card-body"},h("h4",{class:"card-title"},h("i",{class:`${t.icon||"fas fa-cog"} mr-1`}),t.displayName),h("p",null,t.description),h("a",{href:"#",onClick:e=>{e.preventDefault(),this.selectCategory(t.category)}},h("span",{class:"badge badge-light"},t.category))),h("div",{class:"card-footer text-muted text-xs-right"},h("a",{class:"btn btn-primary btn-sm",href:"#",onClick:async e=>{e.preventDefault(),await this.onActivitySelected(t)}},"Select"))),this.activitySelected=createEvent(this,"activity-picked",7)}async show(){this.isVisible=!0,$(this.modal).modal("show")}async hide(){$(this.modal).modal("hide"),this.isVisible=!1}async onActivitySelected(t){this.activitySelected.emit(t),await this.hide()}render(){const t=this.activityDefinitions,e=[null,...new Set(t.map(t=>t.category))],i=this.filterText,n=this.selectedCategory;let s=t;return n&&(s=s.filter(t=>t.category.toLowerCase()===n.toLowerCase())),i&&(s=s.filter(t=>t.displayName.toLowerCase().includes(i.toLowerCase()))),h("div",null,h("div",{class:"modal",tabindex:"-1",role:"dialog",ref:t=>this.modal=t},h("div",{class:"modal-dialog modal-xl",role:"document"},h("div",{class:"modal-content"},h("div",{class:"modal-header"},h("h5",{class:"modal-title"},"Available Activities"),h("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},h("span",{"aria-hidden":"true"},"×"))),h("div",{class:"modal-body"},h("div",{class:"row"},h("div",{class:"col-sm-3 col-md-3 col-lg-2"},h("div",{class:"form-group"},h("input",{class:"form-control",type:"search",placeholder:"Filter","aria-label":"Filter",autofocus:!0,onKeyUp:this.onFilterTextChanged})),h("ul",{class:"nav nav-pills flex-column activity-picker-categories"},e.map(t=>h("li",{class:"nav-item"},h("a",{class:{"nav-link":!0,active:t===this.selectedCategory},href:"#","data-toggle":"pill",onClick:e=>{e.preventDefault(),this.selectCategory(t)}},t||"All"))))),h("div",{class:"col-sm-9 col-md-9 col-lg-10"},h("div",{class:"card-columns tab-content"},s.map(this.renderActivity))))),h("div",{class:"modal-footer"},h("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancel"))))))}get el(){return getElement(this)}static get style(){return""}}class FormUpdater{static updateEditor(t,e){const i=Object.assign({},t.state);return e.forEach((t,e)=>{i[e]=t}),Object.assign({},t,{state:i})}}class DefaultActivityHandler{constructor(){this.renderDesigner=(activity,definition)=>{let description=null;description=activity.state.description?activity.state.description:definition.runtimeDescription?definition.runtimeDescription:definition.description;try{const fun=eval(description);description=fun({activity,definition,state:activity.state})}catch(t){}return{title:activity.state.title||definition.displayName,description,icon:definition.icon||"fas fa-cog"}},this.updateEditor=(t,e)=>FormUpdater.updateEditor(t,e),this.getOutcomes=(activity,definition)=>{let outcomes=[];if(definition){const lambda=definition.outcomes;if(lambda instanceof Array)outcomes=lambda;else{const value=eval(lambda);if(value instanceof Array)outcomes=value;else if(value instanceof Function)try{outcomes=value({activity,definition,state:activity.state})}catch(t){console.warn(t),outcomes=[]}}}return outcomes||[]}}}class ActivityManager{constructor(){this.addHandler=(t,e)=>{this.handlers[t]=Object.assign({},e)},this.renderDesigner=(t,e)=>{const i=this.getHandler(t.type);return i.renderDesigner?i.renderDesigner(t,e):{title:t.state.title||e.displayName,description:t.state.description||e.description,icon:e.icon||"fas fa-cog"}},this.updateEditor=(t,e)=>(this.getHandler(t.type).updateEditor||FormUpdater.updateEditor)(t,e),this.getOutcomes=(t,e)=>{const i=this.getHandler(t.type);return i.getOutcomes?i.getOutcomes(t,e):[]},this.getHandler=t=>this.handlers[t]||new DefaultActivityHandler,this.handlers={}}}const ActivityManager$1=new ActivityManager;class DisplayManager{constructor(){this.addDriver=(t,e)=>{this.drivers[t]=Object.assign({},e)},this.displayEditor=(t,e)=>{const i=this.drivers[e.type];return i?i.displayEditor(t,e):null},this.updateEditor=(t,e,i)=>{const n=this.drivers[e.type];n&&n.updateEditor(t,e,i)},this.drivers={}}}const DisplayManager$1=new DisplayManager;class ActivityRenderer{constructor(t){registerInstance(this,t),this.displayMode=ActivityDisplayMode.Design}render(){if(!this.activity||!this.activityDefinition)return null;switch(this.displayMode){case ActivityDisplayMode.Design:return this.renderDesigner();case ActivityDisplayMode.Edit:return this.renderEditor()}}renderDesigner(){const t=ActivityManager$1.renderDesigner(this.activity,this.activityDefinition);return h("div",null,h("h5",null,h("i",{class:`${t.icon} mr-1`}),t.title),h("p",{innerHTML:t.description}))}renderEditor(){const t=this.activity;return h(Host,null,this.activityDefinition.properties.map(e=>{const i=DisplayManager$1.displayEditor(t,e);return h("div",{class:"form-group",innerHTML:i})}))}async updateEditor(t){const e=Object.assign({},this.activity),i=this.activityDefinition.properties;for(const n of i)DisplayManager$1.updateEditor(e,n,t);return e}static get style(){return""}}class ContextMenu{constructor(t){registerInstance(this,t),this.isHidden=!0,this.position={left:0,top:0},this.onContextMenu=t=>{t.defaultPrevented||(t.preventDefault(),this.contextMenuEvent.emit(),this.position={left:t.pageX,top:t.pageY},this.isHidden=!1)},this.onContextMenuClick=()=>{this.isHidden=!0},this.contextMenuEvent=createEvent(this,"context-menu",7)}targetChangeHandler(t,e){e&&e.removeEventListener("contextmenu",this.onContextMenu),this.setupTarget(t)}targetSelectorChangeHandler(t){this.target=document.querySelector(t)}handleBodyClick(){this.isHidden=!0}handleContextMenu(){this.isHidden=!0}async handleContextMenuEvent(t){this.onContextMenu(t)}componentDidLoad(){this.setupTarget(this.target)}render(){return h(Host,{class:"dropdown-menu context-menu canvas-context-menu position-fixed",style:{left:`${this.position.left}px`,top:`${this.position.top}px`,display:this.isHidden?"none":"block"},onClick:this.onContextMenuClick},h("slot",null))}setupTarget(t){t&&t.addEventListener("contextmenu",this.onContextMenu,{capture:!1})}get el(){return getElement(this)}static get watchers(){return{target:["targetChangeHandler"],targetSelector:["targetSelectorChangeHandler"]}}static get style(){return""}}class ContextMenuItem{constructor(t){registerInstance(this,t)}render(){return h("a",{class:"dropdown-item",href:"#",onClick:t=>t.preventDefault()},this.text)}get el(){return getElement(this)}static get style(){return""}}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var jsplumb=createCommonjsModule(function(t,e){(function(){void 0===Math.sgn&&(Math.sgn=function(t){return 0==t?0:t>0?1:-1});var t=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},i=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},n=Math.pow(2,-65),s=function(e,n){for(var s=[],a=o(e,n),h=n.length-1,l=r(a,2*h-1,s,0),u=t(e,n[0]),f=i(u),p=0,m=0;m<l;m++){u=t(e,c(n,h,s[m],null,null));var d=i(u);d<f&&(f=d,p=s[m])}return u=t(e,n[h]),(d=i(u))<f&&(f=d,p=1),{location:p,distance:f}},o=function(e,i){for(var n=i.length-1,s=2*n-1,o=[],r=[],a=[],h=[],l=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],c=0;c<=n;c++)o[c]=t(i[c],e);for(c=0;c<=n-1;c++)r[c]=t(i[c+1],i[c]),r[c]={x:(u=r[c]).x*(f=3),y:u.y*f};for(var u,f,p,m,d=0;d<=n-1;d++)for(var y=0;y<=n;y++)a[d]||(a[d]=[]),a[d][y]=(p=r[d]).x*(m=o[y]).x+p.y*m.y;for(c=0;c<=s;c++)h[c]||(h[c]=[]),h[c].y=0,h[c].x=parseFloat(c)/s;for(var v=n,b=n-1,x=0;x<=v+b;x++){var g=Math.max(0,x-b),T=Math.min(x,v);for(c=g;c<=T;c++){var w=x-c;h[c+w].y+=a[w][c]*l[w][c]}}return h},r=function(t,e,i,n){var s,o,u=[],f=[],p=[],m=[];switch(a(t,e)){case 0:return 0;case 1:if(n>=64)return i[0]=(t[0].x+t[e].x)/2,1;if(h(t,e))return i[0]=l(t,e),1}c(t,e,.5,u,f),s=r(u,e,p,n+1),o=r(f,e,m,n+1);for(var d=0;d<s;d++)i[d]=p[d];for(d=0;d<o;d++)i[d+s]=m[d];return s+o},a=function(t,e){var i,n,s=0;i=n=Math.sgn(t[0].y);for(var o=1;o<=e;o++)(i=Math.sgn(t[o].y))!=n&&s++,n=i;return s},h=function(t,e){var i,s,o,r,a,h,l,c,u;r=t[0].y-t[e].y,a=t[e].x-t[0].x,h=t[0].x*t[e].y-t[e].x*t[0].y,c=u=0;for(var f=1;f<e;f++){var p=r*t[f].x+a*t[f].y+h;p>c?c=p:p<u&&(u=p)}return i=(1*(h-c)-0*(l=a))*(1/(0*l-1*r)),s=(1*(h-u)-0*(l=a))*(1/(0*l-1*r)),o=Math.min(i,s),Math.max(i,s)-o<n?1:0},l=function(t,e){var i=t[e].x-t[0].x,n=t[e].y-t[0].y;return 0+1/(0*i-1*n)*(i*(t[0].y-0)-n*(t[0].x-0))*1},c=function(t,e,i,n,s){for(var o=[[]],r=0;r<=e;r++)o[0][r]=t[r];for(var a=1;a<=e;a++)for(r=0;r<=e-a;r++)o[a]||(o[a]=[]),o[a][r]||(o[a][r]={}),o[a][r].x=(1-i)*o[a-1][r].x+i*o[a-1][r+1].x,o[a][r].y=(1-i)*o[a-1][r].y+i*o[a-1][r+1].y;if(null!=n)for(r=0;r<=e;r++)n[r]=o[r][0];if(null!=s)for(r=0;r<=e;r++)s[r]=o[e-r][r];return o[e][0]},u={},f=function(t,e){for(var i=function(t){var e=u[t];if(!e){var i=function(t){return function(){return t}},n=function(){return function(t){return t}},s=function(){return function(t){return 1-t}},o=function(t){return function(e){for(var i=1,n=0;n<t.length;n++)i*=t[n](e);return i}};(e=[]).push(new function(){return function(e){return Math.pow(e,t)}});for(var r=1;r<t;r++){for(var a=[new i(t)],h=0;h<t-r;h++)a.push(new n);for(h=0;h<r;h++)a.push(new s);e.push(new o(a))}e.push(new function(){return function(e){return Math.pow(1-e,t)}}),u[t]=e}return e}(t.length-1),n=0,s=0,o=0;o<t.length;o++)n+=t[o].x*i[o](e),s+=t[o].y*i[o](e);return{x:n,y:s}},p=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},m=function(t){return t[0].x===t[1].x&&t[0].y===t[1].y},d=function(t,e,i){if(m(t))return{point:t[0],location:e};for(var n=f(t,e),s=0,o=e,r=i>0?1:-1,a=null;s<Math.abs(i);)a=f(t,o+=.005*r),s+=p(a,n),n=a;return{point:a,location:o}},y=function(t,e){var i=f(t,e),n=f(t.slice(0,t.length-1),e),s=n.y-i.y;return 0===s?1/0:Math.atan(s/(n.x-i.x))},v=function(t,e,i,n,s){var o=n-e,r=t-i,a=t*(e-n)+e*(i-t),h=function(t){return[b(t,"x"),b(t,"y")]}(s),l=function(t,e,i,n){var s,o,r=e/t,a=i/t,h=n/t,l=(3*a-Math.pow(r,2))/9,c=(9*r*a-27*h-2*Math.pow(r,3))/54,u=Math.pow(l,3)+Math.pow(c,2),f=[];if(u>=0)s=x(c+Math.sqrt(u))*Math.pow(Math.abs(c+Math.sqrt(u)),1/3),o=x(c-Math.sqrt(u))*Math.pow(Math.abs(c-Math.sqrt(u)),1/3),f[0]=-r/3+(s+o),f[1]=-r/3-(s+o)/2,f[2]=-r/3-(s+o)/2,0!==Math.abs(Math.sqrt(3)*(s-o)/2)&&(f[1]=-1,f[2]=-1);else{var p=Math.acos(c/Math.sqrt(-Math.pow(l,3)));f[0]=2*Math.sqrt(-l)*Math.cos(p/3)-r/3,f[1]=2*Math.sqrt(-l)*Math.cos((p+2*Math.PI)/3)-r/3,f[2]=2*Math.sqrt(-l)*Math.cos((p+4*Math.PI)/3)-r/3}for(var m=0;m<3;m++)(f[m]<0||f[m]>1)&&(f[m]=-1);return f}.apply(null,[o*h[0][0]+r*h[1][0],o*h[0][1]+r*h[1][1],o*h[0][2]+r*h[1][2],o*h[0][3]+r*h[1][3]+a]),c=[];if(null!=l)for(var u=0;u<3;u++){var f,p=l[u],m=Math.pow(p,2),d=Math.pow(p,3),y=[h[0][0]*d+h[0][1]*m+h[0][2]*p+h[0][3],h[1][0]*d+h[1][1]*m+h[1][2]*p+h[1][3]];f=i-t!=0?(y[0]-t)/(i-t):(y[1]-e)/(n-e),p>=0&&p<=1&&f>=0&&f<=1&&c.push(y)}return c};function b(t,e){return[3*t[1][e]-t[0][e]+-3*t[2][e]+t[3][e],3*t[0][e]-6*t[1][e]+3*t[2][e],-3*t[0][e]+3*t[1][e],t[0][e]]}function x(t){return t<0?-1:t>0?1:0}var g=this.jsBezier={distanceFromCurve:s,gradientAtPoint:y,gradientAtPointAlongCurveFrom:function(t,e,i){var n=d(t,e,i);return n.location>1&&(n.location=1),n.location<0&&(n.location=0),y(t,n.location)},nearestPointOnCurve:function(t,e){var i=s(t,e);return{point:c(e,e.length-1,i.location,null,null),location:i.location}},pointOnCurve:f,pointAlongCurveFrom:function(t,e,i){return d(t,e,i).point},perpendicularToCurveAt:function(t,e,i,n){var s=d(t,e,n=null==n?0:n),o=y(t,s.location),r=Math.atan(-1/o),a=i/2*Math.sin(r),h=i/2*Math.cos(r);return[{x:s.point.x+h,y:s.point.y+a},{x:s.point.x-h,y:s.point.y-a}]},locationAlongCurveFrom:function(t,e,i){return d(t,e,i).location},getLength:function(t){if(m(t))return 0;for(var e=f(t,0),i=0,n=0,s=null;n<1;)s=f(t,n+=.005),i+=p(s,e),e=s;return i},lineIntersection:v,boxIntersection:function(t,e,i,n,s){var o=[];return o.push.apply(o,v(t,e,t+i,e,s)),o.push.apply(o,v(t+i,e,t+i,e+n,s)),o.push.apply(o,v(t+i,e+n,t,e+n,s)),o.push.apply(o,v(t,e+n,t,e,s)),o},boundingBoxIntersection:function(t,e){var i=[];return i.push.apply(i,v(t.x,t.y,t.x+t.w,t.y,e)),i.push.apply(i,v(t.x+t.w,t.y,t.x+t.w,t.y+t.h,e)),i.push.apply(i,v(t.x+t.w,t.y+t.h,t.x,t.y+t.h,e)),i.push.apply(i,v(t.x,t.y+t.h,t.x,t.y,e)),i},version:"0.9.0"};e.jsBezier=g}).call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.Biltong={version:"0.4.0"};e.Biltong=t;var i=function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=function(t,e,n){return n(t=i(t)?t:[t.x,t.y],e=i(e)?e:[e.x,e.y])},s=t.gradient=function(t,e){return n(t,e,function(t,e){return e[0]==t[0]?e[1]>t[1]?1/0:-1/0:e[1]==t[1]?e[0]>t[0]?0:-0:(e[1]-t[1])/(e[0]-t[0])})},o=(t.normal=function(t,e){return-1/s(t,e)},t.lineLength=function(t,e){return n(t,e,function(t,e){return Math.sqrt(Math.pow(e[1]-t[1],2)+Math.pow(e[0]-t[0],2))})},t.quadrant=function(t,e){return n(t,e,function(t,e){return e[0]>t[0]?e[1]>t[1]?2:1:e[0]==t[0]?e[1]>t[1]?2:1:e[1]>t[1]?3:4})}),r=(t.theta=function(t,e){return n(t,e,function(t,e){var i=s(t,e),n=Math.atan(i),r=o(t,e);return 4!=r&&3!=r||(n+=Math.PI),n<0&&(n+=2*Math.PI),n})},t.intersects=function(t,e){var i=t.x,n=t.x+t.w,s=t.y,o=t.y+t.h,r=e.x,a=e.x+e.w,h=e.y,l=e.y+e.h;return i<=r&&r<=n&&s<=h&&h<=o||i<=a&&a<=n&&s<=h&&h<=o||i<=r&&r<=n&&s<=l&&l<=o||i<=a&&r<=n&&s<=l&&l<=o||r<=i&&i<=a&&h<=s&&s<=l||r<=n&&n<=a&&h<=s&&s<=l||r<=i&&i<=a&&h<=o&&o<=l||r<=n&&i<=a&&h<=o&&o<=l},t.encloses=function(t,e,i){var n=t.y,s=t.y+t.h,o=e.y,r=e.y+e.h,a=function(t,e,n,s){return i?t<=e&&n>=s:t<e&&n>s};return a(t.x,e.x,t.x+t.w,e.x+e.w)&&a(n,o,s,r)},[null,[1,-1],[1,1],[-1,1],[-1,-1]]),a=[null,[-1,-1],[-1,1],[1,1],[1,-1]];t.pointOnLine=function(t,e,i){var n=s(t,e),h=o(t,e),l=i>0?r[h]:a[h],c=Math.atan(n),u=Math.abs(i*Math.sin(c))*l[1],f=Math.abs(i*Math.cos(c))*l[0];return{x:t.x+f,y:t.y+u}},t.perpendicularLineTo=function(t,e,i){var n=s(t,e),o=Math.atan(-1/n),r=i/2*Math.sin(o),a=i/2*Math.cos(o);return[{x:e.x+a,y:e.y+r},{x:e.x-a,y:e.y-r}]}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=function(t,e,i){for(var n=(i=i||t.parentNode).querySelectorAll(e),s=0;s<n.length;s++)if(n[s]===t)return!0;return!1},i=function(t){return"string"==typeof t||t.constructor===String?document.getElementById(t):t},n=function(t){return t.srcElement||t.target},s=function(t,e,i,n){if(n){if(void 0!==t.path&&t.path.indexOf)return{path:t.path,end:t.path.indexOf(i)};var s={path:[],end:-1},o=function(t){s.path.push(t),t===i?s.end=s.path.length-1:null!=t.parentNode&&o(t.parentNode)};return o(e),s}return{path:[e],end:1}},o=function(t,e){for(var i=0,n=t.length;i<n&&t[i]!=e;i++);i<t.length&&t.splice(i,1)},r=1,a=function(t,e,i){var n=r++;return t.__ta=t.__ta||{},t.__ta[e]=t.__ta[e]||{},t.__ta[e][n]=i,i.__tauid=n,n},h=function(e,i,o,r){if(null==e)return o;var a=e.split(","),h=function(r){h.__tauid=o.__tauid;var l=n(r),c=l,u=s(r,l,i,null!=e);if(-1!=u.end)for(var f=0;f<u.end;f++){c=u.path[f];for(var p=0;p<a.length;p++)t(c,a[p],i)&&o.apply(c,arguments)}};return l(o,r,h),h},l=function(t,e,i){t.__taExtra=t.__taExtra||[],t.__taExtra.push([e,i])},c=function(t,e,i,n){if(d&&v[e]){var s=h(n,t,i,v[e]);N(t,v[e],s,i)}"focus"===e&&null==t.getAttribute("tabindex")&&t.setAttribute("tabindex","1"),N(t,e,h(n,t,i,e),i)},u={tap:{touches:1,taps:1},dbltap:{touches:1,taps:2},contextmenu:{touches:2,taps:1}},f=function(e,i){return function(r,a,h,l){if("contextmenu"==a&&y)c(r,a,h,l);else{if(null==r.__taTapHandler){var f=r.__taTapHandler={tap:[],dbltap:[],contextmenu:[],down:!1,taps:0,downSelectors:[]},p=function(){f.down=!1},m=function(){f.taps=0};c(r,"mousedown",function(o){for(var a=n(o),h=s(o,a,r,null!=l),c=!1,u=0;u<h.end;u++){if(c)return;a=h.path[u];for(var d=0;d<f.downSelectors.length;d++)if(null==f.downSelectors[d]||t(a,f.downSelectors[d],r)){f.down=!0,setTimeout(p,e),setTimeout(m,i),c=!0;break}}}),c(r,"mouseup",function(e){if(f.down){var i,o,a=n(e);f.taps++;var h=C(e);for(var l in u)if(u.hasOwnProperty(l)){var c=u[l];if(c.touches===h&&(1===c.taps||c.taps===f.taps))for(var p=0;p<f[l].length;p++){o=s(e,a,r,null!=f[l][p][1]);for(var m=0;m<o.end;m++)if(i=o.path[m],null==f[l][p][1]||t(i,f[l][p][1],r)){f[l][p][0].apply(i,[e]);break}}}}})}r.__taTapHandler.downSelectors.push(l),r.__taTapHandler[a].push([h,l]),h.__taUnstore=function(){o(r.__taTapHandler[a],h)}}}},p=function(t,e,i,n){for(var s in i.__tamee[t])i.__tamee[t].hasOwnProperty(s)&&i.__tamee[t][s].apply(n,[e])},m=function(){var e=[];return function(i,s,o,r){if(!i.__tamee){i.__tamee={over:!1,mouseenter:[],mouseexit:[]};var l=function(s){var o=n(s);(null==r&&o==i&&!i.__tamee.over||t(o,r,i)&&(null==o.__tamee||!o.__tamee.over))&&(p("mouseenter",s,i,o),o.__tamee=o.__tamee||{},o.__tamee.over=!0,e.push(o))},c=function(s){for(var o=n(s),r=0;r<e.length;r++)o!=e[r]||t(s.relatedTarget||s.toElement,"*",o)||(o.__tamee.over=!1,e.splice(r,1),p("mouseexit",s,i,o))};N(i,"mouseover",h(r,i,l,"mouseover"),l),N(i,"mouseout",h(r,i,c,"mouseout"),c)}o.__taUnstore=function(){delete i.__tamee[s][o.__tauid]},a(i,s,o),i.__tamee[s][o.__tauid]=o}},d="ontouchstart"in document.documentElement,y="onmousedown"in document.documentElement,v={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},b=function(){var t=-1;if("Microsoft Internet Explorer"==navigator.appName){var e=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(e)&&(t=parseFloat(RegExp.$1))}return t}(),x=b>-1&&b<9,g=function(t,e){if(null==t)return[0,0];var i=j(t),n=w(i,0);return[n[e+"X"],n[e+"Y"]]},T=function(t){return null==t?[0,0]:x?[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop]:g(t,"page")},w=function(t,e){return t.item?t.item(e):t[e]},j=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},C=function(t){return j(t).length},N=function(t,e,i,n){if(a(t,e,i),n.__tauid=i.__tauid,t.addEventListener)t.addEventListener(e,i,!1);else if(t.attachEvent){var s=e+i.__tauid;t["e"+s]=i,t[s]=function(){t["e"+s]&&t["e"+s](window.event)},t.attachEvent("on"+e,t[s])}},E=function(t,e,n){null!=n&&O(t,function(){var s=i(this);if(function(t,i,n){if(t.__ta&&t.__ta[e]&&delete t.__ta[e][n.__tauid],n.__taExtra){for(var s=0;s<n.__taExtra.length;s++)E(t,n.__taExtra[s][0],n.__taExtra[s][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}(s,0,n),null!=n.__tauid)if(s.removeEventListener)s.removeEventListener(e,n,!1),d&&v[e]&&s.removeEventListener(v[e],n,!1);else if(this.detachEvent){var o=e+n.__tauid;s[o]&&s.detachEvent("on"+e,s[o]),s[o]=null,s["e"+o]=null}n.__taTouchProxy&&E(t,n.__taTouchProxy[1],n.__taTouchProxy[0])})},O=function(t,e){if(null!=t){t="undefined"!=typeof Window&&"unknown"!=typeof t.top&&t==t.top?[t]:"string"!=typeof t&&null==t.tagName&&null!=t.length?t:"string"==typeof t?document.querySelectorAll(t):[t];for(var i=0;i<t.length;i++)e.apply(t[i])}},k=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})};this.Mottle=function(t){var e=(t=t||{}).clickThreshold||250,s=t.dblClickThreshold||450,r=new m,a=new f(e,s),h=t.smartClicks,l=function(t,e,s,l){null!=s&&O(t,function(){var t=i(this);h&&"click"===e?function(t,e,i,s){null==t.__taSmartClicks&&(c(t,"mousedown",function(e){t.__tad=T(e)},s),c(t,"mouseup",function(e){t.__tau=T(e)},s),c(t,"click",function(e){if(t.__tad&&t.__tau&&t.__tad[0]===t.__tau[0]&&t.__tad[1]===t.__tau[1])for(var i=0;i<t.__taSmartClicks.length;i++)t.__taSmartClicks[i].apply(n(e),[e])},s),t.__taSmartClicks=[]),t.__taSmartClicks.push(i),i.__taUnstore=function(){o(t.__taSmartClicks,i)}}(t,0,s,l):"tap"===e||"dbltap"===e||"contextmenu"===e?a(t,e,s,l):"mouseenter"===e||"mouseexit"==e?r(t,e,s,l):c(t,e,s,l)})};this.remove=function(t){return O(t,function(){var t=i(this);if(t.__ta)for(var e in t.__ta)if(t.__ta.hasOwnProperty(e))for(var n in t.__ta[e])t.__ta[e].hasOwnProperty(n)&&E(t,e,t.__ta[e][n]);t.parentNode&&t.parentNode.removeChild(t)}),this},this.on=function(t,e,i,n){var s=arguments[0],o=4==arguments.length?arguments[2]:null,r=arguments[1],a=arguments[arguments.length-1];return l(s,r,a,o),this},this.off=function(t,e,i){return E(t,e,i),this},this.trigger=function(t,e,n,s){var o=y&&("undefined"==typeof MouseEvent||null==n||n.constructor===MouseEvent),r=d&&!y&&v[e]?v[e]:e,a=!(d&&!y&&v[e]),h=T(n),l=g(n,"screen"),c=g(n,"client");return O(t,function(){var t,u=i(this);n=n||{screenX:l[0],screenY:l[1],clientX:c[0],clientY:c[1]};var f=function(t){s&&(t.payload=s)},p={TouchEvent:function(t){var e=function(t,e,i,n,s,o,r,a){return function(){var t=[];return Array.prototype.push.apply(t,arguments),t.item=function(t){return this[t]},t}(function(t,e,i,n,s,o,r,a){return new Touch({target:e,identifier:k(),pageX:i,pageY:n,screenX:s,screenY:o,clientX:r||s,clientY:a||o})}.apply(null,arguments))}(window,u,0,h[0],h[1],l[0],l[1],c[0],c[1]);(t.initTouchEvent||t.initEvent)(r,!0,!0,window,null,l[0],l[1],c[0],c[1],!1,!1,!1,!1,e,e,e,1,0)},MouseEvents:function(t){t.initMouseEvent(r,!0,!0,window,0,l[0],l[1],c[0],c[1],!1,!1,!1,!1,1,u)}};if(document.createEvent){var m=!a&&!o&&d&&v[e]?"TouchEvent":"MouseEvents";t=document.createEvent(m),p[m](t),f(t),u.dispatchEvent(t)}else document.createEventObject&&((t=document.createEventObject()).eventType=t.eventName=r,t.screenX=l[0],t.screenY=l[1],t.clientX=c[0],t.clientY=c[1],f(t),u.fireEvent("on"+r,t))}),this}},this.Mottle.consume=function(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()},this.Mottle.pageLocation=T,this.Mottle.setForceTouchEvents=function(t){d=t},this.Mottle.setForceMouseEvents=function(t){y=t},this.Mottle.version="0.8.0",e.Mottle=this.Mottle}.call("undefined"==typeof window?commonjsGlobal:window),function(){var t=function(t,e,i){return-1===t.indexOf(e)&&(i?t.unshift(e):t.push(e),!0)},i=function(t,e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)},n=function(t,e){for(var i=[],n=0;n<t.length;n++)-1===e.indexOf(t[n])&&i.push(t[n]);return i},s=function(t){return null!=t&&("string"==typeof t||t.constructor===String)},o=function(t){var e=t.getBoundingClientRect(),i=document.body,n=document.documentElement,s=window.pageYOffset||n.scrollTop||i.scrollTop,o=window.pageXOffset||n.scrollLeft||i.scrollLeft,r=e.left+o-(n.clientLeft||i.clientLeft||0);return{top:Math.round(e.top+s-(n.clientTop||i.clientTop||0)),left:Math.round(r)}},r=function(t,e,i){for(var n=(i=i||t.parentNode).querySelectorAll(e),s=0;s<n.length;s++)if(n[s]===t)return!0;return!1},a=function(t,e,i){if(r(e,i,t))return e;for(var n=e.parentNode;null!=n&&n!==t;){if(r(n,i,t))return n;n=n.parentNode}},h=function(t,e,i){for(var n=null,s=e.getAttribute("katavorio-draggable"),o=null!=s?"[katavorio-draggable='"+s+"'] ":"",h=0;h<t.length;h++)if(null!=(n=a(e,i,o+t[h].selector))){if(t[h].filter){var l=r(i,t[h].filter,n);if(!0===t[h].filterExclude&&!l||l)return null}return[t[h],n]}return null},l=function(){var t=-1;if("Microsoft Internet Explorer"===navigator.appName){var e=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(e)&&(t=parseFloat(RegExp.$1))}return t}(),c=l>-1&&l<9,u=9===l,f=function(t){if(c)return[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop];var e=m(t),i=p(e,0);return u?[i.pageX||i.clientX,i.pageY||i.clientY]:[i.pageX,i.pageY]},p=function(t,e){return t.item?t.item(e):t[e]},m=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},d={delegatedDraggable:"katavorio-delegated-draggable",draggable:"katavorio-draggable",droppable:"katavorio-droppable",drag:"katavorio-drag",selected:"katavorio-drag-selected",active:"katavorio-drag-active",hover:"katavorio-drag-hover",noSelect:"katavorio-drag-no-select",ghostProxy:"katavorio-ghost-proxy",clonedDrag:"katavorio-clone-drag"},y=["stop","start","drag","drop","over","out","beforeStart"],v=function(){},b=function(){return!0},x=function(t,e,i){for(var n=0;n<t.length;n++)t[n]!=i&&e(t[n])},g=function(t,e,i,n){x(t,function(t){t.setActive(e),e&&t.updatePosition(),i&&t.setHover(n,e)})},T=function(t,e){if(null!=t){t=s(t)||null!=t.tagName||null==t.length?[t]:t;for(var i=0;i<t.length;i++)e.apply(t[i],[t[i]])}},w=function(t){t.stopPropagation?(t.stopPropagation(),t.preventDefault()):t.returnValue=!1},j=function(t,e,i){return!r(t.srcElement||t.target,i.getInputFilterSelector(),e)},C=function(t,e,i,n){this.params=e||{},this.el=t,this.params.addClass(this.el,this._class),this.uuid=S();var s=!0;return this.setEnabled=function(t){s=t},this.isEnabled=function(){return s},this.toggleEnabled=function(){s=!s},this.setScope=function(t){this.scopes=t?t.split(/\s+/):[n]},this.addScope=function(t){var e={};for(var i in T(this.scopes,function(t){e[t]=!0}),T(t?t.split(/\s+/):[],function(t){e[t]=!0}),this.scopes=[],e)this.scopes.push(i)},this.removeScope=function(t){var e={};for(var i in T(this.scopes,function(t){e[t]=!0}),T(t?t.split(/\s+/):[],function(t){delete e[t]}),this.scopes=[],e)this.scopes.push(i)},this.toggleScope=function(t){var e={};for(var i in T(this.scopes,function(t){e[t]=!0}),T(t?t.split(/\s+/):[],function(t){e[t]?delete e[t]:e[t]=!0}),this.scopes=[],e)this.scopes.push(i)},this.setScope(e.scope),this.k=e.katavorio,e.katavorio},N=function(){return!0},E=function(){return!1},O=function(t,e,i){this._class=i.draggable;var n=C.apply(this,arguments);this.rightButtonCanDrag=this.params.rightButtonCanDrag;var a,l,c,u,p=[0,0],m=null,y=null,v=[0,0],x=!1,T=[0,0],O=!1!==this.params.consumeStartEvent,k=this.el,D=this.params.clone,A=!1!==e.multipleDrop,I=!1,P=!0===e.ghostProxy?N:e.ghostProxy&&"function"==typeof e.ghostProxy?e.ghostProxy:E,W=function(t){return t.cloneNode(!0)},L=null,F=[],H=null,_=e.ghostProxyParent;if(e.selector){var R=t.getAttribute("katavorio-draggable");null==R&&(R=""+(new Date).getTime(),t.setAttribute("katavorio-draggable",R)),F.push(e)}var $,q=e.snapThreshold,U=function(t,e,i,n,s){var o=e*Math.floor(t[0]/e),r=o+e,a=Math.abs(t[0]-o)<=n?o:Math.abs(r-t[0])<=n?r:t[0],h=i*Math.floor(t[1]/i),l=h+i;return[a,Math.abs(t[1]-h)<=s?h:Math.abs(l-t[1])<=s?l:t[1]]};this.posses=[],this.posseRoles={},this.toGrid=function(t){return null==this.params.grid?t:U(t,this.params.grid[0],this.params.grid[1],this.params.grid?this.params.grid[0]/2:q||5,this.params.grid?this.params.grid[1]/2:q||5)},this.snap=function(t,e){if(null!=k){t=t||(this.params.grid?this.params.grid[0]:10),e=e||(this.params.grid?this.params.grid[1]:10);var i=this.params.getPosition(k);this.params.setPosition(k,U(i,t,e,this.params.grid?this.params.grid[0]/2:q,this.params.grid?this.params.grid[1]/2:q))}},this.setUseGhostProxy=function(t){P=t?N:E};var G,Y=function(t){return!1===e.allowNegative?[Math.max(0,t[0]),Math.max(0,t[1])]:t},V=function(t){$="function"==typeof t?t:t?function(t,e,i,n){return Y([Math.max(0,Math.min(i.w-n[0],t[0])),Math.max(0,Math.min(i.h-n[1],t[1]))])}.bind(this):function(t){return Y(t)}}.bind(this);V("function"==typeof this.params.constrain?this.params.constrain:this.params.constrain||this.params.containment),this.setConstrain=function(t){V(t)},this.setRevert=function(t){G=t},this.params.revert&&(G=this.params.revert);var X=function(t){return"function"==typeof t?(t._katavorioId=S(),t._katavorioId):t},B={},z=function(t){for(var e in B){var i=B[e],n=i[0](t);if(i[1]&&(n=!n),!n)return!1}return!0},J=this.setFilter=function(e,i){if(e){var n=X(e);B[n]=[function(i){var n,o=i.srcElement||i.target;return s(e)?n=r(o,e,t):"function"==typeof e&&(n=e(i,t)),n},!1!==i]}};this.addFilter=J,this.removeFilter=function(t){delete B["function"==typeof t?t._katavorioId:t]},this.clearAllFilters=function(){B={}},this.canDrag=this.params.canDrag||b;var Q,Z=[],K=[];this.addSelector=function(t){t.selector&&F.push(t)},this.downListener=function(t){if(!t.defaultPrevented&&(this.rightButtonCanDrag||3!==t.which&&2!==t.button)&&this.isEnabled()&&this.canDrag())if(z(t)&&j(t,this.el,this.k)){if(H=null,L=null,F.length>0){var e=h(F,this.el,t.target||t.srcElement);if(null!=e&&(H=e[0],L=e[1]),null==L)return}else L=this.el;if(D)if(k=L.cloneNode(!0),this.params.addClass(k,d.clonedDrag),k.setAttribute("id",null),k.style.position="absolute",null!=this.params.parent){var s=this.params.getPosition(this.el);k.style.left=s[0]+"px",k.style.top=s[1]+"px",this.params.parent.appendChild(k)}else{var r=o(L);k.style.left=r.left+"px",k.style.top=r.top+"px",document.body.appendChild(k)}else k=L;O&&w(t),p=f(t),k&&k.parentNode&&(T=[k.parentNode.scrollLeft,k.parentNode.scrollTop]),this.params.bind(document,"mousemove",this.moveListener),this.params.bind(document,"mouseup",this.upListener),n.markSelection(this),n.markPosses(this),this.params.addClass(document.body,i.noSelect),it("beforeStart",{el:this.el,pos:m,e:t,drag:this})}else this.params.consumeFilteredEvents&&w(t)}.bind(this),this.moveListener=function(t){if(p){if(!x)if(!1!==it("start",{el:this.el,pos:m,e:t,drag:this})){if(!p)return;this.mark(!0),x=!0}else this.abort();if(p){K.length=0;var e=f(t),i=e[0]-p[0],s=e[1]-p[1],o=this.params.ignoreZoom?1:n.getZoom();k&&k.parentNode&&(i+=k.parentNode.scrollLeft-T[0],s+=k.parentNode.scrollTop-T[1]),this.moveBy(i/=o,s/=o,t),n.updateSelection(i,s,this),n.updatePosses(i,s,this)}}}.bind(this),this.upListener=function(t){p&&(p=null,this.params.unbind(document,"mousemove",this.moveListener),this.params.unbind(document,"mouseup",this.upListener),this.params.removeClass(document.body,i.noSelect),this.unmark(t),n.unmarkSelection(this,t),n.unmarkPosses(this,t),this.stop(t),n.notifyPosseDragStop(this,t),x=!1,K.length=0,D?(k&&k.parentNode&&k.parentNode.removeChild(k),k=null):G&&!0===G(k,this.params.getPosition(k))&&(this.params.setPosition(k,m),it("revert",k)))}.bind(this),this.getFilters=function(){return B},this.abort=function(){null!=p&&this.upListener()},this.getDragElement=function(t){return t?L||this.el:k||this.el};var tt={start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]};e.events.start&&tt.start.push(e.events.start),e.events.beforeStart&&tt.beforeStart.push(e.events.beforeStart),e.events.stop&&tt.stop.push(e.events.stop),e.events.drag&&tt.drag.push(e.events.drag),e.events.revert&&tt.revert.push(e.events.revert),this.on=function(t,e){tt[t]&&tt[t].push(e)},this.off=function(t,e){if(tt[t]){for(var i=[],n=0;n<tt[t].length;n++)tt[t][n]!==e&&i.push(tt[t][n]);tt[t]=i}};var et,it=function(t,e){var i=null;if(H&&H[t])i=H[t](e);else if(tt[t])for(var n=0;n<tt[t].length;n++)try{var s=tt[t][n](e);null!=s&&(i=s)}catch(t){}return i};this.notifyStart=function(t){it("start",{el:this.el,pos:this.params.getPosition(k),e:t,drag:this})},this.stop=function(t,e){if(e||x){var i=[],s=n.getSelection(),o=this.params.getPosition(k);if(s.length>0)for(var r=0;r<s.length;r++){var a=this.params.getPosition(s[r].el);i.push([s[r].el,{left:a[0],top:a[1]},s[r]])}else i.push([k,{left:o[0],top:o[1]},this]);it("stop",{el:k,pos:et||o,finalPos:o,e:t,drag:this,selection:i})}},this.mark=function(t){var e;m=this.params.getPosition(k),y=this.params.getPosition(k,!0),v=[y[0]-m[0],y[1]-m[1]],this.size=this.params.getSize(k),Z=n.getMatchingDroppables(this),g(Z,!0,!1,this),this.params.addClass(k,this.params.dragClass||i.drag),e=this.params.getConstrainingRectangle?this.params.getConstrainingRectangle(k):this.params.getSize(k.parentNode),Q={w:e[0],h:e[1]},c=0,u=0,t&&n.notifySelectionDragStart(this)},this.unmark=function(t,n){if(g(Z,!1,!0,this),I&&P(L,k)?(et=[k.offsetLeft-c,k.offsetTop-u],k.parentNode.removeChild(k),k=L):et=null,this.params.removeClass(k,this.params.dragClass||i.drag),Z.length=0,I=!1,!n){K.length>0&&et&&e.setPosition(L,et),K.sort(M);for(var s=0;s<K.length&&!0!==K[s].drop(this,t);s++);}},this.moveBy=function(t,i,n){K.length=0;var s=this.toGrid([m[0]+t,m[1]+i]),o=$(s,k,Q,this.size);if(P(this.el,k))if(s[0]!==o[0]||s[1]!==o[1]){if(!I){var r=W(L);e.addClass(r,d.ghostProxy),_?(_.appendChild(r),a=e.getPosition(L.parentNode,!0),l=e.getPosition(e.ghostProxyParent,!0),c=a[0]-l[0],u=a[1]-l[1]):L.parentNode.appendChild(r),k=r,I=!0}o=s}else I&&(k.parentNode.removeChild(k),k=L,I=!1,a=null,l=null,c=0,u=0);var h={x:o[0],y:o[1],w:this.size[0],h:this.size[1]},f={x:h.x+v[0],y:h.y+v[1],w:h.w,h:h.h},p=null;this.params.setPosition(k,[o[0]+c,o[1]+u]);for(var y=0;y<Z.length;y++)this.params.intersects(f,{x:Z[y].pagePosition[0],y:Z[y].pagePosition[1],w:Z[y].size[0],h:Z[y].size[1]})&&(A||null==p||p===Z[y].el)&&Z[y].canDrop(this)?(p||(p=Z[y].el),K.push(Z[y]),Z[y].setHover(this,!0,n)):Z[y].isHover()&&Z[y].setHover(this,!1,n);it("drag",{el:this.el,pos:o,e:n,drag:this})},this.destroy=function(){this.params.unbind(this.el,"mousedown",this.downListener),this.params.unbind(document,"mousemove",this.moveListener),this.params.unbind(document,"mouseup",this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null},this.params.bind(this.el,"mousedown",this.downListener),this.params.handle?J(this.params.handle,!1):J(this.params.filter,this.params.filterExclude)},k=function(t,e,i){this._class=i.droppable,this.params=e||{},this.rank=e.rank||0,this._activeClass=this.params.activeClass||i.active,this._hoverClass=this.params.hoverClass||i.hover,C.apply(this,arguments);var n=!1;this.allowLoopback=!1!==this.params.allowLoopback,this.setActive=function(t){this.params[t?"addClass":"removeClass"](this.el,this._activeClass)},this.updatePosition=function(){this.position=this.params.getPosition(this.el),this.pagePosition=this.params.getPosition(this.el,!0),this.size=this.params.getSize(this.el)},this.canDrop=this.params.canDrop||function(){return!0},this.isHover=function(){return n},this.setHover=function(t,e,i){(e||null==this.el._katavorioDragHover||this.el._katavorioDragHover===t.el._katavorio)&&(this.params[e?"addClass":"removeClass"](this.el,this._hoverClass),this.el._katavorioDragHover=e?t.el._katavorio:null,n!==e&&this.params.events[e?"over":"out"]({el:this.el,e:i,drag:t,drop:this}),n=e)},this.drop=function(t,e){return this.params.events.drop({drag:t,e,drop:this})},this.destroy=function(){this._class=null,this._activeClass=null,this._hoverClass=null,n=null}},S=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},M=function(t,e){return t.rank<e.rank?1:t.rank>e.rank?-1:0},D=function(t){return null==t?null:null==(t="string"==typeof t||t.constructor===String?document.getElementById(t):t)?null:(t._katavorio=t._katavorio||S(),t)};this.Katavorio=function(e){var o=[],r={};this._dragsByScope={},this._dropsByScope={};var a=1,h=function(t,e){T(t,function(t){for(var i=0;i<t.scopes.length;i++)e[t.scopes[i]]=e[t.scopes[i]]||[],e[t.scopes[i]].push(t)})},l=function(t,i){var n=0;return T(t,function(t){for(var s=0;s<t.scopes.length;s++)if(i[t.scopes[s]]){var o=e.indexOf(i[t.scopes[s]],t);-1!==o&&(i[t.scopes[s]].splice(o,1),n++)}}),n>0},c=(this.getMatchingDroppables=function(t){for(var e=[],i={},n=0;n<t.scopes.length;n++){var s=this._dropsByScope[t.scopes[n]];if(s)for(var o=0;o<s.length;o++)!s[o].canDrop(t)||i[s[o].uuid]||!s[o].allowLoopback&&s[o].el===t.el||(i[s[o].uuid]=!0,e.push(s[o]))}return e.sort(M),e},function(t){t=t||{};var i,n={events:{}};for(i in e)n[i]=e[i];for(i in t)n[i]=t[i];for(i=0;i<y.length;i++)n.events[y[i]]=t[y[i]]||v;return n.katavorio=this,n}.bind(this)),u=function(t,e){for(var i=0;i<y.length;i++)e[y[i]]&&t.on(y[i],e[y[i]])}.bind(this),f={},p=e.css||{},m=e.scope||"katavorio-drag-scope";for(var b in d)f[b]=d[b];for(var b in p)f[b]=p[b];var g=e.inputFilterSelector||"input,textarea,select,button,option";this.getInputFilterSelector=function(){return g},this.setInputFilterSelector=function(t){return g=t,this},this.draggable=function(t,i){var n=[];return T(t,function(t){if(null!=(t=D(t)))if(null==t._katavorioDrag){var s=c(i);t._katavorioDrag=new O(t,s,f,m),h(t._katavorioDrag,this._dragsByScope),n.push(t._katavorioDrag),e.addClass(t,s.selector?f.delegatedDraggable:f.draggable)}else u(t._katavorioDrag,i)}.bind(this)),n},this.droppable=function(t,i){var n=[];return T(t,function(t){if(null!=(t=D(t))){var s=new k(t,c(i),f,m);t._katavorioDrop=t._katavorioDrop||[],t._katavorioDrop.push(s),h(s,this._dropsByScope),n.push(s),e.addClass(t,f.droppable)}}.bind(this)),n},this.select=function(t){return T(t,function(){var t=D(this);t&&t._katavorioDrag&&(r[t._katavorio]||(o.push(t._katavorioDrag),r[t._katavorio]=[t,o.length-1],e.addClass(t,f.selected)))}),this},this.deselect=function(t){return T(t,function(){var t=D(this);if(t&&t._katavorio&&r[t._katavorio]){for(var i=[],n=0;n<o.length;n++)o[n].el!==t&&i.push(o[n]);o=i,delete r[t._katavorio],e.removeClass(t,f.selected)}}),this},this.deselectAll=function(){for(var t in r)e.removeClass(r[t][0],f.selected);o.length=0,r={}},this.markSelection=function(t){x(o,function(t){t.mark()},t)},this.markPosses=function(t){t.posses&&T(t.posses,function(e){t.posseRoles[e]&&E[e]&&x(E[e].members,function(t){t.mark()},t)})},this.unmarkSelection=function(t,e){x(o,function(t){t.unmark(e)},t)},this.unmarkPosses=function(t,e){t.posses&&T(t.posses,function(i){t.posseRoles[i]&&E[i]&&x(E[i].members,function(t){t.unmark(e,!0)},t)})},this.getSelection=function(){return o.slice(0)},this.updateSelection=function(t,e,i){x(o,function(i){i.moveBy(t,e)},i)};var w=function(t,e){e.posses&&T(e.posses,function(i){e.posseRoles[i]&&E[i]&&x(E[i].members,function(e){t(e)},e)})};this.updatePosses=function(t,e,i){w(function(i){i.moveBy(t,e)},i)},this.notifyPosseDragStop=function(t,e){w(function(t){t.stop(e,!0)},t)},this.notifySelectionDragStop=function(t,e){x(o,function(t){t.stop(e,!0)},t)},this.notifySelectionDragStart=function(t,e){x(o,function(t){t.notifyStart(e)},t)},this.setZoom=function(t){a=t},this.getZoom=function(){return a};var j=function(t,e,i,n){T(t,function(t){l(t,i),t[n](e),h(t,i)})};T(["set","add","remove","toggle"],function(t){this[t+"Scope"]=function(e,i){j(e._katavorioDrag,i,this._dragsByScope,t+"Scope"),j(e._katavorioDrop,i,this._dropsByScope,t+"Scope")}.bind(this),this[t+"DragScope"]=function(e,i){j(e.constructor===O?e:e._katavorioDrag,i,this._dragsByScope,t+"Scope")}.bind(this),this[t+"DropScope"]=function(e,i){j(e.constructor===k?e:e._katavorioDrop,i,this._dropsByScope,t+"Scope")}.bind(this)}.bind(this)),this.snapToGrid=function(t,e){for(var i in this._dragsByScope)x(this._dragsByScope[i],function(i){i.snap(t,e)})},this.getDragsForScope=function(t){return this._dragsByScope[t]},this.getDropsForScope=function(t){return this._dropsByScope[t]};var C=function(t,e,i){if((t=D(t))[e]){var n=o.indexOf(t[e]);n>=0&&o.splice(n,1),l(t[e],i)&&T(t[e],function(t){t.destroy()}),delete t[e]}},N=function(t,e,i,n){(t=D(t))[e]&&t[e].off(i,n)};this.elementRemoved=function(t){this.destroyDraggable(t),this.destroyDroppable(t)},this.destroyDraggable=function(t,e,i){1===arguments.length?C(t,"_katavorioDrag",this._dragsByScope):N(t,"_katavorioDrag",e,i)},this.destroyDroppable=function(t,e,i){1===arguments.length?C(t,"_katavorioDrop",this._dropsByScope):N(t,"_katavorioDrop",e,i)},this.reset=function(){this._dragsByScope={},this._dropsByScope={},o=[],r={},E={}};var E={},S=function(e,i,n){var o,r=s(i)?i:i.id,a=!!s(i)||!1!==i.active,h=E[r]||(E[r]=o={name:r,members:[]},o);return T(e,function(e){if(e._katavorioDrag){if(n&&null!=e._katavorioDrag.posseRoles[h.name])return;t(h.members,e._katavorioDrag),t(e._katavorioDrag.posses,h.name),e._katavorioDrag.posseRoles[h.name]=a}}),h};this.addToPosse=function(t,e){for(var i=[],n=1;n<arguments.length;n++)i.push(S(t,arguments[n]));return 1===i.length?i[0]:i},this.setPosse=function(t,e){for(var i=[],s=1;s<arguments.length;s++)i.push(S(t,arguments[s],!0).name);return T(t,function(t){if(t._katavorioDrag){var e=n(t._katavorioDrag.posses,i);Array.prototype.push.apply([],t._katavorioDrag.posses);for(var s=0;s<e.length;s++)this.removeFromPosse(t,e[s])}}.bind(this)),1===i.length?i[0]:i},this.removeFromPosse=function(t,e){if(arguments.length<2)throw new TypeError("No posse id provided for remove operation");for(var n=1;n<arguments.length;n++)e=arguments[n],T(t,function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){var n=t._katavorioDrag;T(e,function(t){i(E[t].members,n),i(n.posses,t),delete n.posseRoles[t]})}})},this.removeFromAllPosses=function(t){T(t,function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){var e=t._katavorioDrag;T(e.posses,function(t){i(E[t].members,e)}),e.posses.length=0,e.posseRoles={}}})},this.setPosseState=function(t,e,i){var n=E[e];n&&T(t,function(t){t._katavorioDrag&&t._katavorioDrag.posses&&(t._katavorioDrag.posseRoles[n.name]=i)})}},this.Katavorio.version="1.0.0",e.Katavorio=this.Katavorio}.call("undefined"!=typeof window?window:commonjsGlobal),function(){this.jsPlumbUtil=this.jsPlumbUtil||{};var t=this.jsPlumbUtil;function i(t){return"[object Array]"===Object.prototype.toString.call(t)}function n(t){return"string"==typeof t}function s(t){return"boolean"==typeof t}function o(t){return null!=t&&"[object Object]"===Object.prototype.toString.call(t)}function r(t){return"[object Date]"===Object.prototype.toString.call(t)}function a(t){return"[object Function]"===Object.prototype.toString.call(t)}function h(t){if(n(t))return""+t;if(s(t))return!!t;if(r(t))return new Date(t.getTime());if(a(t))return t;if(i(t)){for(var e=[],l=0;l<t.length;l++)e.push(h(t[l]));return e}if(o(t)){var c={};for(var u in t)c[u]=h(t[u]);return c}return t}function l(t,e,r,a){var l,c,u={},f={};for(r=r||[],a=a||[],c=0;c<r.length;c++)u[r[c]]=!0;for(c=0;c<a.length;c++)f[a[c]]=!0;var p=h(t);for(c in e)if(null==p[c]||f[c])p[c]=e[c];else if(n(e[c])||s(e[c]))u[c]?((l=[]).push.apply(l,i(p[c])?p[c]:[p[c]]),l.push.apply(l,s(e[c])?e[c]:[e[c]]),p[c]=l):p[c]=e[c];else if(i(e[c]))l=[],i(p[c])&&l.push.apply(l,p[c]),l.push.apply(l,e[c]),p[c]=l;else if(o(e[c]))for(var m in o(p[c])||(p[c]={}),e[c])p[c][m]=e[c][m];return p}function c(t,e){if(t)for(var i=0;i<t.length;i++)if(e(t[i]))return i;return-1}function u(t,e){var i=t.indexOf(e);return i>-1&&t.splice(i,1),-1!==i}function f(t,e,i,n){var s=t[e];return null==s&&(t[e]=s=[]),s[n?"unshift":"push"](i),s}function p(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}function m(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}e.jsPlumbUtil=t,t.isArray=i,t.isNumber=function(t){return"[object Number]"===Object.prototype.toString.call(t)},t.isString=n,t.isBoolean=s,t.isNull=function(t){return null==t},t.isObject=o,t.isDate=r,t.isFunction=a,t.isNamedFunction=function(t){return a(t)&&null!=t.name&&t.name.length>0},t.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},t.clone=h,t.merge=l,t.replace=function(t,e,i){if(null!=t){var n=t;return e.replace(/([^\.])+/g,function(t,e,s,o){var r=t.match(/([^\[0-9]+){1}(\[)([0-9+])/),a=function(){return n[r[1]]||(n[r[1]]=[],n[r[1]])};if(s+t.length>=o.length)r?a()[r[3]]=i:n[t]=i;else if(r){var h=a();n=h[r[3]]||(h[r[3]]={},h[r[3]])}else n=n[t]||(n[t]={},n[t]);return""}),t}},t.functionChain=function(t,e,i){for(var n=0;n<i.length;n++){var s=i[n][0][i[n][1]].apply(i[n][0],i[n][2]);if(s===e)return s}return t},t.populate=function(t,e,s,r){var h=function(t){if(null!=t){if(n(t))return function(t){var i=t.match(/(\${.*?})/g);if(null!=i)for(var n=0;n<i.length;n++){var s=e[i[n].substring(2,i[n].length-1)]||"";null!=s&&(t=t.replace(i[n],s))}return t}(t);if(!a(t)||r||null!=s&&0!==(t.name||"").indexOf(s)){if(i(t)){for(var l=[],c=0;c<t.length;c++)l.push(h(t[c]));return l}if(o(t)){var u={};for(var f in t)u[f]=h(t[f]);return u}return t}return t(e)}};return h(t)},t.findWithFunction=c,t.removeWithFunction=function(t,e){var i=c(t,e);return i>-1&&t.splice(i,1),-1!==i},t.remove=u,t.addWithFunction=function(t,e,i){-1===c(t,i)&&t.push(e)},t.addToList=f,t.suggest=function(t,e,i){return-1===t.indexOf(e)&&(i?t.unshift(e):t.push(e),!0)},t.extend=function(t,e,n){var s;e=i(e)?e:[e];var o=function(e){for(var i=e.__proto__;null!=i;)if(null!=i.prototype){for(var n in i.prototype)i.prototype.hasOwnProperty(n)&&!t.prototype.hasOwnProperty(n)&&(t.prototype[n]=i.prototype[n]);i=i.prototype.__proto__}else i=null};for(s=0;s<e.length;s++){for(var r in e[s].prototype)e[s].prototype.hasOwnProperty(r)&&!t.prototype.hasOwnProperty(r)&&(t.prototype[r]=e[s].prototype[r]);o(e[s])}var a=function(t,i){return function(){for(s=0;s<e.length;s++)e[s].prototype[t]&&e[s].prototype[t].apply(this,arguments);return i.apply(this,arguments)}},h=function(e){for(var i in e)t.prototype[i]=a(i,e[i])};if(arguments.length>2)for(s=2;s<arguments.length;s++)h(arguments[s]);return t},t.uuid=p,t.fastTrim=function(t){if(null==t)return null;for(var e=t.replace(/^\s\s*/,""),i=/\s/,n=e.length;i.test(e.charAt(--n)););return e.slice(0,n+1)},t.each=function(t,e){t=null==t.length||"string"==typeof t?[t]:t;for(var i=0;i<t.length;i++)e(t[i])},t.map=function(t,e){for(var i=[],n=0;n<t.length;n++)i.push(e(t[n]));return i},t.mergeWithParents=function(t,e,i){i=i||"parent";var n=function(t){return t?e[t]:null},s=function(t){return t?n(t[i]):null},o=function(t,e){if(null==t)return e;var i=["anchor","anchors","cssClass","connector","paintStyle","hoverPaintStyle","endpoint","endpoints"];"override"===e.mergeStrategy&&Array.prototype.push.apply(i,["events","overlays"]);var n=l(t,e,[],i);return o(s(t),n)},r=function(t){if(null==t)return{};if("string"==typeof t)return n(t);if(t.length){for(var e=!1,i=0,s=void 0;!e&&i<t.length;)(s=r(t[i]))?e=!0:i++;return s}},a=r(t);return a?o(s(a),a):{}},t.logEnabled=!0,t.log=m,t.wrap=function(t,e,i){return function(){var n=null;try{null!=e&&(n=e.apply(this,arguments))}catch(t){m("jsPlumb function failed : "+t)}if(null!=t&&(null==i||n!==i))try{n=t.apply(this,arguments)}catch(t){m("wrapped function failed : "+t)}return n}},t.EventGenerator=function(){var t=this;this._listeners={},this.eventsSuspended=!1,this.tick=!1,this.eventsToDieOn={ready:!0},this.queue=[],this.bind=function(e,i,n){var s=function(e){f(t._listeners,e,i,n),i.__jsPlumb=i.__jsPlumb||{},i.__jsPlumb[p()]=e};if("string"==typeof e)s(e);else if(null!=e.length)for(var o=0;o<e.length;o++)s(e[o]);return t},this.fire=function(t,e,i){if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[t]){var n=this._listeners[t].length,s=0,o=!1,r=null;if(!this.shouldFireEvent||this.shouldFireEvent(t,e,i))for(;!o&&s<n&&!1!==r;){if(this.eventsToDieOn[t])this._listeners[t][s].apply(this,[e,i]);else try{r=this._listeners[t][s].apply(this,[e,i])}catch(e){m("jsPlumb: fire failed for event "+t+" : "+e)}s++,null!=this._listeners&&null!=this._listeners[t]||(o=!0)}}this.tick=!1,this._drain()}return this},this._drain=function(){var e=t.queue.pop();e&&t.fire.apply(t,e)},this.unbind=function(t,e){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof t)delete this._listeners[t];else if(t.__jsPlumb)for(var i in t.__jsPlumb)u(this._listeners[t.__jsPlumb[i]]||[],t)}else 2===arguments.length&&u(this._listeners[t]||[],e);return this},this.getListener=function(e){return t._listeners[e]},this.setSuspendEvents=function(e){t.eventsSuspended=e},this.isSuspendEvents=function(){return t.eventsSuspended},this.silently=function(e){t.setSuspendEvents(!0);try{e()}catch(t){m("Cannot execute silent function "+t)}t.setSuspendEvents(!1)},this.cleanupListeners=function(){for(var e in t._listeners)t._listeners[e]=null}}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){this.jsPlumbUtil.matchesSelector=function(t,e,i){for(var n=(i=i||t.parentNode).querySelectorAll(e),s=0;s<n.length;s++)if(n[s]===t)return!0;return!1},this.jsPlumbUtil.consume=function(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()},this.jsPlumbUtil.sizeElement=function(t,e,i,n,s){t&&(t.style.height=s+"px",t.height=s,t.style.width=n+"px",t.width=n,t.style.left=e+"px",t.style.top=i+"px")}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t={deriveAnchor:function(t,e){return{top:["TopRight","TopLeft"],bottom:["BottomRight","BottomLeft"]}[t][e]}},e=function(t){this.count=0,this.instance=t,this.lists={},this.instance.addList=function(t,e){return this.listManager.addList(t,e)},this.instance.removeList=function(t){this.listManager.removeList(t)},this.instance.bind("manageElement",function(t){for(var e=this.instance.getSelector(t.el,"[jtk-scrollable-list]"),i=0;i<e.length;i++)this.addList(e[i])}.bind(this)),this.instance.bind("unmanageElement",function(t){this.removeList(t.el)}),this.instance.bind("connection",function(t,e){null==e&&(this._maybeUpdateParentList(t.source),this._maybeUpdateParentList(t.target))}.bind(this))};this.jsPlumbListManager=e,e.prototype={addList:function(e,n){var s=this.instance.extend({},t);n=this.instance.extend(s,n||{});var o=[this.instance.getInstanceIndex(),this.count++].join("_");this.lists[o]=new i(this.instance,e,n,o)},removeList:function(t){var e=this.lists[t._jsPlumbList];e&&(e.destroy(),delete this.lists[t._jsPlumbList])},_maybeUpdateParentList:function(t){for(var e=t.parentNode,i=this.instance.getContainer();null!=e&&e!==i;){if(null!=e._jsPlumbList&&null!=this.lists[e._jsPlumbList])return void e._jsPlumbScrollHandler();e=e.parentNode}}};var i=function(t,e,i,n){function s(t,e,n,s){return i.anchor?i.anchor:i.deriveAnchor(t,e,n,s)}function o(t,e,n,s){return i.deriveEndpoint?i.deriveEndpoint(t,e,n,s):i.endpoint?i.endpoint:n.type}e._jsPlumbList=n;var r=function(){for(var i=t.getSelector(e,".jtk-managed"),n=t.getId(e),r=0;r<i.length;r++){if(i[r].offsetTop<e.scrollTop)i[r]._jsPlumbProxies||(i[r]._jsPlumbProxies=i[r]._jsPlumbProxies||[],t.select({source:i[r]}).each(function(a){t.proxyConnection(a,0,e,n,function(){return o("top",0,a.endpoints[0],a)},function(){return s("top",0,a.endpoints[0],a)}),i[r]._jsPlumbProxies.push([a,0])}),t.select({target:i[r]}).each(function(a){t.proxyConnection(a,1,e,n,function(){return o("top",1,a.endpoints[1],a)},function(){return s("top",1,a.endpoints[1],a)}),i[r]._jsPlumbProxies.push([a,1])}));else if(i[r].offsetTop>e.scrollTop+e.offsetHeight)i[r]._jsPlumbProxies||(i[r]._jsPlumbProxies=i[r]._jsPlumbProxies||[],t.select({source:i[r]}).each(function(a){t.proxyConnection(a,0,e,n,function(){return o("bottom",0,a.endpoints[0],a)},function(){return s("bottom",0,a.endpoints[0],a)}),i[r]._jsPlumbProxies.push([a,0])}),t.select({target:i[r]}).each(function(a){t.proxyConnection(a,1,e,n,function(){return o("bottom",1,a.endpoints[1],a)},function(){return s("bottom",1,a.endpoints[1],a)}),i[r]._jsPlumbProxies.push([a,1])}));else if(i[r]._jsPlumbProxies){for(var a=0;a<i[r]._jsPlumbProxies.length;a++)t.unproxyConnection(i[r]._jsPlumbProxies[a][0],i[r]._jsPlumbProxies[a][1],n);delete i[r]._jsPlumbProxies}t.revalidate(i[r])}!function(e){for(var i=e.parentNode,n=t.getContainer();null!=i&&i!==n;){if(t.hasClass(i,"jtk-managed"))return void t.recalculateOffsets(i);i=i.parentNode}}(e)};t.setAttribute(e,"jtk-scrollable-list","true"),e._jsPlumbScrollHandler=r,t.on(e,"scroll",r),r(),this.destroy=function(){t.off(e,"scroll",r),delete e._jsPlumbScrollHandler;for(var i=t.getSelector(e,".jtk-managed"),n=t.getId(e),s=0;s<i.length;s++)if(i[s]._jsPlumbProxies){for(var o=0;o<i[s]._jsPlumbProxies.length;o++)t.unproxyConnection(i[s]._jsPlumbProxies[o][0],i[s]._jsPlumbProxies[o][1],n);delete i[s]._jsPlumbProxies}}}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,i=t.jsPlumbUtil,n=function(){return""+(new Date).getTime()},s=function(t){if(t._jsPlumb.paintStyle&&t._jsPlumb.hoverPaintStyle){var e={};p.extend(e,t._jsPlumb.paintStyle),p.extend(e,t._jsPlumb.hoverPaintStyle),delete t._jsPlumb.hoverPaintStyle,e.gradient&&t._jsPlumb.paintStyle.fill&&delete e.gradient,t._jsPlumb.hoverPaintStyle=e}},o=["tap","dbltap","click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","contextmenu"],r=function(t){return null==t?null:t.split(" ")},a=function(t,e,i){for(var n in e)t[n]=i},h=function(t,e,n){if(t.getDefaultType){var s=t.getTypeDescriptor(),o={},r=t.getDefaultType(),h=i.merge({},r);a(o,r,"__default");for(var l=0,c=t._jsPlumb.types.length;l<c;l++){var u=t._jsPlumb.types[l];if("__default"!==u){var f=t._jsPlumb.instance.getType(u,s);if(null!=f){var p=["anchor","anchors","connector","paintStyle","hoverPaintStyle","endpoint","endpoints","connectorOverlays","connectorStyle","connectorHoverStyle","endpointStyle","endpointHoverStyle"],m=[];"override"===f.mergeStrategy?Array.prototype.push.apply(p,["events","overlays","cssClass"]):m.push("cssClass"),h=i.merge(h,f,m,p),a(o,f,u)}}}e&&(h=i.populate(h,e,"_")),t.applyType(h,n,o),n||t.repaint()}},l=t.jsPlumbUIComponent=function(t){i.EventGenerator.apply(this,arguments);var e=this,n=arguments,s=e.idPrefix,o=s+(new Date).getTime();this._jsPlumb={instance:t._jsPlumb,parameters:t.parameters||{},paintStyle:null,hoverPaintStyle:null,paintStyleInUse:null,hover:!1,beforeDetach:t.beforeDetach,beforeDrop:t.beforeDrop,overlayPlacements:[],hoverClass:t.hoverClass||t._jsPlumb.Defaults.HoverClass,types:[],typeCache:{}},this.cacheTypeItem=function(t,e,i){this._jsPlumb.typeCache[i]=this._jsPlumb.typeCache[i]||{},this._jsPlumb.typeCache[i][t]=e},this.getCachedTypeItem=function(t,e){return this._jsPlumb.typeCache[e]?this._jsPlumb.typeCache[e][t]:null},this.getId=function(){return o};var r=t.overlays||[],a={};if(this.defaultOverlayKeys){for(var h=0;h<this.defaultOverlayKeys.length;h++)Array.prototype.push.apply(r,this._jsPlumb.instance.Defaults[this.defaultOverlayKeys[h]]||[]);for(h=0;h<r.length;h++){var l=p.convertToFullOverlaySpec(r[h]);a[l[1].id]=l}}var c={overlays:a,parameters:t.parameters||{},scope:t.scope||this._jsPlumb.instance.getDefaultScope()};if(this.getDefaultType=function(){return c},this.appendToDefaultType=function(t){for(var e in t)c[e]=t[e]},t.events)for(var u in t.events)e.bind(u,t.events[u]);this.clone=function(){var t=Object.create(this.constructor.prototype);return this.constructor.apply(t,n),t}.bind(this),this.isDetachAllowed=function(t){var e=!0;if(this._jsPlumb.beforeDetach)try{e=this._jsPlumb.beforeDetach(t)}catch(t){i.log("jsPlumb: beforeDetach callback failed",t)}return e},this.isDropAllowed=function(t,e,n,s,o,r,a){var h=this._jsPlumb.instance.checkCondition("beforeDrop",{sourceId:t,targetId:e,scope:n,connection:s,dropEndpoint:o,source:r,target:a});if(this._jsPlumb.beforeDrop)try{h=this._jsPlumb.beforeDrop({sourceId:t,targetId:e,scope:n,connection:s,dropEndpoint:o,source:r,target:a})}catch(t){i.log("jsPlumb: beforeDrop callback failed",t)}return h};var f=[];this.setListenerComponent=function(t){for(var e=0;e<f.length;e++)f[e][3]=t}},c=function(t,e){var i=t._jsPlumb.instance.getType(t._jsPlumb.types[e],t.getTypeDescriptor());null!=i&&i.cssClass&&t.canvas&&t._jsPlumb.instance.removeClass(t.canvas,i.cssClass)};i.extend(t.jsPlumbUIComponent,i.EventGenerator,{getParameter:function(t){return this._jsPlumb.parameters[t]},setParameter:function(t,e){this._jsPlumb.parameters[t]=e},getParameters:function(){return this._jsPlumb.parameters},setParameters:function(t){this._jsPlumb.parameters=t},getClass:function(){return p.getClass(this.canvas)},hasClass:function(t){return p.hasClass(this.canvas,t)},addClass:function(t){p.addClass(this.canvas,t)},removeClass:function(t){p.removeClass(this.canvas,t)},updateClasses:function(t,e){p.updateClasses(this.canvas,t,e)},setType:function(t,e,i){this.clearTypes(),this._jsPlumb.types=r(t)||[],h(this,e,i)},getType:function(){return this._jsPlumb.types},reapplyTypes:function(t,e){h(this,t,e)},hasType:function(t){return-1!==this._jsPlumb.types.indexOf(t)},addType:function(t,e,i){var n=r(t),s=!1;if(null!=n){for(var o=0,a=n.length;o<a;o++)this.hasType(n[o])||(this._jsPlumb.types.push(n[o]),s=!0);s&&h(this,e,i)}},removeType:function(t,e,i){var n=r(t),s=!1,o=function(t){var e=this._jsPlumb.types.indexOf(t);return-1!==e&&(c(this,e),this._jsPlumb.types.splice(e,1),!0)}.bind(this);if(null!=n){for(var a=0,l=n.length;a<l;a++)s=o(n[a])||s;s&&h(this,e,i)}},clearTypes:function(t,e){for(var i=this._jsPlumb.types.length,n=0;n<i;n++)c(this,0),this._jsPlumb.types.splice(0,1);h(this,t,e)},toggleType:function(t,e,i){var n=r(t);if(null!=n){for(var s=0,o=n.length;s<o;s++){var a=this._jsPlumb.types.indexOf(n[s]);-1!==a?(c(this,a),this._jsPlumb.types.splice(a,1)):this._jsPlumb.types.push(n[s])}h(this,e,i)}},applyType:function(t,e){if(this.setPaintStyle(t.paintStyle,e),this.setHoverPaintStyle(t.hoverPaintStyle,e),t.parameters)for(var i in t.parameters)this.setParameter(i,t.parameters[i]);this._jsPlumb.paintStyleInUse=this.getPaintStyle()},setPaintStyle:function(t,e){this._jsPlumb.paintStyle=t,this._jsPlumb.paintStyleInUse=this._jsPlumb.paintStyle,s(this),e||this.repaint()},getPaintStyle:function(){return this._jsPlumb.paintStyle},setHoverPaintStyle:function(t,e){this._jsPlumb.hoverPaintStyle=t,s(this),e||this.repaint()},getHoverPaintStyle:function(){return this._jsPlumb.hoverPaintStyle},destroy:function(t){(t||null==this.typeId)&&(this.cleanupListeners(),this.clone=null,this._jsPlumb=null)},isHover:function(){return this._jsPlumb.hover},setHover:function(t,e,i){if(this._jsPlumb&&!this._jsPlumb.instance.currentlyDragging&&!this._jsPlumb.instance.isHoverSuspended()){this._jsPlumb.hover=t;var s=t?"addClass":"removeClass";null!=this.canvas&&(null!=this._jsPlumb.instance.hoverClass&&this._jsPlumb.instance[s](this.canvas,this._jsPlumb.instance.hoverClass),null!=this._jsPlumb.hoverClass&&this._jsPlumb.instance[s](this.canvas,this._jsPlumb.hoverClass)),null!=this._jsPlumb.hoverPaintStyle&&(this._jsPlumb.paintStyleInUse=t?this._jsPlumb.hoverPaintStyle:this._jsPlumb.paintStyle,this._jsPlumb.instance.isSuspendDrawing()||(i=i||n(),this.repaint({timestamp:i,recalc:!1}))),this.getAttachedElements&&!e&&function(t,e,i,n){var s=t.getAttachedElements();if(s)for(var o=0,r=s.length;o<r;o++)n&&n===s[o]||s[o].setHover(e,!0,i)}(this,t,n(),this)}}});var u=0,f=t.jsPlumbInstance=function(e){this.version="2.11.1",this.Defaults={Anchor:"Bottom",Anchors:[null,null],ConnectionsDetachable:!0,ConnectionOverlays:[],Connector:"Bezier",Container:null,DoNotThrowErrors:!1,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fill:"#456"},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},LogEnabled:!1,Overlays:[],MaxConnections:1,PaintStyle:{"stroke-width":4,stroke:"#456"},ReattachConnections:!1,RenderMode:"svg",Scope:"jsPlumb_DefaultScope"},e&&p.extend(this.Defaults,e),this.logEnabled=this.Defaults.LogEnabled,this._connectionTypes={},this._endpointTypes={},i.EventGenerator.apply(this);var s=this,r=function(){var t=u+1;return u++,t}(),a=s.bind,h={},c=1,f=function(t){if(null==t)return null;if(3===t.nodeType||8===t.nodeType)return{el:t,text:!0};var e=s.getElement(t);return{el:e,id:i.isString(t)&&null==e?t:$(e)}};for(var m in this.getInstanceIndex=function(){return r},this.setZoom=function(t,e){return s.fire("zoom",c=t),e&&s.repaintEverything(),!0},this.getZoom=function(){return c},this.Defaults)h[m]=this.Defaults[m];var d,y=[];this.unbindContainer=function(){if(null!=d&&y.length>0)for(var t=0;t<y.length;t++)s.off(d,y[t][0],y[t][1])},this.setContainer=function(t){this.unbindContainer(),t=this.getElement(t),this.select().each(function(e){e.moveParent(t)}),this.selectEndpoints().each(function(e){e.moveParent(t)});var e=d;d=t,y.length=0;for(var i={endpointclick:"endpointClick",endpointdblclick:"endpointDblClick"},n=function(t,e,n){var o=e.srcElement||e.target,r=(o&&o.parentNode?o.parentNode._jsPlumb:null)||(o?o._jsPlumb:null)||(o&&o.parentNode&&o.parentNode.parentNode?o.parentNode.parentNode._jsPlumb:null);r&&(r.fire(t,r,e),s.fire(n&&i[n+t]||t,r.component||r,e))},r=function(t,e,i){y.push([t,i]),s.on(d,t,e,i)},a=function(t){r(t,".jtk-connector",function(e){n(t,e)}),r(t,".jtk-endpoint",function(e){n(t,e,"endpoint")}),r(t,".jtk-overlay",function(e){n(t,e)})},h=0;h<o.length;h++)a(o[h]);for(var l in w){var c=w[l].el;c.parentNode===e&&(e.removeChild(c),d.appendChild(c))}},this.getContainer=function(){return d},this.bind=function(t,e){"ready"===t&&b?e():a.apply(s,[t,e])},s.importDefaults=function(t){for(var e in t)s.Defaults[e]=t[e];return t.Container&&s.setContainer(t.Container),s},s.restoreDefaults=function(){return s.Defaults=p.extend({},h),s};var v=null,b=!1,x=[],g={},T={},w={},j={},C={},N=!1,E=[],O=!1,k=null,S=this.Defaults.Scope,M=1,D=function(){return""+M++},A=function(t,e){d?d.appendChild(t):e?this.getElement(e).appendChild(t):this.appendToRoot(t)}.bind(this),I=function(t,e,i,o){if(!O){var r,a=$(t),h=s.getDragManager();h&&(r=h.getElementsForDraggable(a)),null==i&&(i=n());var l=rt({elId:a,offset:e,recalc:!1,timestamp:i});if(r&&l&&l.o)for(var c in r)rt({elId:r[c].id,offset:{left:l.o.left+r[c].offset.left,top:l.o.top+r[c].offset.top},recalc:!1,timestamp:i});if(s.anchorManager.redraw(a,e,i,null,o),r)for(var u in r)s.anchorManager.redraw(r[u].id,e,i,r[u].offset,o,!0)}},P=function(t){return T[t]},W=function(t,e){var n=p.extend({},t);if(e&&p.extend(n,e),n.source&&(n.source.endpoint?n.sourceEndpoint=n.source:n.source=s.getElement(n.source)),n.target&&(n.target.endpoint?n.targetEndpoint=n.target:n.target=s.getElement(n.target)),t.uuids&&(n.sourceEndpoint=P(t.uuids[0]),n.targetEndpoint=P(t.uuids[1])),n.sourceEndpoint&&n.sourceEndpoint.isFull())i.log(s,"could not add connection; source endpoint is full");else if(n.targetEndpoint&&n.targetEndpoint.isFull())i.log(s,"could not add connection; target endpoint is full");else{if(!n.type&&n.sourceEndpoint&&(n.type=n.sourceEndpoint.connectionType),n.sourceEndpoint&&n.sourceEndpoint.connectorOverlays){n.overlays=n.overlays||[];for(var o=0,r=n.sourceEndpoint.connectorOverlays.length;o<r;o++)n.overlays.push(n.sourceEndpoint.connectorOverlays[o])}n.sourceEndpoint&&n.sourceEndpoint.scope&&(n.scope=n.sourceEndpoint.scope),!n["pointer-events"]&&n.sourceEndpoint&&n.sourceEndpoint.connectorPointerEvents&&(n["pointer-events"]=n.sourceEndpoint.connectorPointerEvents);var a=function(t,e,i,o){if(n[t]&&!n[t].endpoint&&!n[t+"Endpoint"]&&!n.newConnection){var r=i[$(n[t])];if(r=r?r[o]:null){if(!r.enabled)return!1;var a=null!=r.endpoint&&r.endpoint._jsPlumb?r.endpoint:function(t,e,i){return s.addEndpoint(t,function(t,e){var i=p.extend({},t);for(var n in e)e[n]&&(i[n]=e[n]);return i}(e,{anchor:n.anchors?n.anchors[i]:n.anchor,endpoint:n.endpoints?n.endpoints[i]:n.endpoint,paintStyle:n.endpointStyles?n.endpointStyles[i]:n.endpointStyle,hoverPaintStyle:n.endpointHoverStyles?n.endpointHoverStyles[i]:n.endpointHoverStyle}))}(n[t],r.def,e);if(a.isFull())return!1;n[t+"Endpoint"]=a,!n.scope&&r.def.scope&&(n.scope=r.def.scope),r.uniqueEndpoint?r.endpoint?a.finalEndpoint=r.endpoint:(r.endpoint=a,a.setDeleteOnEmpty(!1)):a.setDeleteOnEmpty(!0),0===e&&r.def.connectorOverlays&&(n.overlays=n.overlays||[],Array.prototype.push.apply(n.overlays,r.def.connectorOverlays))}}};if(!1!==a("source",0,this.sourceEndpointDefinitions,n.type||"default")&&!1!==a("target",1,this.targetEndpointDefinitions,n.type||"default"))return n.sourceEndpoint&&n.targetEndpoint&&(function(t,e){for(var i=n.sourceEndpoint.scope.split(/\s/),s=e.scope.split(/\s/),o=0;o<i.length;o++)for(var r=0;r<s.length;r++)if(s[r]===i[o])return!0;return!1}(0,n.targetEndpoint)||(n=null)),n}}.bind(s),L=function(t){var e=s.Defaults.ConnectionType||s.getDefaultConnectionType();t._jsPlumb=s,t.newConnection=L,t.newEndpoint=H,t.endpointsByUUID=T,t.endpointsByElement=g,t.finaliseConnection=F,t.id="con_"+D();var i=new e(t);return i.isDetachable()&&(i.endpoints[0].initDraggable("_jsPlumbSource"),i.endpoints[1].initDraggable("_jsPlumbTarget")),i},F=s.finaliseConnection=function(t,e,i,n){e=e||{},t.suspendedEndpoint||x.push(t),t.pending=null,t.endpoints[0].isTemporarySource=!1,!1!==n&&s.anchorManager.newConnection(t),I(t.source),e.doNotFireConnectionEvent||!1===e.fireEvent||s.fire("connection",{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]},i)},H=function(t,e){var i=s.Defaults.EndpointType||p.Endpoint,n=p.extend({},t);n._jsPlumb=s,n.newConnection=L,n.newEndpoint=H,n.endpointsByUUID=T,n.endpointsByElement=g,n.fireDetachEvent=G,n.elementId=e||$(n.source);var o=new i(n);return o.id="ep_"+D(),ot(n.elementId,n.source),p.headless||s.getDragManager().endpointAdded(n.source,e),o},_=function(t,e,i){var n=g[t];if(n&&n.length)for(var s=0,o=n.length;s<o;s++){for(var r=0,a=n[s].connections.length;r<a;r++)if(e(n[s].connections[r]))return;i&&i(n[s])}},R=function(t,e,i){e="block"===e;var n=null;i&&(n=function(t){t.setVisible(e,!0,!0)});var s=f(t);_(s.id,function(t){e&&i?t.endpoints[t.sourceId===s.id?1:0].isVisible()&&t.setVisible(!0):t.setVisible(e)},n)},$=function(t,e,n){if(i.isString(t))return t;if(null==t)return null;var o=s.getAttribute(t,"id");return o&&"undefined"!==o||(2===arguments.length&&void 0!==arguments[1]?o=e:(1===arguments.length||3===arguments.length&&!arguments[2])&&(o="jsPlumb_"+r+"_"+D()),n||s.setAttribute(t,"id",o)),o};this.setConnectionBeingDragged=function(t){N=t},this.isConnectionBeingDragged=function(){return N},this.getManagedElements=function(){return w},this.connectorClass="jtk-connector",this.connectorOutlineClass="jtk-connector-outline",this.connectedClass="jtk-connected",this.hoverClass="jtk-hover",this.endpointClass="jtk-endpoint",this.endpointConnectedClass="jtk-endpoint-connected",this.endpointFullClass="jtk-endpoint-full",this.endpointDropAllowedClass="jtk-endpoint-drop-allowed",this.endpointDropForbiddenClass="jtk-endpoint-drop-forbidden",this.overlayClass="jtk-overlay",this.draggingClass="jtk-dragging",this.elementDraggingClass="jtk-element-dragging",this.sourceElementDraggingClass="jtk-source-element-dragging",this.targetElementDraggingClass="jtk-target-element-dragging",this.endpointAnchorClassPrefix="jtk-endpoint-anchor",this.hoverSourceClass="jtk-source-hover",this.hoverTargetClass="jtk-target-hover",this.dragSelectClass="jtk-drag-select",this.Anchors={},this.Connectors={svg:{}},this.Endpoints={svg:{}},this.Overlays={svg:{}},this.ConnectorRenderers={},this.SVG="svg",this.addEndpoint=function(t,e,n){var o=p.extend({},n=n||{});p.extend(o,e),o.endpoint=o.endpoint||s.Defaults.Endpoint,o.paintStyle=o.paintStyle||s.Defaults.EndpointStyle;for(var r=[],a=i.isArray(t)||null!=t.length&&!i.isString(t)?t:[t],h=0,l=a.length;h<l;h++){o.source=s.getElement(a[h]),st(o.source);var c=$(o.source),u=H(o,c),f=ot(c,o.source).info.o;i.addToList(g,c,u),O||u.paint({anchorLoc:u.anchor.compute({xy:[f.left,f.top],wh:E[c],element:u,timestamp:k}),timestamp:k}),r.push(u)}return 1===r.length?r[0]:r},this.addEndpoints=function(t,e,n){for(var o=[],r=0,a=e.length;r<a;r++){var h=s.addEndpoint(t,e[r],n);i.isArray(h)?Array.prototype.push.apply(o,h):o.push(h)}return o},this.animate=function(t,e,n){if(!this.animationSupported)return!1;n=n||{};var o=s.getElement(t),r=$(o),a=p.animEvents.step,h=p.animEvents.complete;n[a]=i.wrap(n[a],function(){s.revalidate(r)}),n[h]=i.wrap(n[h],function(){s.revalidate(r)}),s.doAnimate(o,e,n)},this.checkCondition=function(t,e){var n=s.getListener(t),o=!0;if(n&&n.length>0){var r=Array.prototype.slice.call(arguments,1);try{for(var a=0,h=n.length;a<h;a++)o=o&&n[a].apply(n[a],r)}catch(e){i.log(s,"cannot check condition ["+t+"]"+e)}}return o},this.connect=function(t,e){var n,s=W(t,e);if(s){if(null==s.source&&null==s.sourceEndpoint)return void i.log("Cannot establish connection - source does not exist");if(null==s.target&&null==s.targetEndpoint)return void i.log("Cannot establish connection - target does not exist");st(s.source),n=L(s),F(n,s)}return n};var q=[{el:"source",elId:"sourceId",epDefs:"sourceEndpointDefinitions"},{el:"target",elId:"targetId",epDefs:"targetEndpointDefinitions"}],U=function(t,e,i,n){var s,o,r,a=q[i],h=t[a.elId],l=t.endpoints[i],c={index:i,originalSourceId:0===i?h:t.sourceId,newSourceId:t.sourceId,originalTargetId:1===i?h:t.targetId,newTargetId:t.targetId,connection:t};if(e.constructor===p.Endpoint)(s=e).addConnection(t),e=s.element;else if(o=$(e),r=this[a.epDefs][o],o===t[a.elId])s=null;else if(r)for(var u in r){if(!r[u].enabled)return;s=null!=r[u].endpoint&&r[u].endpoint._jsPlumb?r[u].endpoint:this.addEndpoint(e,r[u].def),r[u].uniqueEndpoint&&(r[u].endpoint=s),s.addConnection(t)}else s=t.makeEndpoint(0===i,e,o);return null!=s&&(l.detachFromConnection(t),t.endpoints[i]=s,t[a.el]=s.element,t[a.elId]=s.elementId,c[0===i?"newSourceId":"newTargetId"]=s.elementId,Y(c),n||t.repaint()),c.element=e,c}.bind(this);this.setSource=function(t,e,i){var n=U(t,e,0,i);this.anchorManager.sourceChanged(n.originalSourceId,n.newSourceId,t,n.el)},this.setTarget=function(t,e,i){var n=U(t,e,1,i);this.anchorManager.updateOtherEndpoint(n.originalSourceId,n.originalTargetId,n.newTargetId,t)},this.deleteEndpoint=function(t,e,i){var n="string"==typeof t?T[t]:t;return n&&s.deleteObject({endpoint:n,dontUpdateHover:e,deleteAttachedObjects:i}),s},this.deleteEveryEndpoint=function(){var t=s.setSuspendDrawing(!0);for(var e in g){var i=g[e];if(i&&i.length)for(var n=0,o=i.length;n<o;n++)s.deleteEndpoint(i[n],!0)}g={},w={},T={},j={},C={},s.anchorManager.reset();var r=s.getDragManager();return r&&r.reset(),t||s.setSuspendDrawing(!1),s};var G=function(t,e,i){var n=s.Defaults.ConnectionType||s.getDefaultConnectionType(),o=t.constructor===n?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t;e&&s.fire("connectionDetached",o,i),s.fire("internal.connectionDetached",o,i),s.anchorManager.connectionDetached(o)},Y=s.fireMoveEvent=function(t,e){s.fire("connectionMoved",t,e)};this.unregisterEndpoint=function(t){for(var e in t._jsPlumb.uuid&&(T[t._jsPlumb.uuid]=null),s.anchorManager.deleteEndpoint(t),g){var i=g[e];if(i){for(var n=[],o=0,r=i.length;o<r;o++)i[o]!==t&&n.push(i[o]);g[e]=n}g[e].length<1&&delete g[e]}},this.deleteConnection=function(t,e){return!(null==t||!(e=e||{}).force&&!i.functionChain(!0,!1,[[t.endpoints[0],"isDetachAllowed",[t]],[t.endpoints[1],"isDetachAllowed",[t]],[t,"isDetachAllowed",[t]],[s,"checkCondition",["beforeDetach",t]]])||(t.setHover(!1),G(t,!t.pending&&!1!==e.fireEvent,e.originalEvent),t.endpoints[0].detachFromConnection(t),t.endpoints[1].detachFromConnection(t),i.removeWithFunction(x,function(e){return t.id===e.id}),t.cleanup(),t.destroy(),0))},this.deleteEveryConnection=function(t){t=t||{};var e=x.length,i=0;return s.batch(function(){for(var n=0;n<e;n++)i+=s.deleteConnection(x[0],t)?1:0}),i},this.deleteConnectionsForElement=function(t,e){e=e||{},t=s.getElement(t);var i=$(t),n=g[i];if(n&&n.length)for(var o=0,r=n.length;o<r;o++)n[o].deleteEveryConnection(e);return s},this.deleteObject=function(t){var e={endpoints:{},connections:{},endpointCount:0,connectionCount:0},n=!1!==t.deleteAttachedObjects,o=function(i){null!=i&&null==e.connections[i.id]&&(t.dontUpdateHover||null==i._jsPlumb||i.setHover(!1),e.connections[i.id]=i,e.connectionCount++)};for(var r in t.connection?o(t.connection):function(i){if(null!=i&&null==e.endpoints[i.id]&&(t.dontUpdateHover||null==i._jsPlumb||i.setHover(!1),e.endpoints[i.id]=i,e.endpointCount++,n))for(var s=0;s<i.connections.length;s++)o(i.connections[s])}(t.endpoint),e.connections){var a=e.connections[r];if(a._jsPlumb){i.removeWithFunction(x,function(t){return a.id===t.id}),G(a,!1!==t.fireEvent&&!a.pending,t.originalEvent);var h=null==t.deleteAttachedObjects?null:!t.deleteAttachedObjects;a.endpoints[0].detachFromConnection(a,null,h),a.endpoints[1].detachFromConnection(a,null,h),a.cleanup(!0),a.destroy(!0)}}for(var l in e.endpoints){var c=e.endpoints[l];c._jsPlumb&&(s.unregisterEndpoint(c),c.cleanup(!0),c.destroy(!0))}return e};var V=function(t,e,i,n){for(var s=0,o=t.length;s<o;s++)t[s][e].apply(t[s],i);return n(t)},X=function(t,e,i){for(var n=[],s=0,o=t.length;s<o;s++)n.push([t[s][e].apply(t[s],i),t[s]]);return n},B=function(t,e,i){return function(){return V(t,e,arguments,i)}},z=function(t,e){return function(){return X(t,e,arguments)}},J=function(t,e){var i=[];if(t)if("string"==typeof t){if("*"===t)return t;i.push(t)}else if(e)i=t;else if(t.length)for(var n=0,s=t.length;n<s;n++)i.push(f(t[n]).id);else i.push(f(t).id);return i},Q=function(t,e,i){return"*"===t||(t.length>0?-1!==t.indexOf(e):!i)};this.getConnections=function(t,e){t?t.constructor===String&&(t={scope:t}):t={};for(var i=t.scope||s.getDefaultScope(),n=J(i,!0),o=J(t.source),r=J(t.target),a=!e&&n.length>1?{}:[],h=function(t,i){if(!e&&n.length>1){var s=a[t];null==s&&(s=a[t]=[]),s.push(i)}else a.push(i)},l=0,c=x.length;l<c;l++){var u=x[l],f=u.proxies&&u.proxies[0]?u.proxies[0].originalEp.elementId:u.sourceId,p=u.proxies&&u.proxies[1]?u.proxies[1].originalEp.elementId:u.targetId;Q(n,u.scope)&&Q(o,f)&&Q(r,p)&&h(u.scope,u)}return a};var Z=function(t,e){return function(i){for(var n=0,s=t.length;n<s;n++)i(t[n]);return e(t)}},K=function(t){return function(e){return t[e]}},tt=function(t,e){var i,n,s={length:t.length,each:Z(t,e),get:K(t)},o=["setHover","removeAllOverlays","setLabel","addClass","addOverlay","removeOverlay","removeOverlays","showOverlay","hideOverlay","showOverlays","hideOverlays","setPaintStyle","setHoverPaintStyle","setSuspendEvents","setParameter","setParameters","setVisible","repaint","addType","toggleType","removeType","removeClass","setType","bind","unbind"],r=["getLabel","getOverlay","isHover","getParameter","getParameters","getPaintStyle","getHoverPaintStyle","isVisible","hasType","getType","isSuspendEvents"];for(i=0,n=o.length;i<n;i++)s[o[i]]=B(t,o[i],e);for(i=0,n=r.length;i<n;i++)s[r[i]]=z(t,r[i]);return s},et=function(t){var e=tt(t,et);return p.extend(e,{setDetachable:B(t,"setDetachable",et),setReattach:B(t,"setReattach",et),setConnector:B(t,"setConnector",et),delete:function(){for(var e=0,i=t.length;e<i;e++)s.deleteConnection(t[e])},isDetachable:z(t,"isDetachable"),isReattach:z(t,"isReattach")})},it=function(t){var e=tt(t,it);return p.extend(e,{setEnabled:B(t,"setEnabled",it),setAnchor:B(t,"setAnchor",it),isEnabled:z(t,"isEnabled"),deleteEveryConnection:function(){for(var e=0,i=t.length;e<i;e++)t[e].deleteEveryConnection()},delete:function(){for(var e=0,i=t.length;e<i;e++)s.deleteEndpoint(t[e])}})};this.select=function(t){return(t=t||{}).scope=t.scope||"*",et(t.connections||s.getConnections(t,!0))},this.selectEndpoints=function(t){(t=t||{}).scope=t.scope||"*";var e=!t.element&&!t.source&&!t.target,i=e?"*":J(t.element),n=e?"*":J(t.source),s=e?"*":J(t.target),o=J(t.scope,!0),r=[];for(var a in g){var h=Q(i,a,!0),l=Q(n,a,!0),c="*"!==n,u=Q(s,a,!0),f="*"!==s;if(h||l||u)t:for(var p=0,m=g[a].length;p<m;p++){var d=g[a][p];if(Q(o,d.scope,!0)){if(c&&n.length>0&&!d.isSource||f&&s.length>0&&!d.isTarget)continue t;r.push(d)}}}return it(r)},this.getAllConnections=function(){return x},this.getDefaultScope=function(){return S},this.getEndpoint=P,this.getEndpoints=function(t){return g[f(t).id]||[]},this.getDefaultEndpointType=function(){return p.Endpoint},this.getDefaultConnectionType=function(){return p.Connection},this.getId=$,this.draw=I,this.info=f,this.appendElement=A;var nt=!1;this.isHoverSuspended=function(){return nt},this.setHoverSuspended=function(t){nt=t},this.hide=function(t,e){return R(t,"none",e),s},this.idstamp=D;var st=function(t){if(!d&&t){var e=s.getElement(t);e.offsetParent&&s.setContainer(e.offsetParent)}},ot=s.manage=function(t,e,i){return w[t]||(w[t]={el:e,endpoints:[],connections:[]},w[t].info=rt({elId:t,timestamp:k}),s.addClass(e,"jtk-managed"),i||s.fire("manageElement",{id:t,info:w[t].info,el:e})),w[t]},rt=(s.unmanage=function(t){if(w[t]){var e=w[t].el;s.removeClass(e,"jtk-managed"),delete w[t],s.fire("unmanageElement",{id:t,el:e})}},function(t){var e,i=t.timestamp,n=t.recalc,o=t.offset,r=t.elId;return O&&!i&&(i=k),!n&&i&&i===C[r]?{o:t.offset||j[r],s:E[r]}:(n||!o&&null==j[r]?null!=(e=w[r]?w[r].el:null)&&(E[r]=s.getSize(e),j[r]=s.getOffset(e),C[r]=i):(j[r]=o||j[r],null==E[r]&&null!=(e=w[r].el)&&(E[r]=s.getSize(e)),C[r]=i),j[r]&&!j[r].right&&(j[r].right=j[r].left+E[r][0],j[r].bottom=j[r].top+E[r][1],j[r].width=E[r][0],j[r].height=E[r][1],j[r].centerx=j[r].left+j[r].width/2,j[r].centery=j[r].top+j[r].height/2),{o:j[r],s:E[r]})});this.updateOffset=rt,this.init=function(){b||(s.Defaults.Container&&s.setContainer(s.Defaults.Container),s.anchorManager=new t.jsPlumb.AnchorManager({jsPlumbInstance:s}),b=!0,s.fire("ready",s))}.bind(this),this.log=v,this.jsPlumbUIComponent=l,this.makeAnchor=function(){var e,n=function(e,i){if(t.jsPlumb.Anchors[e])return new t.jsPlumb.Anchors[e](i);if(!s.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown anchor type '"+e+"'"}};if(0===arguments.length)return null;var o=arguments[0],r=arguments[1],a=null;if(o.compute&&o.getOrientation)return o;if("string"==typeof o)a=n(arguments[0],{elementId:r,jsPlumbInstance:s});else if(i.isArray(o))if(i.isArray(o[0])||i.isString(o[0]))2===o.length&&i.isObject(o[1])?i.isString(o[0])?(e=t.jsPlumb.extend({elementId:r,jsPlumbInstance:s},o[1]),a=n(o[0],e)):(e=t.jsPlumb.extend({elementId:r,jsPlumbInstance:s,anchors:o[0]},o[1]),a=new t.jsPlumb.DynamicAnchor(e)):a=new p.DynamicAnchor({anchors:o,selector:null,elementId:r,jsPlumbInstance:s});else{var h={x:o[0],y:o[1],orientation:o.length>=4?[o[2],o[3]]:[0,0],offsets:o.length>=6?[o[4],o[5]]:[0,0],elementId:r,jsPlumbInstance:s,cssClass:7===o.length?o[6]:null};(a=new t.jsPlumb.Anchor(h)).clone=function(){return new t.jsPlumb.Anchor(h)}}return a.id||(a.id="anchor_"+D()),a},this.makeAnchors=function(e,n,o){for(var r=[],a=0,h=e.length;a<h;a++)"string"==typeof e[a]?r.push(t.jsPlumb.Anchors[e[a]]({elementId:n,jsPlumbInstance:o})):i.isArray(e[a])&&r.push(s.makeAnchor(e[a],n,o));return r},this.makeDynamicAnchor=function(e,i){return new t.jsPlumb.DynamicAnchor({anchors:e,selector:i,elementId:null,jsPlumbInstance:s})},this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={};var at=function(e,n,o,r,a){var h=new l(n),c=n._jsPlumb.EndpointDropHandler({jsPlumb:s,enabled:function(){return e.def.enabled},isFull:function(){var t=s.select({target:e.id}).length;return e.def.maxConnections>0&&t>=e.def.maxConnections},element:e.el,elementId:e.id,isSource:r,isTarget:a,addClass:function(t){s.addClass(e.el,t)},removeClass:function(t){s.removeClass(e.el,t)},onDrop:function(t){t.endpoints[0].anchor.unlock()},isDropAllowed:function(){return h.isDropAllowed.apply(h,arguments)},isRedrop:function(t){return null!=t.suspendedElement&&null!=t.suspendedEndpoint&&t.suspendedEndpoint.element===e.el},getEndpoint:function(i){var o=e.def.endpoint;if(null==o||null==o._jsPlumb){var r=s.deriveEndpointAndAnchorSpec(i.getType().join(" "),!0),a=r.endpoints?t.jsPlumb.extend(n,{endpoint:e.def.def.endpoint||r.endpoints[1]}):n;r.anchors&&(a=t.jsPlumb.extend(a,{anchor:e.def.def.anchor||r.anchors[1]})),(o=s.addEndpoint(e.el,a))._mtNew=!0}if(n.uniqueEndpoint&&(e.def.endpoint=o),o.setDeleteOnEmpty(!0),i.isDetachable()&&o.initDraggable(),null!=o.anchor.positionFinder){var h=s.getUIPosition(arguments,s.getZoom()),l=s.getOffset(e.el),c=s.getSize(e.el),u=null==h?[0,0]:o.anchor.positionFinder(h,l,c,o.anchor.constructorParams);o.anchor.x=u[0],o.anchor.y=u[1]}return o},maybeCleanup:function(t){t._mtNew&&0===t.connections.length?s.deleteObject({endpoint:t}):delete t._mtNew}}),u=t.jsPlumb.dragEvents.drop;return o.scope=o.scope||n.scope||s.Defaults.Scope,o[u]=i.wrap(o[u],c,!0),o.rank=n.rank||0,a&&(o[t.jsPlumb.dragEvents.over]=function(){return!0}),!1===n.allowLoopback&&(o.canDrop=function(t){return t.getDragElement()._jsPlumbRelatedElement!==e.el}),s.initDroppable(e.el,o,"internal"),c};this.makeTarget=function(e,i,n){var o=t.jsPlumb.extend({_jsPlumb:this},n);t.jsPlumb.extend(o,i);for(var r=o.maxConnections||-1,a=function(e){var i=f(e),n=i.id,a=t.jsPlumb.extend({},o.dropOptions||{}),h=o.connectionType||"default";this.targetEndpointDefinitions[n]=this.targetEndpointDefinitions[n]||{},st(n),i.el._isJsPlumbGroup&&null==a.rank&&(a.rank=-1);var l={def:t.jsPlumb.extend({},o),uniqueEndpoint:o.uniqueEndpoint,maxConnections:r,enabled:!0};o.createEndpoint&&(l.uniqueEndpoint=!0,l.endpoint=s.addEndpoint(e,l.def),l.endpoint.setDeleteOnEmpty(!1)),i.def=l,this.targetEndpointDefinitions[n][h]=l,at(i,o,a,!0===o.isSource,!0),i.el._katavorioDrop[i.el._katavorioDrop.length-1].targetDef=l}.bind(this),h=e.length&&e.constructor!==String?e:[e],l=0,c=h.length;l<c;l++)a(h[l]);return this},this.unmakeTarget=function(t,e){var i=f(t);return s.destroyDroppable(i.el,"internal"),e||delete this.targetEndpointDefinitions[i.id],this},this.makeSource=function(e,n,o){var r=t.jsPlumb.extend({_jsPlumb:this},o);t.jsPlumb.extend(r,n);var a=r.connectionType||"default",h=s.deriveEndpointAndAnchorSpec(a);r.endpoint=r.endpoint||h.endpoints[0],r.anchor=r.anchor||h.anchors[0];for(var l=r.maxConnections||-1,u=r.onMaxConnections,p=function(n){var o=n.id,h=this.getElement(n.el);this.sourceEndpointDefinitions[o]=this.sourceEndpointDefinitions[o]||{},st(o);var f={def:t.jsPlumb.extend({},r),uniqueEndpoint:r.uniqueEndpoint,maxConnections:l,enabled:!0};r.createEndpoint&&(f.uniqueEndpoint=!0,f.endpoint=s.addEndpoint(e,f.def),f.endpoint.setDeleteOnEmpty(!1)),this.sourceEndpointDefinitions[o][a]=f,n.def=f;var p=t.jsPlumb.dragEvents.stop,m=t.jsPlumb.dragEvents.drag,d=t.jsPlumb.extend({},r.dragOptions||{}),y=d.drag,v=d.stop,b=null,x=!1;d.scope=d.scope||r.scope,d[m]=i.wrap(d[m],function(){y&&y.apply(this,arguments),x=!1}),d[p]=i.wrap(d[p],function(){if(v&&v.apply(this,arguments),this.currentlyDragging=!1,null!=b._jsPlumb){var t=r.anchor||this.Defaults.Anchor,e=b.anchor,i=b.connections[0],n=this.makeAnchor(t,o,this),a=b.element;if(null!=n.positionFinder){var h=s.getOffset(a),l=this.getSize(a),c={left:h.left+e.x*l[0],top:h.top+e.y*l[1]},u=n.positionFinder(c,h,l,n.constructorParams);n.x=u[0],n.y=u[1]}b.setAnchor(n,!0),b.repaint(),this.repaint(b.elementId),null!=i&&this.repaint(i.targetId)}}.bind(this));var g=function(e){if(3!==e.which&&2!==e.button){var f=this.sourceEndpointDefinitions[o][a];if(f.enabled){if(o=this.getId(this.getElement(n.el)),r.filter&&!1===(i.isString(r.filter)?function(t,i,s,o,a){for(var h=e.target||e.srcElement,l=!1,c=o.getSelector(n.el,r.filter),u=0;u<c.length;u++)if(c[u]===h){l=!0;break}return a?!l:l}(0,0,0,this,r.filterExclude):r.filter(e,n.el)))return;var p=this.select({source:o}).length;if(f.maxConnections>=0&&p>=f.maxConnections)return u&&u({element:n.el,maxConnections:l},e),!1;var m=t.jsPlumb.getPositionOnElement(e,h,c),y={};t.jsPlumb.extend(y,f.def),y.isTemporarySource=!0,y.anchor=[m[0],m[1],0,0],y.dragOptions=d,f.def.scope&&(y.scope=f.def.scope),b=this.addEndpoint(o,y),x=!0,b.setDeleteOnEmpty(!0),f.uniqueEndpoint&&(f.endpoint?b.finalEndpoint=f.endpoint:(f.endpoint=b,b.setDeleteOnEmpty(!1)));var v=function(){s.off(b.canvas,"mouseup",v),s.off(n.el,"mouseup",v),x&&(x=!1,s.deleteEndpoint(b))};s.on(b.canvas,"mouseup",v),s.on(n.el,"mouseup",v);var g={};if(f.def.extract)for(var T in f.def.extract){var w=(e.srcElement||e.target).getAttribute(T);w&&(g[f.def.extract[T]]=w)}s.trigger(b.canvas,"mousedown",e,g),i.consume(e)}}}.bind(this);this.on(n.el,"mousedown",g),f.trigger=g,r.filter&&(i.isString(r.filter)||i.isFunction(r.filter))&&s.setDragFilter(n.el,r.filter);var T=t.jsPlumb.extend({},r.dropOptions||{});at(n,r,T,!0,!0===r.isTarget)}.bind(this),m=e.length&&e.constructor!==String?e:[e],d=0,y=m.length;d<y;d++)p(f(m[d]));return this},this.unmakeSource=function(t,e,i){var n=f(t);s.destroyDroppable(n.el,"internal");var o=this.sourceEndpointDefinitions[n.id];if(o)for(var r in o)if(null==e||e===r){var a=o[r].trigger;a&&s.off(n.el,"mousedown",a),i||delete this.sourceEndpointDefinitions[n.id][r]}return this},this.unmakeEverySource=function(){for(var t in this.sourceEndpointDefinitions)s.unmakeSource(t,null,!0);return this.sourceEndpointDefinitions={},this};var ht=function(t,e,n){e=i.isArray(e)?e:[e];var s=$(t);n=n||"default";for(var o=0;o<e.length;o++){var r=this[e[o]][s];if(r&&r[n])return r[n].def.scope||this.Defaults.Scope}}.bind(this),lt=function(t,e,n,s){n=i.isArray(n)?n:[n];var o=$(t);s=s||"default";for(var r=0;r<n.length;r++){var a=this[n[r]][o];a&&a[s]&&(a[s].def.scope=e)}}.bind(this);this.getScope=function(t){return ht(t,["sourceEndpointDefinitions","targetEndpointDefinitions"])},this.getSourceScope=function(t){return ht(t,"sourceEndpointDefinitions")},this.getTargetScope=function(t){return ht(t,"targetEndpointDefinitions")},this.setScope=function(t,e,i){this.setSourceScope(t,e,i),this.setTargetScope(t,e,i)},this.setSourceScope=function(t,e,i){lt(t,e,"sourceEndpointDefinitions",i),this.setDragScope(t,e)},this.setTargetScope=function(t,e,i){lt(t,e,"targetEndpointDefinitions",i),this.setDropScope(t,e)},this.unmakeEveryTarget=function(){for(var t in this.targetEndpointDefinitions)s.unmakeTarget(t,!0);return this.targetEndpointDefinitions={},this};var ct=function(t,e,n,o,r){var a,h,l,c="source"===t?this.sourceEndpointDefinitions:this.targetEndpointDefinitions;if(r=r||"default",e.length&&!i.isString(e)){a=[];for(var u=0,p=e.length;u<p;u++)c[(h=f(e[u])).id]&&c[h.id][r]&&(a[u]=c[h.id][r].enabled,c[h.id][r].enabled=l=o?!a[u]:n,s[l?"removeClass":"addClass"](h.el,"jtk-"+t+"-disabled"))}else{var m=(h=f(e)).id;c[m]&&c[m][r]&&(a=c[m][r].enabled,c[m][r].enabled=l=o?!a:n,s[l?"removeClass":"addClass"](h.el,"jtk-"+t+"-disabled"))}return a}.bind(this),ut=function(t,e){return i.isString(t)||!t.length?e.apply(this,[t]):t.length?e.apply(this,[t[0]]):void 0}.bind(this);this.toggleSourceEnabled=function(t,e){return ct("source",t,null,!0,e),this.isSourceEnabled(t,e)},this.setSourceEnabled=function(t,e,i){return ct("source",t,e,null,i)},this.isSource=function(t,e){return e=e||"default",ut(t,function(t){var i=this.sourceEndpointDefinitions[f(t).id];return null!=i&&null!=i[e]}.bind(this))},this.isSourceEnabled=function(t,e){return e=e||"default",ut(t,function(t){var i=this.sourceEndpointDefinitions[f(t).id];return i&&i[e]&&!0===i[e].enabled}.bind(this))},this.toggleTargetEnabled=function(t,e){return ct("target",t,null,!0,e),this.isTargetEnabled(t,e)},this.isTarget=function(t,e){return e=e||"default",ut(t,function(t){var i=this.targetEndpointDefinitions[f(t).id];return null!=i&&null!=i[e]}.bind(this))},this.isTargetEnabled=function(t,e){return e=e||"default",ut(t,function(t){var i=this.targetEndpointDefinitions[f(t).id];return i&&i[e]&&!0===i[e].enabled}.bind(this))},this.setTargetEnabled=function(t,e,i){return ct("target",t,e,null,i)},this.ready=function(t){s.bind("ready",t)};var ft=function(t,e){if("object"==typeof t&&t.length)for(var i=0,n=t.length;i<n;i++)e(t[i]);else e(t);return s};this.repaint=function(t,e,i){return ft(t,function(t){I(t,e,i)})},this.revalidate=function(t,e,i){return ft(t,function(t){var n=i?t:s.getId(t);s.updateOffset({elId:n,recalc:!0,timestamp:e});var o=s.getDragManager();o&&o.updateOffsets(n),s.repaint(t)})},this.repaintEverything=function(){var t,e=n();for(t in g)s.updateOffset({elId:t,recalc:!0,timestamp:e});for(t in g)I(t,null,e);return this},this.removeAllEndpoints=function(t,e,i){i=i||[];var n=function(t){var o,r,a=f(t),h=g[a.id];if(h)for(i.push(a),o=0,r=h.length;o<r;o++)s.deleteEndpoint(h[o],!1);if(delete g[a.id],e&&a.el&&3!==a.el.nodeType&&8!==a.el.nodeType)for(o=0,r=a.el.childNodes.length;o<r;o++)n(a.el.childNodes[o])};return n(t),this};var pt=function(t,e){s.removeAllEndpoints(t.id,!0,e);for(var i=s.getDragManager(),n=function(t){i&&i.elementRemoved(t.id),s.anchorManager.clearFor(t.id),s.anchorManager.removeFloatingConnection(t.id),s.isSource(t.el)&&s.unmakeSource(t.el),s.isTarget(t.el)&&s.unmakeTarget(t.el),s.destroyDraggable(t.el),s.destroyDroppable(t.el),delete s.floatingConnections[t.id],delete w[t.id],delete j[t.id],t.el&&(s.removeElement(t.el),t.el._jsPlumb=null)},o=1;o<e.length;o++)n(e[o]);n(t)};this.remove=function(t,e){var i=f(t),n=[];return i.text?i.el.parentNode.removeChild(i.el):i.id&&s.batch(function(){pt(i,n)},!0===e),s},this.empty=function(t,e){var i=[],n=function(t,e){var s=f(t);if(s.text)s.el.parentNode.removeChild(s.el);else if(s.el){for(;s.el.childNodes.length>0;)n(s.el.childNodes[0]);e||pt(s,i)}};return s.batch(function(){n(t,!0)},!1===e),s},this.reset=function(t){s.silently(function(){nt=!1,s.removeAllGroups(),s.removeGroupManager(),s.deleteEveryEndpoint(),t||s.unbind(),this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={},x.length=0,this.doReset&&this.doReset()}.bind(this))};var mt=function(t){t.canvas&&t.canvas.parentNode&&t.canvas.parentNode.removeChild(t.canvas),t.cleanup(),t.destroy()};this.clear=function(){s.select().each(mt),s.selectEndpoints().each(mt),g={},T={}},this.setDefaultScope=function(t){return S=t,s},this.deriveEndpointAndAnchorSpec=function(t,e){for(var i=((e?"":"default ")+t).split(/[\s]/),n=null,o=null,r=null,a=null,h=0;h<i.length;h++){var l=s.getType(i[h],"connection");l&&(l.endpoints&&(n=l.endpoints),l.endpoint&&(o=l.endpoint),l.anchors&&(a=l.anchors),l.anchor&&(r=l.anchor))}return{endpoints:n||[o,o],anchors:a||[r,r]}},this.setId=function(t,e,n){var s;i.isString(t)?s=t:(t=this.getElement(t),s=this.getId(t));var o=this.getConnections({source:s,scope:"*"},!0),r=this.getConnections({target:s,scope:"*"},!0);e=""+e,n?t=this.getElement(e):(t=this.getElement(s),this.setAttribute(t,"id",e)),g[e]=g[s]||[];for(var a=0,h=g[e].length;a<h;a++)g[e][a].setElementId(e),g[e][a].setReferenceElement(t);delete g[s],this.sourceEndpointDefinitions[e]=this.sourceEndpointDefinitions[s],delete this.sourceEndpointDefinitions[s],this.targetEndpointDefinitions[e]=this.targetEndpointDefinitions[s],delete this.targetEndpointDefinitions[s],this.anchorManager.changeId(s,e);var l=this.getDragManager();l&&l.changeId(s,e),w[e]=w[s],delete w[s];var c=function(i,n,s){for(var o=0,r=i.length;o<r;o++)i[o].endpoints[n].setElementId(e),i[o].endpoints[n].setReferenceElement(t),i[o][s+"Id"]=e,i[o][s]=t};c(o,0,"source"),c(r,1,"target"),this.repaint(e)},this.setDebugLog=function(t){v=t},this.setSuspendDrawing=function(t,e){var i=O;return O=t,k=t?(new Date).getTime():null,e&&this.repaintEverything(),i},this.isSuspendDrawing=function(){return O},this.getSuspendedAt=function(){return k},this.batch=function(t,e){var n=this.isSuspendDrawing();n||this.setSuspendDrawing(!0);try{t()}catch(t){i.log("Function run while suspended failed",t)}n||this.setSuspendDrawing(!1,!e)},this.doWhileSuspended=this.batch,this.getCachedData=function(t){var e=j[t];return e?{o:e,s:E[t]}:rt({elId:t})},this.timestamp=n,this.show=function(t,e){return R(t,"block",e),s},this.toggleVisible=function(t,e){var i=null;e&&(i=function(t){var e=t.isVisible();t.setVisible(!e)}),_(t,function(t){var e=t.isVisible();t.setVisible(!e)},i)},this.addListener=this.bind;var dt=[];this.registerFloatingConnection=function(t,e,n){dt[t.id]=e,i.addToList(g,t.id,n)},this.getFloatingConnectionFor=function(t){return dt[t]},this.listManager=new t.jsPlumbListManager(this)};i.extend(t.jsPlumbInstance,i.EventGenerator,{setAttribute:function(t,e,i){this.setAttribute(t,e,i)},getAttribute:function(e,i){return this.getAttribute(t.jsPlumb.getElement(e),i)},convertToFullOverlaySpec:function(t){return i.isString(t)&&(t=[t,{}]),t[1].id=t[1].id||i.uuid(),t},registerConnectionType:function(e,i){if(this._connectionTypes[e]=t.jsPlumb.extend({},i),i.overlays){for(var n={},s=0;s<i.overlays.length;s++){var o=this.convertToFullOverlaySpec(i.overlays[s]);n[o[1].id]=o}this._connectionTypes[e].overlays=n}},registerConnectionTypes:function(t){for(var e in t)this.registerConnectionType(e,t[e])},registerEndpointType:function(e,i){if(this._endpointTypes[e]=t.jsPlumb.extend({},i),i.overlays){for(var n={},s=0;s<i.overlays.length;s++){var o=this.convertToFullOverlaySpec(i.overlays[s]);n[o[1].id]=o}this._endpointTypes[e].overlays=n}},registerEndpointTypes:function(t){for(var e in t)this.registerEndpointType(e,t[e])},getType:function(t,e){return"connection"===e?this._connectionTypes[t]:this._endpointTypes[t]},setIdChanged:function(t,e){this.setId(t,e,!0)},setParent:function(t,e){var i=this.getElement(t),n=this.getId(i),s=this.getElement(e),o=this.getId(s),r=this.getDragManager();i.parentNode.removeChild(i),s.appendChild(i),r&&r.setParent(i,n,s,o)},extend:function(t,e,i){var n;if(i)for(n=0;n<i.length;n++)t[i[n]]=e[i[n]];else for(n in e)t[n]=e[n];return t},floatingConnections:{},getFloatingAnchorIndex:function(t){return t.endpoints[0].isFloating()?0:t.endpoints[1].isFloating()?1:-1},proxyConnection:function(t,e,i,n,s,o){var r,a=t.endpoints[e].elementId,h=t.endpoints[e];t.proxies=t.proxies||[],(r=t.proxies[e]?t.proxies[e].ep:this.addEndpoint(i,{endpoint:s(t,e),anchor:o(t,e),parameters:{isProxyEndpoint:!0}})).setDeleteOnEmpty(!0),t.proxies[e]={ep:r,originalEp:h},0===e?this.anchorManager.sourceChanged(a,n,t,i):(this.anchorManager.updateOtherEndpoint(t.endpoints[0].elementId,a,n,t),t.target=i,t.targetId=n),h.detachFromConnection(t,null,!0),r.connections=[t],t.endpoints[e]=r,h.setVisible(!1),t.setVisible(!0),this.revalidate(i)},unproxyConnection:function(t,e,i){if(null!=t._jsPlumb&&null!=t.proxies&&null!=t.proxies[e]){var n=t.proxies[e].originalEp.element,s=t.proxies[e].originalEp.elementId;t.endpoints[e]=t.proxies[e].originalEp,0===e?this.anchorManager.sourceChanged(i,s,t,n):(this.anchorManager.updateOtherEndpoint(t.endpoints[0].elementId,i,s,t),t.target=n,t.targetId=s),t.proxies[e].ep.detachFromConnection(t,null),t.proxies[e].originalEp.addConnection(t),t.isVisible()&&t.proxies[e].originalEp.setVisible(!0),delete t.proxies[e]}}});var p=new f;t.jsPlumb=p,p.getInstance=function(t,e){var i=new f(t);if(e)for(var n in e)i[n]=e[n];return i.init(),i},p.each=function(t,e){if(null!=t)if("string"==typeof t)e(p.getElement(t));else if(null!=t.length)for(var i=0;i<t.length;i++)e(p.getElement(t[i]));else e(t)},e.jsPlumb=p}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,e=t.jsPlumb,i=t.jsPlumbUtil;e.OverlayCapableJsPlumbUIComponent=function(e){t.jsPlumbUIComponent.apply(this,arguments),this._jsPlumb.overlays={},this._jsPlumb.overlayPositions={},e.label&&(this.getDefaultType().overlays.__label=["Label",{label:e.label,location:e.labelLocation||this.defaultLabelLocation||.5,labelStyle:e.labelStyle||this._jsPlumb.instance.Defaults.LabelStyle,id:"__label"}]),this.setListenerComponent=function(t){if(this._jsPlumb)for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e].setListenerComponent(t)}},e.OverlayCapableJsPlumbUIComponent.applyType=function(t,e){if(e.overlays){var i,n={};for(i in e.overlays){var s=t._jsPlumb.overlays[e.overlays[i][1].id];if(s)s.updateFrom(e.overlays[i][1]),n[e.overlays[i][1].id]=!0;else{var o=t.getCachedTypeItem("overlay",e.overlays[i][1].id);null!=o?(o.reattach(t._jsPlumb.instance,t),o.setVisible(!0),o.updateFrom(e.overlays[i][1]),t._jsPlumb.overlays[o.id]=o):o=t.addOverlay(e.overlays[i],!0),n[o.id]=!0}}for(i in t._jsPlumb.overlays)null==n[t._jsPlumb.overlays[i].id]&&t.removeOverlay(t._jsPlumb.overlays[i].id,!0)}},i.extend(e.OverlayCapableJsPlumbUIComponent,t.jsPlumbUIComponent,{setHover:function(t){if(this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged())for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e][t?"addClass":"removeClass"](this._jsPlumb.instance.hoverClass)},addOverlay:function(t,n){var s=function(t,n){var s=null;if(i.isArray(n)){var o=n[0],r=e.extend({component:t,_jsPlumb:t._jsPlumb.instance},n[1]);3===n.length&&e.extend(r,n[2]),s=new(e.Overlays[t._jsPlumb.instance.getRenderMode()][o])(r)}else s=n.constructor===String?new(e.Overlays[t._jsPlumb.instance.getRenderMode()][n])({component:t,_jsPlumb:t._jsPlumb.instance}):n;return s.id=s.id||i.uuid(),t.cacheTypeItem("overlay",s,s.id),t._jsPlumb.overlays[s.id]=s,s}(this,t);return n||this.repaint(),s},getOverlay:function(t){return this._jsPlumb.overlays[t]},getOverlays:function(){return this._jsPlumb.overlays},hideOverlay:function(t){var e=this.getOverlay(t);e&&e.hide()},hideOverlays:function(){for(var t in this._jsPlumb.overlays)this._jsPlumb.overlays[t].hide()},showOverlay:function(t){var e=this.getOverlay(t);e&&e.show()},showOverlays:function(){for(var t in this._jsPlumb.overlays)this._jsPlumb.overlays[t].show()},removeAllOverlays:function(t){for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e].cleanup&&this._jsPlumb.overlays[e].cleanup();this._jsPlumb.overlays={},this._jsPlumb.overlayPositions=null,this._jsPlumb.overlayPlacements={},t||this.repaint()},removeOverlay:function(t,e){var i=this._jsPlumb.overlays[t];i&&(i.setVisible(!1),!e&&i.cleanup&&i.cleanup(),delete this._jsPlumb.overlays[t],this._jsPlumb.overlayPositions&&delete this._jsPlumb.overlayPositions[t],this._jsPlumb.overlayPlacements&&delete this._jsPlumb.overlayPlacements[t])},removeOverlays:function(){for(var t=0,e=arguments.length;t<e;t++)this.removeOverlay(arguments[t])},moveParent:function(t){if(this.bgCanvas&&(this.bgCanvas.parentNode.removeChild(this.bgCanvas),t.appendChild(this.bgCanvas)),this.canvas&&this.canvas.parentNode)for(var e in this.canvas.parentNode.removeChild(this.canvas),t.appendChild(this.canvas),this._jsPlumb.overlays)if(this._jsPlumb.overlays[e].isAppendedAtTopLevel){var i=this._jsPlumb.overlays[e].getElement();i.parentNode.removeChild(i),t.appendChild(i)}},getLabel:function(){var t=this.getOverlay("__label");return null!=t?t.getLabel():null},getLabelOverlay:function(){return this.getOverlay("__label")},setLabel:function(t){var i=this.getOverlay("__label");i?t.constructor===String||t.constructor===Function?i.setLabel(t):(t.label&&i.setLabel(t.label),t.location&&i.setLocation(t.location)):(i=function(t,i){var n=e.extend({cssClass:i.cssClass,labelStyle:t.labelStyle,id:"__label",component:t,_jsPlumb:t._jsPlumb.instance},i);return new(e.Overlays[t._jsPlumb.instance.getRenderMode()].Label)(n)}(this,t.constructor===String||t.constructor===Function?{label:t}:t),this._jsPlumb.overlays.__label=i),this._jsPlumb.instance.isSuspendDrawing()||this.repaint()},cleanup:function(t){for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e].cleanup(t),this._jsPlumb.overlays[e].destroy(t);t&&(this._jsPlumb.overlays={},this._jsPlumb.overlayPositions=null)},setVisible:function(t){this[t?"showOverlays":"hideOverlays"]()},setAbsoluteOverlayPosition:function(t,e){this._jsPlumb.overlayPositions[t.id]=e},getAbsoluteOverlayPosition:function(t){return this._jsPlumb.overlayPositions?this._jsPlumb.overlayPositions[t.id]:null},_clazzManip:function(t,e,i){if(!i)for(var n in this._jsPlumb.overlays)this._jsPlumb.overlays[n][t+"Class"](e)},addClass:function(t,e){this._clazzManip("add",t,e)},removeClass:function(t,e){this._clazzManip("remove",t,e)}})}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,e=this.jsPlumbUtil,i=function(t,e,i){var n=!1;return{drag:function(){if(n)return n=!1,!0;if(e.element){var s=i.getUIPosition(arguments,i.getZoom());null!=s&&i.setPosition(e.element,s),i.repaint(e.element,s),t.paint({anchorPoint:t.anchor.getCurrentLocation({element:t})})}},stopDrag:function(){n=!0}}},n=function(t,e,i,n){var s=e.createElement("div",{position:"absolute"});e.appendElement(s);var o=e.getId(s);e.setPosition(s,i),s.style.width=n[0]+"px",s.style.height=n[1]+"px",e.manage(o,s,!0),t.id=o,t.element=s},s=function(e,i,n,s,o,r,a,h){return a({paintStyle:e,endpoint:n,anchor:new t.FloatingAnchor({reference:i,referenceCanvas:s,jsPlumbInstance:r}),source:o,scope:h})},o=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],r=function(t,e){var i=0;if(null!=e)for(var n=0;n<t.connections.length;n++)if(t.connections[n].sourceId===e||t.connections[n].targetId===e){i=n;break}return t.connections[i]};t.Endpoint=function(a){var h=a._jsPlumb,l=a.newConnection,c=a.newEndpoint;this.idPrefix="_jsplumb_e_",this.defaultLabelLocation=[.5,.5],this.defaultOverlayKeys=["Overlays","EndpointOverlays"],t.OverlayCapableJsPlumbUIComponent.apply(this,arguments),this.appendToDefaultType({connectionType:a.connectionType,maxConnections:null==a.maxConnections?this._jsPlumb.instance.Defaults.MaxConnections:a.maxConnections,paintStyle:a.endpointStyle||a.paintStyle||a.style||this._jsPlumb.instance.Defaults.EndpointStyle||t.Defaults.EndpointStyle,hoverPaintStyle:a.endpointHoverStyle||a.hoverPaintStyle||this._jsPlumb.instance.Defaults.EndpointHoverStyle||t.Defaults.EndpointHoverStyle,connectorStyle:a.connectorStyle,connectorHoverStyle:a.connectorHoverStyle,connectorClass:a.connectorClass,connectorHoverClass:a.connectorHoverClass,connectorOverlays:a.connectorOverlays,connector:a.connector,connectorTooltip:a.connectorTooltip}),this._jsPlumb.enabled=!(!1===a.enabled),this._jsPlumb.visible=!0,this.element=t.getElement(a.source),this._jsPlumb.uuid=a.uuid,this._jsPlumb.floatingEndpoint=null,this._jsPlumb.uuid&&(a.endpointsByUUID[this._jsPlumb.uuid]=this),this.elementId=a.elementId,this.dragProxy=a.dragProxy,this._jsPlumb.connectionCost=a.connectionCost,this._jsPlumb.connectionsDirected=a.connectionsDirected,this._jsPlumb.currentAnchorClass="",this._jsPlumb.events={};var u=!0===a.deleteOnEmpty;this.setDeleteOnEmpty=function(t){u=t};var f=function(){var e=h.endpointAnchorClassPrefix+"-"+this._jsPlumb.currentAnchorClass;this._jsPlumb.currentAnchorClass=this.anchor.getCssClass();var i=h.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"");this.removeClass(e),this.addClass(i),t.updateClasses(this.element,i,e)}.bind(this);this.prepareAnchor=function(t){var e=this._jsPlumb.instance.makeAnchor(t,this.elementId,h);return e.bind("anchorChanged",function(t){this.fire("anchorChanged",{endpoint:this,anchor:t}),f()}.bind(this)),e},this.setPreparedAnchor=function(t,e){return this._jsPlumb.instance.continuousAnchorFactory.clear(this.elementId),this.anchor=t,f(),e||this._jsPlumb.instance.repaint(this.elementId),this},this.setAnchor=function(t,e){var i=this.prepareAnchor(t);return this.setPreparedAnchor(i,e),this};var p=function(t){if(this.connections.length>0)for(var e=0;e<this.connections.length;e++)this.connections[e].setHover(t,!1);else this.setHover(t)}.bind(this);this.bind("mouseover",function(){p(!0)}),this.bind("mouseout",function(){p(!1)}),a._transient||this._jsPlumb.instance.anchorManager.add(this,this.elementId),this.prepareEndpoint=function(i,n){var s,o=function(e,i){var n=h.getRenderMode();if(t.Endpoints[n][e])return new t.Endpoints[n][e](i);if(!h.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown endpoint type '"+e+"'"}},r={_jsPlumb:this._jsPlumb.instance,cssClass:a.cssClass,container:a.container,tooltip:a.tooltip,connectorTooltip:a.connectorTooltip,endpoint:this};return e.isString(i)?s=o(i,r):e.isArray(i)?(r=e.merge(i[1],r),s=o(i[0],r)):s=i.clone(),s.clone=function(){return e.isString(i)?o(i,r):e.isArray(i)?(r=e.merge(i[1],r),o(i[0],r)):void 0}.bind(this),s.typeId=n,s},this.setEndpoint=function(t){var e=this.prepareEndpoint(t);this.setPreparedEndpoint(e,!0)},this.setPreparedEndpoint=function(t){null!=this.endpoint&&(this.endpoint.cleanup(),this.endpoint.destroy()),this.endpoint=t,this.type=this.endpoint.type,this.canvas=this.endpoint.canvas},t.extend(this,a,o),this.isSource=a.isSource||!1,this.isTemporarySource=a.isTemporarySource||!1,this.isTarget=a.isTarget||!1,this.connections=a.connections||[],this.connectorPointerEvents=a["connector-pointer-events"],this.scope=a.scope||h.getDefaultScope(),this.timestamp=null,this.reattachConnections=a.reattach||h.Defaults.ReattachConnections,this.connectionsDetachable=h.Defaults.ConnectionsDetachable,!1!==a.connectionsDetachable&&!1!==a.detachable||(this.connectionsDetachable=!1),this.dragAllowedWhenFull=!1!==a.dragAllowedWhenFull,a.onMaxConnections&&this.bind("maxConnections",a.onMaxConnections),this.addConnection=function(t){this.connections.push(t),this[(this.connections.length>0?"add":"remove")+"Class"](h.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](h.endpointFullClass)},this.detachFromConnection=function(t,e,i){(e=null==e?this.connections.indexOf(t):e)>=0&&(this.connections.splice(e,1),this[(this.connections.length>0?"add":"remove")+"Class"](h.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](h.endpointFullClass)),!i&&u&&0===this.connections.length&&h.deleteObject({endpoint:this,fireEvent:!1,deleteAttachedObjects:!0!==i})},this.deleteEveryConnection=function(t){for(var e=this.connections.length,i=0;i<e;i++)h.deleteConnection(this.connections[0],t)},this.detachFrom=function(t){for(var e=[],i=0;i<this.connections.length;i++)this.connections[i].endpoints[1]!==t&&this.connections[i].endpoints[0]!==t||e.push(this.connections[i]);for(var n=0,s=e.length;n<s;n++)h.deleteConnection(e[0]);return this},this.getElement=function(){return this.element},this.setElement=function(i){var n=this._jsPlumb.instance.getId(i),s=this.elementId;return e.removeWithFunction(a.endpointsByElement[this.elementId],function(t){return t.id===this.id}.bind(this)),this.element=t.getElement(i),this.elementId=h.getId(this.element),h.anchorManager.rehomeEndpoint(this,s,this.element),h.dragManager.endpointAdded(this.element),e.addToList(a.endpointsByElement,n,this),this},this.makeInPlaceCopy=function(){var t=this.anchor.getCurrentLocation({element:this}),e=this.anchor.getOrientation(this),i=this.anchor.getCssClass();return c({dropOptions:a.dropOptions,anchor:{bind:function(){},compute:function(){return[t[0],t[1]]},getCurrentLocation:function(){return[t[0],t[1]]},getOrientation:function(){return e},getCssClass:function(){return i}},source:this.element,paintStyle:this.getPaintStyle(),endpoint:a.hideOnDrag?"Blank":this.endpoint,_transient:!0,scope:this.scope,reference:this})},this.connectorSelector=function(){return this.connections[0]},this.setStyle=this.setPaintStyle,this.paint=function(t){var e=(t=t||{}).timestamp,i=!(!1===t.recalc);if(!e||this.timestamp!==e){var n=h.updateOffset({elId:this.elementId,timestamp:e}),s=t.offset?t.offset.o:n.o;if(null!=s){var o=t.anchorPoint,a=t.connectorPaintStyle;if(null==o){var l={xy:[s.left,s.top],wh:t.dimensions||n.s,element:this,timestamp:e};if(i&&this.anchor.isDynamic&&this.connections.length>0){var c=r(this,t.elementWithPrecedence),u=c.endpoints[0]===this?1:0,f=h.getCachedData(0===u?c.sourceId:c.targetId),p=f.o,m=f.s;l.index=0===u?1:0,l.connection=c,l.txy=[p.left,p.top],l.twh=m,l.tElement=c.endpoints[u]}else this.connections.length>0&&(l.connection=this.connections[0]);o=this.anchor.compute(l)}for(var d in this.endpoint.compute(o,this.anchor.getOrientation(this),this._jsPlumb.paintStyleInUse,a||this.paintStyleInUse),this.endpoint.paint(this._jsPlumb.paintStyleInUse,this.anchor),this.timestamp=e,this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(d)){var y=this._jsPlumb.overlays[d];y.isVisible()&&(this._jsPlumb.overlayPlacements[d]=y.draw(this.endpoint,this._jsPlumb.paintStyleInUse),y.paint(this._jsPlumb.overlayPlacements[d]))}}}},this.getTypeDescriptor=function(){return"endpoint"},this.isVisible=function(){return this._jsPlumb.visible},this.repaint=this.paint;var m=!1;this.initDraggable=function(){if(!m&&t.isDragSupported(this.element)){var o,r={id:null,element:null},u=null,f=!1,p=null,d=i(this,r,h),y=a.dragOptions||{},v=t.dragEvents.start,b=t.dragEvents.stop,x=t.dragEvents.drag,g=t.dragEvents.beforeStart,T=function(){u=this.connectorSelector();var e=!0;this.isEnabled()||(e=!1),null!=u||this.isSource||this.isTemporarySource||(e=!1),!this.isSource||!this.isFull()||null!=u&&this.dragAllowedWhenFull||(e=!1),null==u||u.isDetachable(this)||(this.isFull()?e=!1:u=null);var i=h.checkCondition(null==u?"beforeDrag":"beforeStartDetach",{endpoint:this,source:this.element,sourceId:this.elementId,connection:u});if(!1===i?e=!1:"object"==typeof i?t.extend(i,o||{}):i=o||{},!1===e)return h.stopDrag&&h.stopDrag(this.canvas),d.stopDrag(),!1;for(var m=0;m<this.connections.length;m++)this.connections[m].setHover(!1);this.addClass("endpointDrag"),h.setConnectionBeingDragged(!0),u&&!this.isFull()&&this.isSource&&(u=null),h.updateOffset({elId:this.elementId});var y=this._jsPlumb.instance.getOffset(this.canvas),v=this.canvas,b=this._jsPlumb.instance.getSize(this.canvas);n(r,h,y,b),h.setAttributes(this.canvas,{dragId:r.id,elId:this.elementId});var x=this.dragProxy||this.endpoint;if(null==this.dragProxy&&null!=this.connectionType){var g=this._jsPlumb.instance.deriveEndpointAndAnchorSpec(this.connectionType);g.endpoints[1]&&(x=g.endpoints[1])}var T=this._jsPlumb.instance.makeAnchor("Center");T.isFloating=!0,this._jsPlumb.floatingEndpoint=s(this.getPaintStyle(),T,x,this.canvas,r.element,h,c,this.scope);var w=this._jsPlumb.floatingEndpoint.anchor;if(null==u)this.setHover(!1,!1),(u=l({sourceEndpoint:this,targetEndpoint:this._jsPlumb.floatingEndpoint,source:this.element,target:r.element,anchors:[this.anchor,this._jsPlumb.floatingEndpoint.anchor],paintStyle:a.connectorStyle,hoverPaintStyle:a.connectorHoverStyle,connector:a.connector,overlays:a.connectorOverlays,type:this.connectionType,cssClass:this.connectorClass,hoverClass:this.connectorHoverClass,scope:a.scope,data:i})).pending=!0,u.addClass(h.draggingClass),this._jsPlumb.floatingEndpoint.addClass(h.draggingClass),this._jsPlumb.floatingEndpoint.anchor=w,h.fire("connectionDrag",u),h.anchorManager.newConnection(u);else{f=!0,u.setHover(!1);var j=u.endpoints[0].id===this.id?0:1;this.detachFromConnection(u,null,!0);var C=h.getDragScope(v);h.setAttribute(this.canvas,"originalScope",C),h.fire("connectionDrag",u),0===j?(p=[u.source,u.sourceId,v,C],h.anchorManager.sourceChanged(u.endpoints[j].elementId,r.id,u,r.element)):(p=[u.target,u.targetId,v,C],u.target=r.element,u.targetId=r.id,h.anchorManager.updateOtherEndpoint(u.sourceId,u.endpoints[j].elementId,u.targetId,u)),u.suspendedEndpoint=u.endpoints[j],u.suspendedElement=u.endpoints[j].getElement(),u.suspendedElementId=u.endpoints[j].elementId,u.suspendedElementType=0===j?"source":"target",u.suspendedEndpoint.setHover(!1),this._jsPlumb.floatingEndpoint.referenceEndpoint=u.suspendedEndpoint,u.endpoints[j]=this._jsPlumb.floatingEndpoint,u.addClass(h.draggingClass),this._jsPlumb.floatingEndpoint.addClass(h.draggingClass)}h.registerFloatingConnection(r,u,this._jsPlumb.floatingEndpoint),h.currentlyDragging=!0}.bind(this),w=function(){if(h.setConnectionBeingDragged(!1),u&&null!=u.endpoints){var t=h.getDropEvent(arguments),e=h.getFloatingAnchorIndex(u);if(u.endpoints[0===e?1:0].anchor.unlock(),u.removeClass(h.draggingClass),this._jsPlumb&&(u.deleteConnectionNow||u.endpoints[e]===this._jsPlumb.floatingEndpoint)&&f&&u.suspendedEndpoint){0===e?(u.floatingElement=u.source,u.floatingId=u.sourceId,u.floatingEndpoint=u.endpoints[0],u.floatingIndex=0,u.source=p[0],u.sourceId=p[1]):(u.floatingElement=u.target,u.floatingId=u.targetId,u.floatingEndpoint=u.endpoints[1],u.floatingIndex=1,u.target=p[0],u.targetId=p[1]);var i=this._jsPlumb.floatingEndpoint;h.setDragScope(p[2],p[3]),u.endpoints[e]=u.suspendedEndpoint,u.isReattach()||u._forceReattach||u._forceDetach||!h.deleteConnection(u,{originalEvent:t})?(u.setHover(!1),u._forceDetach=null,u._forceReattach=null,this._jsPlumb.floatingEndpoint.detachFromConnection(u),u.suspendedEndpoint.addConnection(u),1===e?h.anchorManager.updateOtherEndpoint(u.sourceId,u.floatingId,u.targetId,u):h.anchorManager.sourceChanged(u.floatingId,u.sourceId,u,u.source),h.repaint(p[1])):h.deleteObject({endpoint:i})}this.deleteAfterDragStop?h.deleteObject({endpoint:this}):this._jsPlumb&&this.paint({recalc:!1}),h.fire("connectionDragStop",u,t),u.pending&&h.fire("connectionAborted",u,t),h.currentlyDragging=!1,u.suspendedElement=null,u.suspendedEndpoint=null,u=null}r&&r.element&&h.remove(r.element,!1,!1),this._jsPlumb&&(this.canvas.style.visibility="visible",this.anchor.unlock(),this._jsPlumb.floatingEndpoint=null)}.bind(this);(y=t.extend({},y)).scope=this.scope||y.scope,y[g]=e.wrap(y[g],function(t){o=t.e.payload||{}},!1),y[v]=e.wrap(y[v],T,!1),y[x]=e.wrap(y[x],d.drag),y[b]=e.wrap(y[b],w),y.multipleDrop=!1,y.canDrag=function(){return this.isSource||this.isTemporarySource||this.connections.length>0&&!1!==this.connectionsDetachable}.bind(this),h.initDraggable(this.canvas,y,"internal"),this.canvas._jsPlumbRelatedElement=this.element,m=!0}};var d=a.endpoint||this._jsPlumb.instance.Defaults.Endpoint||t.Defaults.Endpoint;this.setEndpoint(d,!0);var y=a.anchor?a.anchor:a.anchors?a.anchors:h.Defaults.Anchor||"Top";this.setAnchor(y,!0);var v=["default",a.type||""].join(" ");this.addType(v,a.data,!0),this.canvas=this.endpoint.canvas,this.canvas._jsPlumb=this,this.initDraggable();var b=function(i,n,s,o){if(t.isDropSupported(this.element)){var r=a.dropOptions||h.Defaults.DropOptions||t.Defaults.DropOptions;(r=t.extend({},r)).scope=r.scope||this.scope;var l=t.dragEvents.drop,c=t.dragEvents.over,u=t.dragEvents.out,f=this,p=h.EndpointDropHandler({getEndpoint:function(){return f},jsPlumb:h,enabled:function(){return null==s||s.isEnabled()},isFull:function(){return s.isFull()},element:this.element,elementId:this.elementId,isSource:this.isSource,isTarget:this.isTarget,addClass:function(t){f.addClass(t)},removeClass:function(t){f.removeClass(t)},isDropAllowed:function(){return f.isDropAllowed.apply(f,arguments)},reference:o,isRedrop:function(t,e){return t.suspendedEndpoint&&e.reference&&t.suspendedEndpoint.id===e.reference.id}});r[l]=e.wrap(r[l],p,!0),r[c]=e.wrap(r[c],function(){var e=t.getDragObject(arguments),i=h.getAttribute(t.getElement(e),"dragId"),n=h.getFloatingConnectionFor(i);if(null!=n){var s=h.getFloatingAnchorIndex(n),o=this.isTarget&&0!==s||n.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===n.suspendedEndpoint.id;if(o){var r=h.checkCondition("checkDropAllowed",{sourceEndpoint:n.endpoints[s],targetEndpoint:this,connection:n});this[(r?"add":"remove")+"Class"](h.endpointDropAllowedClass),this[(r?"remove":"add")+"Class"](h.endpointDropForbiddenClass),n.endpoints[s].anchor.over(this.anchor,this)}}}.bind(this)),r[u]=e.wrap(r[u],function(){var e=t.getDragObject(arguments),i=null==e?null:h.getAttribute(t.getElement(e),"dragId"),n=i?h.getFloatingConnectionFor(i):null;if(null!=n){var s=h.getFloatingAnchorIndex(n),o=this.isTarget&&0!==s||n.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===n.suspendedEndpoint.id;o&&(this.removeClass(h.endpointDropAllowedClass),this.removeClass(h.endpointDropForbiddenClass),n.endpoints[s].anchor.out())}}.bind(this)),h.initDroppable(i,r,"internal",n)}}.bind(this);return this.anchor.isFloating||b(this.canvas,!(a._transient||this.anchor.isFloating),this,a.reference),this},e.extend(t.Endpoint,t.OverlayCapableJsPlumbUIComponent,{setVisible:function(t,e,i){if(this._jsPlumb.visible=t,this.canvas&&(this.canvas.style.display=t?"block":"none"),this[t?"showOverlays":"hideOverlays"](),!e)for(var n=0;n<this.connections.length;n++)if(this.connections[n].setVisible(t),!i){var s=this===this.connections[n].endpoints[0]?1:0;1===this.connections[n].endpoints[s].connections.length&&this.connections[n].endpoints[s].setVisible(t,!0,!0)}},getAttachedElements:function(){return this.connections},applyType:function(e,i){this.setPaintStyle(e.endpointStyle||e.paintStyle,i),this.setHoverPaintStyle(e.endpointHoverStyle||e.hoverPaintStyle,i),null!=e.maxConnections&&(this._jsPlumb.maxConnections=e.maxConnections),e.scope&&(this.scope=e.scope),t.extend(this,e,o),null!=e.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,e.cssClass),t.OverlayCapableJsPlumbUIComponent.applyType(this,e)},isEnabled:function(){return this._jsPlumb.enabled},setEnabled:function(t){this._jsPlumb.enabled=t},cleanup:function(){t.removeClass(this.element,this._jsPlumb.instance.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"")),this.anchor=null,this.endpoint.cleanup(!0),this.endpoint.destroy(),this.endpoint=null,this._jsPlumb.instance.destroyDraggable(this.canvas,"internal"),this._jsPlumb.instance.destroyDroppable(this.canvas,"internal")},setHover:function(t){this.endpoint&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&this.endpoint.setHover(t)},isFull:function(){return 0===this._jsPlumb.maxConnections||!(this.isFloating()||this._jsPlumb.maxConnections<0||this.connections.length<this._jsPlumb.maxConnections)},isFloating:function(){return null!=this.anchor&&this.anchor.isFloating},isConnectedTo:function(t){var e=!1;if(t)for(var i=0;i<this.connections.length;i++)if(this.connections[i].endpoints[1]===t||this.connections[i].endpoints[0]===t){e=!0;break}return e},getConnectionCost:function(){return this._jsPlumb.connectionCost},setConnectionCost:function(t){this._jsPlumb.connectionCost=t},areConnectionsDirected:function(){return this._jsPlumb.connectionsDirected},setConnectionsDirected:function(t){this._jsPlumb.connectionsDirected=t},setElementId:function(t){this.elementId=t,this.anchor.elementId=t},setReferenceElement:function(e){this.element=t.getElement(e)},setDragAllowedWhenFull:function(t){this.dragAllowedWhenFull=t},equals:function(t){return this.anchor.equals(t.anchor)},getUuid:function(){return this._jsPlumb.uuid},computeAnchor:function(t){return this.anchor.compute(t)}}),this.jsPlumbInstance.prototype.EndpointDropHandler=function(t){return function(i){var n=t.jsPlumb;t.removeClass(n.endpointDropAllowedClass),t.removeClass(n.endpointDropForbiddenClass);var s=n.getDropEvent(arguments),o=n.getDragObject(arguments),r=n.getAttribute(o,"dragId"),a=(n.getAttribute(o,"elId"),n.getAttribute(o,"originalScope")),h=n.getFloatingConnectionFor(r);if(null!=h){var l=null!=h.suspendedEndpoint;if(!l||null!=h.suspendedEndpoint._jsPlumb){var c=t.getEndpoint(h);if(null!=c){if(t.isRedrop(h,t))return h._forceReattach=!0,h.setHover(!1),void(t.maybeCleanup&&t.maybeCleanup(c));var u=n.getFloatingAnchorIndex(h);if(0===u&&!t.isSource||1===u&&!t.isTarget)t.maybeCleanup&&t.maybeCleanup(c);else{t.onDrop&&t.onDrop(h),a&&n.setDragScope(o,a);var f=t.isFull(i);if(f&&c.fire("maxConnections",{endpoint:this,connection:h,maxConnections:c._jsPlumb.maxConnections},s),!f&&t.enabled()){var p=!0;0===u?(h.floatingElement=h.source,h.floatingId=h.sourceId,h.floatingEndpoint=h.endpoints[0],h.floatingIndex=0,h.source=t.element,h.sourceId=t.elementId):(h.floatingElement=h.target,h.floatingId=h.targetId,h.floatingEndpoint=h.endpoints[1],h.floatingIndex=1,h.target=t.element,h.targetId=t.elementId),l&&h.suspendedEndpoint.id!==c.id&&(h.isDetachAllowed(h)&&h.endpoints[u].isDetachAllowed(h)&&h.suspendedEndpoint.isDetachAllowed(h)&&n.checkCondition("beforeDetach",h)||(p=!1));var m=function(i){h.endpoints[u].detachFromConnection(h),h.suspendedEndpoint&&h.suspendedEndpoint.detachFromConnection(h),h.endpoints[u]=c,c.addConnection(h);var o=c.getParameters();for(var r in o)h.setParameter(r,o[r]);if(l){var a=h.suspendedEndpoint.elementId;n.fireMoveEvent({index:u,originalSourceId:0===u?a:h.sourceId,newSourceId:0===u?c.elementId:h.sourceId,originalTargetId:1===u?a:h.targetId,newTargetId:1===u?c.elementId:h.targetId,originalSourceEndpoint:0===u?h.suspendedEndpoint:h.endpoints[0],newSourceEndpoint:0===u?c:h.endpoints[0],originalTargetEndpoint:1===u?h.suspendedEndpoint:h.endpoints[1],newTargetEndpoint:1===u?c:h.endpoints[1],connection:h},s)}else o.draggable&&n.initDraggable(this.element,t.dragOptions,"internal",n);1===u?n.anchorManager.updateOtherEndpoint(h.sourceId,h.floatingId,h.targetId,h):n.anchorManager.sourceChanged(h.floatingId,h.sourceId,h,h.source),h.endpoints[0].finalEndpoint&&(h.endpoints[0].detachFromConnection(h),h.endpoints[0]=h.endpoints[0].finalEndpoint,h.endpoints[0].addConnection(h)),e.isObject(i)&&h.mergeData(i),n.finaliseConnection(h,null,s,!1),h.setHover(!1),n.revalidate(h.endpoints[0].element)}.bind(this),d=function(){h.suspendedEndpoint&&(h.endpoints[u]=h.suspendedEndpoint,h.setHover(!1),h._forceDetach=!0,0===u?(h.source=h.suspendedEndpoint.element,h.sourceId=h.suspendedEndpoint.elementId):(h.target=h.suspendedEndpoint.element,h.targetId=h.suspendedEndpoint.elementId),h.suspendedEndpoint.addConnection(h),1===u?n.anchorManager.updateOtherEndpoint(h.sourceId,h.floatingId,h.targetId,h):n.anchorManager.sourceChanged(h.floatingId,h.sourceId,h,h.source),n.repaint(h.sourceId),h._forceDetach=!1)};if(p=p&&t.isDropAllowed(h.sourceId,h.targetId,h.scope,h,c))return m(p),!0;d()}t.maybeCleanup&&t.maybeCleanup(c),n.currentlyDragging=!1}}}}}}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,e=t.jsPlumb,i=t.jsPlumbUtil,n=function(t,n,s,o,r){if(e.Connectors[n]=e.Connectors[n]||{},null==e.Connectors[n][s]){if(null==e.Connectors[s]){if(t.Defaults.DoNotThrowErrors)return null;throw new TypeError("jsPlumb: unknown connector type '"+s+"'")}e.Connectors[n][s]=function(){e.Connectors[s].apply(this,arguments),e.ConnectorRenderers[n].apply(this,arguments)},i.extend(e.Connectors[n][s],[e.Connectors[s],e.ConnectorRenderers[n]])}return new e.Connectors[n][s](o,r)},s=function(t,e,i){return t?i.makeAnchor(t,e,i):null},o=function(t,e,n,s){null!=e&&(e._jsPlumbConnections=e._jsPlumbConnections||{},s?delete e._jsPlumbConnections[t.id]:e._jsPlumbConnections[t.id]=!0,i.isEmpty(e._jsPlumbConnections)?n.removeClass(e,n.connectedClass):n.addClass(e,n.connectedClass))};e.Connection=function(t){var n=t.newEndpoint;this.id=t.id,this.connector=null,this.idPrefix="_jsplumb_c_",this.defaultLabelLocation=.5,this.defaultOverlayKeys=["Overlays","ConnectionOverlays"],this.previousConnection=t.previousConnection,this.source=e.getElement(t.source),this.target=e.getElement(t.target),e.OverlayCapableJsPlumbUIComponent.apply(this,arguments),t.sourceEndpoint?(this.source=t.sourceEndpoint.getElement(),this.sourceId=t.sourceEndpoint.elementId):this.sourceId=this._jsPlumb.instance.getId(this.source),t.targetEndpoint?(this.target=t.targetEndpoint.getElement(),this.targetId=t.targetEndpoint.elementId):this.targetId=this._jsPlumb.instance.getId(this.target),this.scope=t.scope,this.endpoints=[],this.endpointStyles=[];var s=this._jsPlumb.instance;s.manage(this.sourceId,this.source),s.manage(this.targetId,this.target),this._jsPlumb.visible=!0,this._jsPlumb.params={cssClass:t.cssClass,container:t.container,"pointer-events":t["pointer-events"],editorParams:t.editorParams,overlays:t.overlays},this._jsPlumb.lastPaintedAt=null,this.bind("mouseover",function(){this.setHover(!0)}.bind(this)),this.bind("mouseout",function(){this.setHover(!1)}.bind(this)),this.makeEndpoint=function(e,i,o,r){return o=o||this._jsPlumb.instance.getId(i),this.prepareEndpoint(s,n,this,r,e?0:1,t,i,o)},t.type&&(t.endpoints=t.endpoints||this._jsPlumb.instance.deriveEndpointAndAnchorSpec(t.type).endpoints);var o=this.makeEndpoint(!0,this.source,this.sourceId,t.sourceEndpoint),r=this.makeEndpoint(!1,this.target,this.targetId,t.targetEndpoint);o&&i.addToList(t.endpointsByElement,this.sourceId,o),r&&i.addToList(t.endpointsByElement,this.targetId,r),this.scope||(this.scope=this.endpoints[0].scope),null!=t.deleteEndpointsOnEmpty&&(this.endpoints[0].setDeleteOnEmpty(t.deleteEndpointsOnEmpty),this.endpoints[1].setDeleteOnEmpty(t.deleteEndpointsOnEmpty));var a=s.Defaults.ConnectionsDetachable;!1===t.detachable&&(a=!1),!1===this.endpoints[0].connectionsDetachable&&(a=!1),!1===this.endpoints[1].connectionsDetachable&&(a=!1);var h=t.reattach||this.endpoints[0].reattachConnections||this.endpoints[1].reattachConnections||s.Defaults.ReattachConnections;this.appendToDefaultType({detachable:a,reattach:h,paintStyle:this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||t.paintStyle||s.Defaults.PaintStyle||e.Defaults.PaintStyle,hoverPaintStyle:this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||t.hoverPaintStyle||s.Defaults.HoverPaintStyle||e.Defaults.HoverPaintStyle});var l=s.getSuspendedAt();if(!s.isSuspendDrawing()){var c=s.getCachedData(this.sourceId),u=c.o,f=c.s,p=s.getCachedData(this.targetId),m=p.o,d=p.s,y=l||s.timestamp(),v=this.endpoints[0].anchor.compute({xy:[u.left,u.top],wh:f,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[m.left,m.top],twh:d,tElement:this.endpoints[1],timestamp:y});this.endpoints[0].paint({anchorLoc:v,timestamp:y}),v=this.endpoints[1].anchor.compute({xy:[m.left,m.top],wh:d,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[u.left,u.top],twh:f,tElement:this.endpoints[0],timestamp:y}),this.endpoints[1].paint({anchorLoc:v,timestamp:y})}this.getTypeDescriptor=function(){return"connection"},this.getAttachedElements=function(){return this.endpoints},this.isDetachable=function(t){return!1!==this._jsPlumb.detachable&&(null!=t?!0===t.connectionsDetachable:!0===this._jsPlumb.detachable)},this.setDetachable=function(t){this._jsPlumb.detachable=!0===t},this.isReattach=function(){return!0===this._jsPlumb.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections},this.setReattach=function(t){this._jsPlumb.reattach=!0===t},this._jsPlumb.cost=t.cost||this.endpoints[0].getConnectionCost(),this._jsPlumb.directed=t.directed,null==t.directed&&(this._jsPlumb.directed=this.endpoints[0].areConnectionsDirected());var b=e.extend({},this.endpoints[1].getParameters());e.extend(b,this.endpoints[0].getParameters()),e.extend(b,this.getParameters()),this.setParameters(b),this.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||t.connector||s.Defaults.Connector||e.Defaults.Connector,!0);var x=null!=t.data&&i.isObject(t.data)?t.data:{};this.getData=function(){return x},this.setData=function(t){x=t||{}},this.mergeData=function(t){x=e.extend(x,t)};var g=["default",this.endpoints[0].connectionType,this.endpoints[1].connectionType,t.type].join(" ");/[^\s]/.test(g)&&this.addType(g,t.data,!0),this.updateConnectedClass()},i.extend(e.Connection,e.OverlayCapableJsPlumbUIComponent,{applyType:function(t,i,n){var s=null;null!=t.connector&&(null==(s=this.getCachedTypeItem("connector",n.connector))&&(s=this.prepareConnector(t.connector,n.connector),this.cacheTypeItem("connector",s,n.connector)),this.setPreparedConnector(s)),null!=t.detachable&&this.setDetachable(t.detachable),null!=t.reattach&&this.setReattach(t.reattach),t.scope&&(this.scope=t.scope),null!=t.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,t.cssClass);var o=null;t.anchor?null==(o=this.getCachedTypeItem("anchors",n.anchor))&&(o=[this._jsPlumb.instance.makeAnchor(t.anchor),this._jsPlumb.instance.makeAnchor(t.anchor)],this.cacheTypeItem("anchors",o,n.anchor)):t.anchors&&null==(o=this.getCachedTypeItem("anchors",n.anchors))&&(o=[this._jsPlumb.instance.makeAnchor(t.anchors[0]),this._jsPlumb.instance.makeAnchor(t.anchors[1])],this.cacheTypeItem("anchors",o,n.anchors)),null!=o&&(this.endpoints[0].anchor=o[0],this.endpoints[1].anchor=o[1],this.endpoints[1].anchor.isDynamic&&this._jsPlumb.instance.repaint(this.endpoints[1].elementId)),e.OverlayCapableJsPlumbUIComponent.applyType(this,t)},addClass:function(t,e){e&&(this.endpoints[0].addClass(t),this.endpoints[1].addClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(t)),this.connector&&this.connector.addClass(t)},removeClass:function(t,e){e&&(this.endpoints[0].removeClass(t),this.endpoints[1].removeClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(t)),this.connector&&this.connector.removeClass(t)},isVisible:function(){return this._jsPlumb.visible},setVisible:function(t){this._jsPlumb.visible=t,this.connector&&this.connector.setVisible(t),this.repaint()},cleanup:function(){this.updateConnectedClass(!0),this.endpoints=null,this.source=null,this.target=null,null!=this.connector&&(this.connector.cleanup(!0),this.connector.destroy(!0)),this.connector=null},updateConnectedClass:function(t){this._jsPlumb&&(o(this,this.source,this._jsPlumb.instance,t),o(this,this.target,this._jsPlumb.instance,t))},setHover:function(e){this.connector&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&(this.connector.setHover(e),t.jsPlumb[e?"addClass":"removeClass"](this.source,this._jsPlumb.instance.hoverSourceClass),t.jsPlumb[e?"addClass":"removeClass"](this.target,this._jsPlumb.instance.hoverTargetClass))},getUuids:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]},getCost:function(){return this._jsPlumb?this._jsPlumb.cost:-1/0},setCost:function(t){this._jsPlumb.cost=t},isDirected:function(){return this._jsPlumb.directed},getConnector:function(){return this.connector},prepareConnector:function(t,e){var s,o={_jsPlumb:this._jsPlumb.instance,cssClass:this._jsPlumb.params.cssClass,container:this._jsPlumb.params.container,"pointer-events":this._jsPlumb.params["pointer-events"]},r=this._jsPlumb.instance.getRenderMode();return i.isString(t)?s=n(this._jsPlumb.instance,r,t,o,this):i.isArray(t)&&(s=n(this._jsPlumb.instance,r,t[0],1===t.length?o:i.merge(t[1],o),this)),null!=e&&(s.typeId=e),s},setPreparedConnector:function(t,e,i,n){if(this.connector!==t){var s,o="";if(null!=this.connector&&(o=(s=this.connector).getClass(),this.connector.cleanup(),this.connector.destroy()),this.connector=t,n&&this.cacheTypeItem("connector",t,n),this.canvas=this.connector.canvas,this.bgCanvas=this.connector.bgCanvas,this.connector.reattach(this._jsPlumb.instance),this.addClass(o),this.canvas&&(this.canvas._jsPlumb=this),this.bgCanvas&&(this.bgCanvas._jsPlumb=this),null!=s)for(var r=this.getOverlays(),a=0;a<r.length;a++)r[a].transfer&&r[a].transfer(this.connector);i||this.setListenerComponent(this.connector),e||this.repaint()}},setConnector:function(t,e,i,n){var s=this.prepareConnector(t,n);this.setPreparedConnector(s,e,i,n)},paint:function(t){if(!this._jsPlumb.instance.isSuspendDrawing()&&this._jsPlumb.visible){var e=(t=t||{}).timestamp,i=this.targetId;if(null==e||e!==this._jsPlumb.lastPaintedAt){var n=this._jsPlumb.instance.updateOffset({elId:this.sourceId}).o,s=this._jsPlumb.instance.updateOffset({elId:i}).o,o=this.endpoints[0],r=this.endpoints[1],a=o.anchor.getCurrentLocation({xy:[n.left,n.top],wh:[n.width,n.height],element:o,timestamp:e}),h=r.anchor.getCurrentLocation({xy:[s.left,s.top],wh:[s.width,s.height],element:r,timestamp:e});this.connector.resetBounds(),this.connector.compute({sourcePos:a,targetPos:h,sourceOrientation:o.anchor.getOrientation(o),targetOrientation:r.anchor.getOrientation(r),sourceEndpoint:this.endpoints[0],targetEndpoint:this.endpoints[1],"stroke-width":this._jsPlumb.paintStyleInUse.strokeWidth,sourceInfo:n,targetInfo:s});var l={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};for(var c in this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(c)){var u=this._jsPlumb.overlays[c];u.isVisible()&&(this._jsPlumb.overlayPlacements[c]=u.draw(this.connector,this._jsPlumb.paintStyleInUse,this.getAbsoluteOverlayPosition(u)),l.minX=Math.min(l.minX,this._jsPlumb.overlayPlacements[c].minX),l.maxX=Math.max(l.maxX,this._jsPlumb.overlayPlacements[c].maxX),l.minY=Math.min(l.minY,this._jsPlumb.overlayPlacements[c].minY),l.maxY=Math.max(l.maxY,this._jsPlumb.overlayPlacements[c].maxY))}var f=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||1)/2,p=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||0),m={xmin:Math.min(this.connector.bounds.minX-(f+p),l.minX),ymin:Math.min(this.connector.bounds.minY-(f+p),l.minY),xmax:Math.max(this.connector.bounds.maxX+(f+p),l.maxX),ymax:Math.max(this.connector.bounds.maxY+(f+p),l.maxY)};for(var d in this.connector.paint(this._jsPlumb.paintStyleInUse,null,m),this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(d)){var y=this._jsPlumb.overlays[d];y.isVisible()&&y.paint(this._jsPlumb.overlayPlacements[d],m)}}this._jsPlumb.lastPaintedAt=e}},repaint:function(t){var e=jsPlumb.extend(t||{},{});e.elId=this.sourceId,this.paint(e)},prepareEndpoint:function(t,i,n,o,r,a,h,l){var c;if(o)n.endpoints[r]=o,o.addConnection(n);else{a.endpoints||(a.endpoints=[null,null]);var u=a.endpoints[r]||a.endpoint||t.Defaults.Endpoints[r]||e.Defaults.Endpoints[r]||t.Defaults.Endpoint||e.Defaults.Endpoint;a.endpointStyles||(a.endpointStyles=[null,null]),a.endpointHoverStyles||(a.endpointHoverStyles=[null,null]);var f=a.endpointStyles[r]||a.endpointStyle||t.Defaults.EndpointStyles[r]||e.Defaults.EndpointStyles[r]||t.Defaults.EndpointStyle||e.Defaults.EndpointStyle;null==f.fill&&null!=a.paintStyle&&(f.fill=a.paintStyle.stroke),null==f.outlineStroke&&null!=a.paintStyle&&(f.outlineStroke=a.paintStyle.outlineStroke),null==f.outlineWidth&&null!=a.paintStyle&&(f.outlineWidth=a.paintStyle.outlineWidth);var p=a.endpointHoverStyles[r]||a.endpointHoverStyle||t.Defaults.EndpointHoverStyles[r]||e.Defaults.EndpointHoverStyles[r]||t.Defaults.EndpointHoverStyle||e.Defaults.EndpointHoverStyle;null!=a.hoverPaintStyle&&(null==p&&(p={}),null==p.fill&&(p.fill=a.hoverPaintStyle.stroke));var m=a.anchors?a.anchors[r]:a.anchor?a.anchor:s(t.Defaults.Anchors[r],l,t)||s(e.Defaults.Anchors[r],l,t)||s(t.Defaults.Anchor,l,t)||s(e.Defaults.Anchor,l,t);c=i({paintStyle:f,hoverPaintStyle:p,endpoint:u,connections:[n],uuid:a.uuids?a.uuids[r]:null,anchor:m,source:h,scope:a.scope,reattach:a.reattach||t.Defaults.ReattachConnections,detachable:a.detachable||t.Defaults.ConnectionsDetachable}),null==o&&c.setDeleteOnEmpty(!0),n.endpoints[r]=c,!1===a.drawEndpoints&&c.setVisible(!1,!0,!0)}return c}})}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumbUtil,e=this.jsPlumb;e.AnchorManager=function(i){var n={},s={},o={},r={},a=this,h={},l=i.jsPlumbInstance,c={},u=function(t){return function(e,i){return!1==(t?e[0][0]<i[0][0]:e[0][0]>i[0][0])?-1:1}},f={top:function(t,e){return t[0]>e[0]?1:-1},right:u(!0),bottom:u(!0),left:function(t,e){return(t[0][0]<0?-Math.PI-t[0][0]:Math.PI-t[0][0])>(e[0][0]<0?-Math.PI-e[0][0]:Math.PI-e[0][0])?1:-1}},p=function(t,e){var i=l.getCachedData(t),n=i.s,r=i.o,a=function(e,i,n,r,a,h,l){if(r.length>0)for(var c=function(t,e,i,n,s,o,r){for(var a=[],h=e[s?0:1]/(n.length+1),l=0;l<n.length;l++){var c=(l+1)*h,u=o*e[s?1:0];r&&(c=e[s?0:1]-c);var f=s?c:u,p=s?u:c;a.push([i[0]+f,i[1]+p,f/e[0],p/e[1],n[l][1],n[l][2]])}return a}(0,i,n,r.sort(f[e]),a,h,"right"===e||"top"===e),u=function(t,e){s[t.id]=[e[0],e[1],e[2],e[3]],o[t.id]=l},p=0;p<c.length;p++){var m=c[p][4],d=m.endpoints[1].elementId===t;m.endpoints[0].elementId===t&&u(m.endpoints[0],c[p]),d&&u(m.endpoints[1],c[p])}};a("bottom",n,[r.left,r.top],e.bottom,!0,1,[0,1]),a("top",n,[r.left,r.top],e.top,!0,0,[0,-1]),a("left",n,[r.left,r.top],e.left,!1,0,[-1,0]),a("right",n,[r.left,r.top],e.right,!1,1,[1,0])};this.reset=function(){n={},r={},h={}},this.addFloatingConnection=function(t,e){c[t]=e},this.removeFloatingConnection=function(t){delete c[t]},this.newConnection=function(i){var n=i.sourceId,s=i.targetId,o=i.endpoints,a=!0,h=function(h,l,c,u,f){n===s&&c.isContinuous&&(i._jsPlumb.instance.removeElement(o[1].canvas),a=!1),t.addToList(r,u,[f,l,c.constructor===e.DynamicAnchor])};h(0,o[0],o[0].anchor,s,i),a&&h(0,o[1],o[1].anchor,n,i)};var m=function(e){!function(e,i){if(e){var n=function(t){return t[4]===i};t.removeWithFunction(e.top,n),t.removeWithFunction(e.left,n),t.removeWithFunction(e.bottom,n),t.removeWithFunction(e.right,n)}}(h[e.elementId],e.id)};this.connectionDetached=function(e,i){var n=e.connection||e,s=e.targetId,o=function(e,i,n,s,o){t.removeWithFunction(r[s],function(t){return t[0].id===o.id})};o(0,0,0,e.sourceId,n),o(0,0,0,s,n),n.floatingId&&(o(0,0,0,n.floatingId,n),m(n.floatingEndpoint)),m(n.endpoints[0]),m(n.endpoints[1]),i||(a.redraw(n.sourceId),n.targetId!==n.sourceId&&a.redraw(n.targetId))},this.add=function(e,i){t.addToList(n,i,e)},this.changeId=function(t,e){r[e]=r[t],n[e]=n[t],delete r[t],delete n[t]},this.getConnectionsFor=function(t){return r[t]||[]},this.getEndpointsFor=function(t){return n[t]||[]},this.deleteEndpoint=function(e){t.removeWithFunction(n[e.elementId],function(t){return t.id===e.id}),m(e)},this.clearFor=function(t){delete n[t],n[t]=[]};var d=function(e,n,s,o,r,a,h,l,c,u,f,p){var m,d,y=-1,v=o.endpoints[h],b=v.id,x=[1,0][h],g=[[n,s],o,r,a,b],T=e[c],w=v._continuousAnchorEdge?e[v._continuousAnchorEdge]:null;if(w){var j=t.findWithFunction(w,function(t){return t[4]===b});if(-1!==j)for(w.splice(j,1),m=0;m<w.length;m++)t.addWithFunction(f,d=w[m][1],function(t){return t.id===d.id}),t.addWithFunction(p,w[m][1].endpoints[h],function(t){return t.id===d.endpoints[h].id}),t.addWithFunction(p,w[m][1].endpoints[x],function(t){return t.id===d.endpoints[x].id})}for(m=0;m<T.length;m++)1===i.idx&&T[m][3]===a&&-1===y&&(y=m),t.addWithFunction(f,d=T[m][1],function(t){return t.id===d.id}),t.addWithFunction(p,T[m][1].endpoints[h],function(t){return t.id===d.endpoints[h].id}),t.addWithFunction(p,T[m][1].endpoints[x],function(t){return t.id===d.endpoints[x].id});T.splice(l?-1!==y?y:0:T.length,0,g),v._continuousAnchorEdge=c};this.updateOtherEndpoint=function(i,n,s,o){var a=t.findWithFunction(r[i],function(t){return t[0].id===o.id}),h=t.findWithFunction(r[n],function(t){return t[0].id===o.id});-1!==a&&(r[i][a][0]=o,r[i][a][1]=o.endpoints[1],r[i][a][2]=o.endpoints[1].anchor.constructor===e.DynamicAnchor),h>-1&&(r[n].splice(h,1),t.addToList(r,s,[o,o.endpoints[0],o.endpoints[0].anchor.constructor===e.DynamicAnchor])),o.updateConnectedClass()},this.sourceChanged=function(i,n,s,o){if(i!==n){s.sourceId=n,s.source=o,t.removeWithFunction(r[i],function(t){return t[0].id===s.id});var a=t.findWithFunction(r[s.targetId],function(t){return t[0].id===s.id});a>-1&&(r[s.targetId][a][0]=s,r[s.targetId][a][1]=s.endpoints[0],r[s.targetId][a][2]=s.endpoints[0].anchor.constructor===e.DynamicAnchor),t.addToList(r,n,[s,s.endpoints[1],s.endpoints[1].anchor.constructor===e.DynamicAnchor]),s.endpoints[1].anchor.isContinuous&&(s.source===s.target?s._jsPlumb.instance.removeElement(s.endpoints[1].canvas):null==s.endpoints[1].canvas.parentNode&&s._jsPlumb.instance.appendElement(s.endpoints[1].canvas)),s.updateConnectedClass()}},this.rehomeEndpoint=function(t,e,i){var s=n[e]||[],o=l.getId(i);if(o!==e){var r=s.indexOf(t);if(r>-1){var h=s.splice(r,1)[0];a.add(h,o)}}for(var c=0;c<t.connections.length;c++)t.connections[c].sourceId===e?a.sourceChanged(e,t.elementId,t.connections[c],t.element):t.connections[c].targetId===e&&(t.connections[c].targetId=t.elementId,t.connections[c].target=t.element,a.updateOtherEndpoint(t.connections[c].sourceId,e,t.elementId,t.connections[c]))},this.redraw=function(i,s,o,a,u,f){if(!l.isSuspendDrawing()){var m=n[i]||[],y=r[i]||[],v=[],b=[],x=[];o=o||l.timestamp(),a=a||{left:0,top:0},s&&(s={left:s.left+a.left,top:s.top+a.top});for(var g=l.updateOffset({elId:i,offset:s,recalc:!1,timestamp:o}),T={},w=0;w<y.length;w++){var j=y[w][0],C=j.sourceId,N=j.targetId,E=j.endpoints[0].anchor.isContinuous,O=j.endpoints[1].anchor.isContinuous;if(E||O){var k=C+"_"+N,S=T[k],M=j.sourceId===i?1:0;E&&!h[C]&&(h[C]={top:[],right:[],bottom:[],left:[]}),O&&!h[N]&&(h[N]={top:[],right:[],bottom:[],left:[]}),i!==N&&l.updateOffset({elId:N,timestamp:o}),i!==C&&l.updateOffset({elId:C,timestamp:o});var D=l.getCachedData(N),A=l.getCachedData(C);N===C&&(E||O)?(d(h[C],-Math.PI/2,0,j,!1,N,0,!1,"top",0,v,b),d(h[N],-Math.PI/2,0,j,!1,C,1,!1,"top",0,v,b)):(S||(S=this.calculateOrientation(C,N,A.o,D.o,j.endpoints[0].anchor,j.endpoints[1].anchor,j),T[k]=S),E&&d(h[C],S.theta,0,j,!1,N,0,!1,S.a[0],0,v,b),O&&d(h[N],S.theta2,-1,j,!0,C,1,!0,S.a[1],0,v,b)),E&&t.addWithFunction(x,C,function(t){return t===C}),O&&t.addWithFunction(x,N,function(t){return t===N}),t.addWithFunction(v,j,function(t){return t.id===j.id}),(E&&0===M||O&&1===M)&&t.addWithFunction(b,j.endpoints[M],function(t){return t.id===j.endpoints[M].id})}}for(w=0;w<m.length;w++)0===m[w].connections.length&&m[w].anchor.isContinuous&&(h[i]||(h[i]={top:[],right:[],bottom:[],left:[]}),d(h[i],-Math.PI/2,0,{endpoints:[m[w],m[w]],paint:function(){}},!1,i,0,!1,m[w].anchor.getDefaultFace(),0,v,b),t.addWithFunction(x,i,function(t){return t===i}));for(w=0;w<x.length;w++)p(x[w],h[x[w]]);for(w=0;w<m.length;w++)m[w].paint({timestamp:o,offset:g,dimensions:g.s,recalc:!0!==f});for(w=0;w<b.length;w++){var I=l.getCachedData(b[w].elementId);b[w].paint({timestamp:null,offset:I,dimensions:I.s})}for(w=0;w<y.length;w++){var P=y[w][1];if(P.anchor.constructor===e.DynamicAnchor){P.paint({elementWithPrecedence:i,timestamp:o}),t.addWithFunction(v,y[w][0],function(t){return t.id===y[w][0].id});for(var W=0;W<P.connections.length;W++)P.connections[W]!==y[w][0]&&t.addWithFunction(v,P.connections[W],function(t){return t.id===P.connections[W].id})}else t.addWithFunction(v,y[w][0],function(t){return t.id===y[w][0].id})}var L=c[i];for(L&&L.paint({timestamp:o,recalc:!1,elId:i}),w=0;w<v.length;w++)v[w].paint({elId:i,timestamp:null,recalc:!1,clearEdits:u})}};var y=function(e){t.EventGenerator.apply(this),this.type="Continuous",this.isDynamic=!0,this.isContinuous=!0;for(var i=e.faces||["top","right","bottom","left"],n=!(!1===e.clockwise),r={},a={top:"bottom",right:"left",left:"right",bottom:"top"},h={top:"right",right:"bottom",left:"top",bottom:"left"},l={top:"left",right:"top",left:"bottom",bottom:"right"},c=n?h:l,u=n?l:h,f=e.cssClass||"",p=null,m=null,d=["left","right"],y=["top","bottom"],v=null,b=0;b<i.length;b++)r[i[b]]=!0;this.getDefaultFace=function(){return 0===i.length?"top":i[0]},this.isRelocatable=function(){return!0},this.isSnapOnRelocate=function(){return!0},this.verifyEdge=function(t){return r[t]?t:r[a[t]]?a[t]:r[c[t]]?c[t]:r[u[t]]?u[t]:t},this.isEdgeSupported=function(t){return null==v?null==m?!0===r[t]:m===t:-1!==v.indexOf(t)},this.setCurrentFace=function(t,e){p=t,e&&null!=m&&(m=p)},this.getCurrentFace=function(){return p},this.getSupportedFaces=function(){var t=[];for(var e in r)r[e]&&t.push(e);return t},this.lock=function(){m=p},this.unlock=function(){m=null},this.isLocked=function(){return null!=m},this.lockCurrentAxis=function(){null!=p&&(v="left"===p||"right"===p?d:y)},this.unlockCurrentAxis=function(){v=null},this.compute=function(t){return s[t.element.id]||[0,0]},this.getCurrentLocation=function(t){return s[t.element.id]||[0,0]},this.getOrientation=function(t){return o[t.id]||[0,0]},this.getCssClass=function(){return f}};l.continuousAnchorFactory={get:function(t){return new y(t)},clear:function(t){delete s[t]}}},e.AnchorManager.prototype.calculateOrientation=function(t,e,i,n,s,o){var r=["left","top","right","bottom"];if(t===e)return{orientation:"identity",a:["top","top"]};var a=Math.atan2(n.centery-i.centery,n.centerx-i.centerx),h=Math.atan2(i.centery-n.centery,i.centerx-n.centerx),l=[],c={};!function(t,e){for(var i=0;i<t.length;i++)c[t[i]]={left:[e[i].left,e[i].centery],right:[e[i].right,e[i].centery],top:[e[i].centerx,e[i].top],bottom:[e[i].centerx,e[i].bottom]}}(["source","target"],[i,n]);for(var u=0;u<r.length;u++)for(var f=0;f<r.length;f++)l.push({source:r[u],target:r[f],dist:Biltong.lineLength(c.source[r[u]],c.target[r[f]])});l.sort(function(t,e){return t.dist<e.dist?-1:t.dist>e.dist?1:0});for(var p=l[0].source,m=l[0].target,d=0;d<l.length&&(p=!s.isContinuous||s.isEdgeSupported(l[d].source)?l[d].source:null,m=!o.isContinuous||o.isEdgeSupported(l[d].target)?l[d].target:null,null==p||null==m);d++);return s.isContinuous&&s.setCurrentFace(p),o.isContinuous&&o.setCurrentFace(m),{a:[p,m],theta:a,theta2:h}},e.Anchor=function(e){this.x=e.x||0,this.y=e.y||0,this.elementId=e.elementId,this.cssClass=e.cssClass||"",this.userDefinedLocation=null,this.orientation=e.orientation||[0,0],this.lastReturnValue=null,this.offsets=e.offsets||[0,0],this.timestamp=null;var i=!1!==e.relocatable;this.isRelocatable=function(){return i},this.setRelocatable=function(t){i=t};var n=!1!==e.snapOnRelocate;this.isSnapOnRelocate=function(){return n};var s=!1;this.lock=function(){s=!0},this.unlock=function(){s=!1},this.isLocked=function(){return s},t.EventGenerator.apply(this),this.compute=function(t){var e=t.xy,i=t.wh,n=t.timestamp;return t.clearUserDefinedLocation&&(this.userDefinedLocation=null),n&&n===this.timestamp?this.lastReturnValue:(this.lastReturnValue=null!=this.userDefinedLocation?this.userDefinedLocation:[e[0]+this.x*i[0]+this.offsets[0],e[1]+this.y*i[1]+this.offsets[1],this.x,this.y],this.timestamp=n,this.lastReturnValue)},this.getCurrentLocation=function(t){return t=t||{},null==this.lastReturnValue||null!=t.timestamp&&this.timestamp!==t.timestamp?this.compute(t):this.lastReturnValue},this.setPosition=function(t,e,i,n,o){s&&!o||(this.x=t,this.y=e,this.orientation=[i,n],this.lastReturnValue=null)}},t.extend(e.Anchor,t.EventGenerator,{equals:function(t){if(!t)return!1;var e=t.getOrientation(),i=this.getOrientation();return this.x===t.x&&this.y===t.y&&this.offsets[0]===t.offsets[0]&&this.offsets[1]===t.offsets[1]&&i[0]===e[0]&&i[1]===e[1]},getUserDefinedLocation:function(){return this.userDefinedLocation},setUserDefinedLocation:function(t){this.userDefinedLocation=t},clearUserDefinedLocation:function(){this.userDefinedLocation=null},getOrientation:function(){return this.orientation},getCssClass:function(){return this.cssClass}}),e.FloatingAnchor=function(t){e.Anchor.apply(this,arguments);var i=t.reference,n=t.referenceCanvas,s=e.getSize(n),o=0,r=0,a=null,h=null;this.orientation=null,this.x=0,this.y=0,this.isFloating=!0,this.compute=function(t){var e=t.xy,i=[e[0]+s[0]/2,e[1]+s[1]/2];return h=i,i},this.getOrientation=function(t){if(a)return a;var e=i.getOrientation(t);return[Math.abs(e[0])*o*-1,Math.abs(e[1])*r*-1]},this.over=function(t,e){a=t.getOrientation(e)},this.out=function(){a=null},this.getCurrentLocation=function(t){return null==h?this.compute(t):h}},t.extend(e.FloatingAnchor,e.Anchor);var i=function(t,i,n){return t.constructor===e.Anchor?t:i.makeAnchor(t,n,i)};e.DynamicAnchor=function(t){e.Anchor.apply(this,arguments),this.isDynamic=!0,this.anchors=[],this.elementId=t.elementId,this.jsPlumbInstance=t.jsPlumbInstance;for(var n=0;n<t.anchors.length;n++)this.anchors[n]=i(t.anchors[n],this.jsPlumbInstance,this.elementId);this.getAnchors=function(){return this.anchors};var s=this.anchors.length>0?this.anchors[0]:null,o=s,r=this,a=function(t,e,i,n,s){var o=n[0]+t.x*s[0],r=n[1]+t.y*s[1],a=n[0]+s[0]/2,h=n[1]+s[1]/2;return Math.sqrt(Math.pow(e-o,2)+Math.pow(i-r,2))+Math.sqrt(Math.pow(a-o,2)+Math.pow(h-r,2))},h=t.selector||function(t,e,i,n,s){for(var o=i[0]+n[0]/2,r=i[1]+n[1]/2,h=-1,l=1/0,c=0;c<s.length;c++){var u=a(s[c],o,r,t,e);u<l&&(h=c+0,l=u)}return s[h]};this.compute=function(t){var e=t.xy,i=t.wh,n=t.txy,a=t.twh;this.timestamp=t.timestamp;var l=r.getUserDefinedLocation();return null!=l?l:this.isLocked()||null==n||null==a?s.compute(t):(t.timestamp=null,s=h(e,i,n,a,this.anchors),this.x=s.x,this.y=s.y,s!==o&&this.fire("anchorChanged",s),o=s,s.compute(t))},this.getCurrentLocation=function(t){return this.getUserDefinedLocation()||(null!=s?s.getCurrentLocation(t):null)},this.getOrientation=function(t){return null!=s?s.getOrientation(t):[0,0]},this.over=function(t,e){null!=s&&s.over(t,e)},this.out=function(){null!=s&&s.out()},this.setAnchor=function(t){s=t},this.getCssClass=function(){return s&&s.getCssClass()||""},this.setAnchorCoordinates=function(t){var e=jsPlumbUtil.findWithFunction(this.anchors,function(e){return e.x===t[0]&&e.y===t[1]});return-1!==e&&(this.setAnchor(this.anchors[e]),!0)}},t.extend(e.DynamicAnchor,e.Anchor);var n=function(t,i,n,s,o,r){e.Anchors[o]=function(e){var a=e.jsPlumbInstance.makeAnchor([t,i,n,s,0,0],e.elementId,e.jsPlumbInstance);return a.type=o,r&&r(a,e),a}};n(.5,0,0,-1,"TopCenter"),n(.5,1,0,1,"BottomCenter"),n(0,.5,-1,0,"LeftMiddle"),n(1,.5,1,0,"RightMiddle"),n(.5,0,0,-1,"Top"),n(.5,1,0,1,"Bottom"),n(0,.5,-1,0,"Left"),n(1,.5,1,0,"Right"),n(.5,.5,0,0,"Center"),n(1,0,0,-1,"TopRight"),n(1,1,0,1,"BottomRight"),n(0,0,0,-1,"TopLeft"),n(0,1,0,1,"BottomLeft"),e.Defaults.DynamicAnchors=function(t){return t.jsPlumbInstance.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],t.elementId,t.jsPlumbInstance)},e.Anchors.AutoDefault=function(t){var i=t.jsPlumbInstance.makeDynamicAnchor(e.Defaults.DynamicAnchors(t));return i.type="AutoDefault",i};var s=function(t,i){e.Anchors[t]=function(e){var n=e.jsPlumbInstance.makeAnchor(["Continuous",{faces:i}],e.elementId,e.jsPlumbInstance);return n.type=t,n}};e.Anchors.Continuous=function(t){return t.jsPlumbInstance.continuousAnchorFactory.get(t)},s("ContinuousLeft",["left"]),s("ContinuousTop",["top"]),s("ContinuousBottom",["bottom"]),s("ContinuousRight",["right"]),n(0,0,0,0,"Assign",function(t,e){var i=e.position||"Fixed";t.positionFinder=i.constructor===String?e.jsPlumbInstance.AnchorPositionFinders[i]:i,t.constructorParams=e}),this.jsPlumbInstance.prototype.AnchorPositionFinders={Fixed:function(t,e,i){return[(t.left-e.left)/i[0],(t.top-e.top)/i[1]]},Grid:function(t,e,i,n){var s=t.top-e.top,o=i[0]/n.grid[0],r=i[1]/n.grid[1],a=Math.floor((t.left-e.left)/o),h=Math.floor(s/r);return[(a*o+o/2)/i[0],(h*r+r/2)/i[1]]}},e.Anchors.Perimeter=function(t){var e=(t=t||{}).anchorCount||60,i=t.shape;if(!i)throw new Error("no shape supplied to Perimeter Anchor type");var n=function(){for(var t=2*Math.PI/e,i=0,n=[],s=0;s<e;s++){var o=.5+.5*Math.sin(i),r=.5+.5*Math.cos(i);n.push([o,r,0,0]),i+=t}return n},s=function(t){for(var i=e/t.length,n=[],s=function(t,s,o,r,a,h,l){for(var c=(o-t)/(i=e*a),u=(r-s)/i,f=0;f<i;f++)n.push([t+c*f,s+u*f,null==h?0:h,null==l?0:l])},o=0;o<t.length;o++)s.apply(null,t[o]);return n},o=function(t){for(var e=[],i=0;i<t.length;i++)e.push([t[i][0],t[i][1],t[i][2],t[i][3],1/t.length,t[i][4],t[i][5]]);return s(e)},r=function(){return o([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]])},a={Circle:n,Ellipse:n,Diamond:function(){return o([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]])},Rectangle:r,Square:r,Triangle:function(){return o([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]])},Path:function(t){for(var e=t.points,i=[],n=0,o=0;o<e.length-1;o++){var r=Math.sqrt(Math.pow(e[o][2]-e[o][0])+Math.pow(e[o][3]-e[o][1]));n+=r,i.push([e[o][0],e[o][1],e[o+1][0],e[o+1][1],r])}for(var a=0;a<i.length;a++)i[a][4]=i[a][4]/n;return s(i)}};if(!a[i])throw new Error("Shape ["+i+"] is unknown by Perimeter Anchor type");var h=a[i](t);t.rotation&&(h=function(e){for(var i=[],n=t.rotation/180*Math.PI,s=0;s<e.length;s++){var o=e[s][0]-.5,r=e[s][1]-.5;i.push([o*Math.cos(n)-r*Math.sin(n)+.5,o*Math.sin(n)+r*Math.cos(n)+.5,e[s][2],e[s][3]])}return i}(h));var l=t.jsPlumbInstance.makeDynamicAnchor(h);return l.type="Perimeter",l}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,e=t.jsPlumb,i=t.jsPlumbUtil,n=t.Biltong;e.Segments={AbstractSegment:function(t){this.params=t,this.findClosestPointOnPath=function(){return{d:1/0,x:null,y:null,l:null}},this.getBounds=function(){return{minX:Math.min(t.x1,t.x2),minY:Math.min(t.y1,t.y2),maxX:Math.max(t.x1,t.x2),maxY:Math.max(t.y1,t.y2)}},this.lineIntersection=function(){return[]},this.boxIntersection=function(t,e,i,n){var s=[];return s.push.apply(s,this.lineIntersection(t,e,t+i,e)),s.push.apply(s,this.lineIntersection(t+i,e,t+i,e+n)),s.push.apply(s,this.lineIntersection(t+i,e+n,t,e+n)),s.push.apply(s,this.lineIntersection(t,e+n,t,e)),s},this.boundingBoxIntersection=function(t){return this.boxIntersection(t.x,t.y,t.w,t.y)}},Straight:function(t){e.Segments.AbstractSegment.apply(this,arguments);var i,s,o,r,a,h,l,c=function(){i=Math.sqrt(Math.pow(a-r,2)+Math.pow(l-h,2)),s=n.gradient({x:r,y:h},{x:a,y:l}),o=-1/s};this.type="Straight",this.getLength=function(){return i},this.getGradient=function(){return s},this.getCoordinates=function(){return{x1:r,y1:h,x2:a,y2:l}},this.setCoordinates=function(t){r=t.x1,h=t.y1,a=t.x2,l=t.y2,c()},this.setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),this.getBounds=function(){return{minX:Math.min(r,a),minY:Math.min(h,l),maxX:Math.max(r,a),maxY:Math.max(h,l)}},this.pointOnPath=function(t,e){return 0!==t||e?1!==t||e?n.pointOnLine({x:r,y:h},{x:a,y:l},e?t>0?t:i+t:t*i):{x:a,y:l}:{x:r,y:h}},this.gradientAtPoint=function(){return s},this.pointAlongPathFrom=function(t,e,i){var s=this.pointOnPath(t,i),o=e<=0?{x:r,y:h}:{x:a,y:l};return e<=0&&Math.abs(e)>1&&(e*=-1),n.pointOnLine(s,o,e)};var u=function(t,e,i){return i>=Math.min(t,e)&&i<=Math.max(t,e)},f=function(t,e,i){return Math.abs(i-t)<Math.abs(i-e)?t:e};this.findClosestPointOnPath=function(t,e){var c={d:1/0,x:null,y:null,l:null,x1:r,x2:a,y1:h,y2:l};if(0===s)c.y=h,c.x=u(r,a,t)?t:f(r,a,t);else if(s===1/0||s===-1/0)c.x=r,c.y=u(h,l,e)?e:f(h,l,e);else{var p=h-s*r,m=(e-o*t-p)/(s-o),d=s*m+p;c.x=u(r,a,m)?m:f(r,a,m),c.y=u(h,l,d)?d:f(h,l,d)}var y=n.lineLength([c.x,c.y],[r,h]);return c.d=n.lineLength([t,e],[c.x,c.y]),c.l=y/i,c};var p=function(t,e,i){return i>e?e<=t&&t<=i:e>=t&&t>=i},m=p;this.lineIntersection=function(t,e,i,o){var c=Math.abs(n.gradient({x:t,y:e},{x:i,y:o})),u=Math.abs(s),f=u===1/0?r:h-u*r,p=[],d=c===1/0?t:e-c*t;if(c!==u)if(c===1/0&&0===u)m(t,r,a)&&m(h,e,o)&&(p=[t,h]);else if(0===c&&u===1/0)m(e,h,l)&&m(r,t,i)&&(p=[r,e]);else{var y,v;c===1/0?m(y=t,r,a)&&m(v=u*t+f,e,o)&&(p=[y,v]):0===c?m(v=e,h,l)&&m(y=(e-f)/u,t,i)&&(p=[y,v]):(v=u*(y=(d-f)/(u-c))+f,m(y,r,a)&&m(v,h,l)&&(p=[y,v]))}return p},this.boxIntersection=function(t,e,i,n){var s=[];return s.push.apply(s,this.lineIntersection(t,e,t+i,e)),s.push.apply(s,this.lineIntersection(t+i,e,t+i,e+n)),s.push.apply(s,this.lineIntersection(t+i,e+n,t,e+n)),s.push.apply(s,this.lineIntersection(t,e+n,t,e)),s},this.boundingBoxIntersection=function(t){return this.boxIntersection(t.x,t.y,t.w,t.h)}},Arc:function(t){e.Segments.AbstractSegment.apply(this,arguments);var i=function(e,i){return n.theta([t.cx,t.cy],[e,i])},s=function(t,e){if(t.anticlockwise){var i=t.startAngle<t.endAngle?t.startAngle+o:t.startAngle;return i-Math.abs(i-t.endAngle)*e}var n=Math.abs((t.endAngle<t.startAngle?t.endAngle+o:t.endAngle)-t.startAngle);return t.startAngle+n*e},o=2*Math.PI;this.radius=t.r,this.anticlockwise=t.ac,this.type="Arc",t.startAngle&&t.endAngle?(this.startAngle=t.startAngle,this.endAngle=t.endAngle,this.x1=t.cx+this.radius*Math.cos(t.startAngle),this.y1=t.cy+this.radius*Math.sin(t.startAngle),this.x2=t.cx+this.radius*Math.cos(t.endAngle),this.y2=t.cy+this.radius*Math.sin(t.endAngle)):(this.startAngle=i(t.x1,t.y1),this.endAngle=i(t.x2,t.y2),this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2),this.endAngle<0&&(this.endAngle+=o),this.startAngle<0&&(this.startAngle+=o);var r=this.endAngle<this.startAngle?this.endAngle+o:this.endAngle;this.sweep=Math.abs(r-this.startAngle),this.anticlockwise&&(this.sweep=o-this.sweep);var a=2*Math.PI*this.radius,h=this.sweep/o,l=a*h;this.getLength=function(){return l},this.getBounds=function(){return{minX:t.cx-t.r,maxX:t.cx+t.r,minY:t.cy-t.r,maxY:t.cy+t.r}};var c=1e-10,u=function(t){var e=Math.floor(t),i=Math.ceil(t);return t-e<c?e:i-t<c?i:t};this.pointOnPath=function(e,i){if(0===e)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===e)return{x:this.x2,y:this.y2,theta:this.endAngle};i&&(e/=l);var n=s(this,e),o=t.cx+t.r*Math.cos(n),r=t.cy+t.r*Math.sin(n);return{x:u(o),y:u(r),theta:n}},this.gradientAtPoint=function(e,i){var s=this.pointOnPath(e,i),o=n.normal([t.cx,t.cy],[s.x,s.y]);return this.anticlockwise||o!==1/0&&o!==-1/0||(o*=-1),o},this.pointAlongPathFrom=function(e,i,n){var s=this.pointOnPath(e,n),o=i/a*2*Math.PI,r=s.theta+(this.anticlockwise?-1:1)*o;return{x:t.cx+this.radius*Math.cos(r),y:t.cy+this.radius*Math.sin(r)}}},Bezier:function(i){this.curve=[{x:i.x1,y:i.y1},{x:i.cp1x,y:i.cp1y},{x:i.cp2x,y:i.cp2y},{x:i.x2,y:i.y2}],e.Segments.AbstractSegment.apply(this,arguments),this.bounds={minX:Math.min(i.x1,i.x2,i.cp1x,i.cp2x),minY:Math.min(i.y1,i.y2,i.cp1y,i.cp2y),maxX:Math.max(i.x1,i.x2,i.cp1x,i.cp2x),maxY:Math.max(i.y1,i.y2,i.cp1y,i.cp2y)},this.type="Bezier";var n=function(e,i,n){return n&&(i=t.jsBezier.locationAlongCurveFrom(e,i>0?0:1,i)),i};this.pointOnPath=function(e,i){return e=n(this.curve,e,i),t.jsBezier.pointOnCurve(this.curve,e)},this.gradientAtPoint=function(e,i){return e=n(this.curve,e,i),t.jsBezier.gradientAtPoint(this.curve,e)},this.pointAlongPathFrom=function(e,i,s){return e=n(this.curve,e,s),t.jsBezier.pointAlongCurveFrom(this.curve,e,i)},this.getLength=function(){return t.jsBezier.getLength(this.curve)},this.getBounds=function(){return this.bounds},this.findClosestPointOnPath=function(e,i){var n=t.jsBezier.nearestPointOnCurve({x:e,y:i},this.curve);return{d:Math.sqrt(Math.pow(n.point.x-e,2)+Math.pow(n.point.y-i,2)),x:n.point.x,y:n.point.y,l:n.location,s:this}},this.lineIntersection=function(e,i,n,s){return t.jsBezier.lineIntersection(e,i,n,s,this.curve)}}},e.SegmentRenderer={getPath:function(t,e){return{Straight:function(e){var i=t.getCoordinates();return(e?"M "+i.x1+" "+i.y1+" ":"")+"L "+i.x2+" "+i.y2},Bezier:function(e){var i=t.params;return(e?"M "+i.x2+" "+i.y2+" ":"")+"C "+i.cp2x+" "+i.cp2y+" "+i.cp1x+" "+i.cp1y+" "+i.x1+" "+i.y1},Arc:function(e){var i=t.sweep>Math.PI?1:0;return(e?"M"+t.x1+" "+t.y1+" ":"")+"A "+t.radius+" "+t.params.r+" 0 "+i+","+(t.anticlockwise?0:1)+" "+t.x2+" "+t.y2}}[t.type](e)}};var s=function(){this.resetBounds=function(){this.bounds={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}},this.resetBounds()};e.Connectors.AbstractConnector=function(t){s.apply(this,arguments);var o=[],r=0,a=[],h=[],l=t.stub||0,c=i.isArray(l)?l[0]:l,u=i.isArray(l)?l[1]:l,f=t.gap||0,p=i.isArray(f)?f[0]:f,m=i.isArray(f)?f[1]:f,d=null,y=null;this.getPathData=function(){for(var t="",i=0;i<o.length;i++)t+=e.SegmentRenderer.getPath(o[i],0===i),t+=" ";return t},this.findSegmentForPoint=function(t,e){for(var i={d:1/0,s:null,x:null,y:null,l:null},n=0;n<o.length;n++){var s=o[n].findClosestPointOnPath(t,e);s.d<i.d&&(i.d=s.d,i.l=s.l,i.x=s.x,i.y=s.y,i.s=o[n],i.x1=s.x1,i.x2=s.x2,i.y1=s.y1,i.y2=s.y2,i.index=n)}return i},this.lineIntersection=function(t,e,i,n){for(var s=[],r=0;r<o.length;r++)s.push.apply(s,o[r].lineIntersection(t,e,i,n));return s},this.boxIntersection=function(t,e,i,n){for(var s=[],r=0;r<o.length;r++)s.push.apply(s,o[r].boxIntersection(t,e,i,n));return s},this.boundingBoxIntersection=function(t){for(var e=[],i=0;i<o.length;i++)e.push.apply(e,o[i].boundingBoxIntersection(t));return e};var v=function(){for(var t=0,e=0;e<o.length;e++){var i=o[e].getLength();h[e]=i/r,a[e]=[t,t+=i/r]}},b=function(t,e){e&&(t=t>0?t/r:(r+t)/r);for(var i=a.length-1,n=1,s=0;s<a.length;s++)if(a[s][1]>=t){i=s,n=1===t?1:0===t?0:(t-a[s][0])/h[s];break}return{segment:o[i],proportion:n,index:i}},x=function(t,i,n){if(n.x1!==n.x2||n.y1!==n.y2){var s=new e.Segments[i](n);o.push(s),r+=s.getLength(),t.updateBounds(s)}},g=function(){r=o.length=a.length=h.length=0};this.setSegments=function(t){d=[],r=0;for(var e=0;e<t.length;e++)d.push(t[e]),r+=t[e].getLength()},this.getLength=function(){return r};var T=function(t){this.strokeWidth=t.strokeWidth;var e=n.quadrant(t.sourcePos,t.targetPos),i=t.targetPos[0]<t.sourcePos[0],s=t.targetPos[1]<t.sourcePos[1],o=t.strokeWidth||1,r=t.sourceEndpoint.anchor.getOrientation(t.sourceEndpoint),a=t.targetEndpoint.anchor.getOrientation(t.targetEndpoint),h=i?t.targetPos[0]:t.sourcePos[0],l=s?t.targetPos[1]:t.sourcePos[1],f=Math.abs(t.targetPos[0]-t.sourcePos[0]),d=Math.abs(t.targetPos[1]-t.sourcePos[1]);if(0===r[0]&&0===r[1]||0===a[0]&&0===a[1]){var y=f>d?0:1,v=[1,0][y];a=[],(r=[])[y]=t.sourcePos[y]>t.targetPos[y]?-1:1,a[y]=t.sourcePos[y]>t.targetPos[y]?1:-1,r[v]=0,a[v]=0}var b=i?f+p*r[0]:p*r[0],x=s?d+p*r[1]:p*r[1],g=i?m*a[0]:f+m*a[0],T=s?m*a[1]:d+m*a[1],w=r[0]*a[0]+r[1]*a[1],j={sx:b,sy:x,tx:g,ty:T,lw:o,xSpan:Math.abs(g-b),ySpan:Math.abs(T-x),mx:(b+g)/2,my:(x+T)/2,so:r,to:a,x:h,y:l,w:f,h:d,segment:e,startStubX:b+r[0]*c,startStubY:x+r[1]*c,endStubX:g+a[0]*u,endStubY:T+a[1]*u,isXGreaterThanStubTimes2:Math.abs(b-g)>c+u,isYGreaterThanStubTimes2:Math.abs(x-T)>c+u,opposite:-1===w,perpendicular:0===w,orthogonal:1===w,sourceAxis:0===r[0]?"y":"x",points:[h,l,f,d,b,x,g,T],stubs:[c,u]};return j.anchorOrientation=j.opposite?"opposite":j.orthogonal?"orthogonal":"perpendicular",j};return this.getSegments=function(){return o},this.updateBounds=function(t){var e=t.getBounds();this.bounds.minX=Math.min(this.bounds.minX,e.minX),this.bounds.maxX=Math.max(this.bounds.maxX,e.maxX),this.bounds.minY=Math.min(this.bounds.minY,e.minY),this.bounds.maxY=Math.max(this.bounds.maxY,e.maxY)},this.pointOnPath=function(t,e){var i=b(t,e);return i.segment&&i.segment.pointOnPath(i.proportion,!1)||[0,0]},this.gradientAtPoint=function(t,e){var i=b(t,e);return i.segment&&i.segment.gradientAtPoint(i.proportion,!1)||0},this.pointAlongPathFrom=function(t,e,i){var n=b(t,i);return n.segment&&n.segment.pointAlongPathFrom(n.proportion,e,!1)||[0,0]},this.compute=function(t){y=T.call(this,t),g(),this._compute(y,t),this.x=y.points[0],this.y=y.points[1],this.w=y.points[2],this.h=y.points[3],this.segment=y.segment,v()},{addSegment:x,prepareCompute:T,sourceStub:c,targetStub:u,maxStub:Math.max(c,u),sourceGap:p,targetGap:m,maxGap:Math.max(p,m)}},i.extend(e.Connectors.AbstractConnector,s),e.Endpoints.AbstractEndpoint=function(t){s.apply(this,arguments);var e=this.compute=function(t,e,i,n){var s=this._compute.apply(this,arguments);return this.x=s[0],this.y=s[1],this.w=s[2],this.h=s[3],this.bounds.minX=this.x,this.bounds.minY=this.y,this.bounds.maxX=this.x+this.w,this.bounds.maxY=this.y+this.h,s};return{compute:e,cssClass:t.cssClass}},i.extend(e.Endpoints.AbstractEndpoint,s),e.Endpoints.Dot=function(t){this.type="Dot",e.Endpoints.AbstractEndpoint.apply(this,arguments),this.radius=(t=t||{}).radius||10,this.defaultOffset=.5*this.radius,this.defaultInnerRadius=this.radius/3,this._compute=function(t,e,i){this.radius=i.radius||this.radius;var n=t[0]-this.radius,s=t[1]-this.radius,o=2*this.radius,r=2*this.radius;if(i.stroke){var a=i.strokeWidth||1;n-=a,s-=a,o+=2*a,r+=2*a}return[n,s,o,r,this.radius]}},i.extend(e.Endpoints.Dot,e.Endpoints.AbstractEndpoint),e.Endpoints.Rectangle=function(t){this.type="Rectangle",e.Endpoints.AbstractEndpoint.apply(this,arguments),this.width=(t=t||{}).width||20,this.height=t.height||20,this._compute=function(t,e,i){var n=i.width||this.width,s=i.height||this.height;return[t[0]-n/2,t[1]-s/2,n,s]}},i.extend(e.Endpoints.Rectangle,e.Endpoints.AbstractEndpoint);var o=function(){e.jsPlumbUIComponent.apply(this,arguments),this._jsPlumb.displayElements=[]};i.extend(o,e.jsPlumbUIComponent,{getDisplayElements:function(){return this._jsPlumb.displayElements},appendDisplayElement:function(t){this._jsPlumb.displayElements.push(t)}}),e.Endpoints.Image=function(n){this.type="Image",o.apply(this,arguments),e.Endpoints.AbstractEndpoint.apply(this,arguments);var s=n.onload,r=n.src||n.url,a=n.cssClass?" "+n.cssClass:"";this._jsPlumb.img=new Image,this._jsPlumb.ready=!1,this._jsPlumb.initialized=!1,this._jsPlumb.deleted=!1,this._jsPlumb.widthToUse=n.width,this._jsPlumb.heightToUse=n.height,this._jsPlumb.endpoint=n.endpoint,this._jsPlumb.img.onload=function(){null!=this._jsPlumb&&(this._jsPlumb.ready=!0,this._jsPlumb.widthToUse=this._jsPlumb.widthToUse||this._jsPlumb.img.width,this._jsPlumb.heightToUse=this._jsPlumb.heightToUse||this._jsPlumb.img.height,s&&s(this))}.bind(this),this._jsPlumb.endpoint.setImage=function(t,e){var i=t.constructor===String?t:t.src;s=e,this._jsPlumb.img.src=i,null!=this.canvas&&this.canvas.setAttribute("src",this._jsPlumb.img.src)}.bind(this),this._jsPlumb.endpoint.setImage(r,s),this._compute=function(t){return this.anchorPoint=t,this._jsPlumb.ready?[t[0]-this._jsPlumb.widthToUse/2,t[1]-this._jsPlumb.heightToUse/2,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse]:[0,0,0,0]},this.canvas=e.createElement("img",{position:"absolute",margin:0,padding:0,outline:0},this._jsPlumb.instance.endpointClass+a),this._jsPlumb.widthToUse&&this.canvas.setAttribute("width",this._jsPlumb.widthToUse),this._jsPlumb.heightToUse&&this.canvas.setAttribute("height",this._jsPlumb.heightToUse),this._jsPlumb.instance.appendElement(this.canvas),this.actuallyPaint=function(){this._jsPlumb.deleted||(this._jsPlumb.initialized||(this.canvas.setAttribute("src",this._jsPlumb.img.src),this.appendDisplayElement(this.canvas),this._jsPlumb.initialized=!0),i.sizeElement(this.canvas,this.anchorPoint[0]-this._jsPlumb.widthToUse/2,this.anchorPoint[1]-this._jsPlumb.heightToUse/2,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse))},this.paint=function(e,i){null!=this._jsPlumb&&(this._jsPlumb.ready?this.actuallyPaint(e,i):t.setTimeout(function(){this.paint(e,i)}.bind(this),200))}},i.extend(e.Endpoints.Image,[o,e.Endpoints.AbstractEndpoint],{cleanup:function(t){t&&(this._jsPlumb.deleted=!0,this.canvas&&this.canvas.parentNode.removeChild(this.canvas),this.canvas=null)}}),e.Endpoints.Blank=function(t){e.Endpoints.AbstractEndpoint.apply(this,arguments),this.type="Blank",o.apply(this,arguments),this._compute=function(t){return[t[0],t[1],10,0]};var n=t.cssClass?" "+t.cssClass:"";this.canvas=e.createElement("div",{display:"block",width:"1px",height:"1px",background:"transparent",position:"absolute"},this._jsPlumb.instance.endpointClass+n),this._jsPlumb.instance.appendElement(this.canvas),this.paint=function(){i.sizeElement(this.canvas,this.x,this.y,this.w,this.h)}},i.extend(e.Endpoints.Blank,[e.Endpoints.AbstractEndpoint,o],{cleanup:function(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}),e.Endpoints.Triangle=function(t){this.type="Triangle",e.Endpoints.AbstractEndpoint.apply(this,arguments);var i=this;(t=t||{}).width=t.width||55,t.height=t.height||55,this.width=t.width,this.height=t.height,this._compute=function(t,e,n){var s=n.width||i.width,o=n.height||i.height;return[t[0]-s/2,t[1]-o/2,s,o]}};var r=e.Overlays.AbstractOverlay=function(t){this.visible=!0,this.isAppendedAtTopLevel=!0,this.component=t.component,this.loc=null==t.location?.5:t.location,this.endpointLoc=null==t.endpointLocation?[.5,.5]:t.endpointLocation,this.visible=!1!==t.visible};r.prototype={cleanup:function(t){t&&(this.component=null,this.canvas=null,this.endpointLoc=null)},reattach:function(){},setVisible:function(t){this.visible=t,this.component.repaint()},isVisible:function(){return this.visible},hide:function(){this.setVisible(!1)},show:function(){this.setVisible(!0)},incrementLocation:function(t){this.loc+=t,this.component.repaint()},setLocation:function(t){this.loc=t,this.component.repaint()},getLocation:function(){return this.loc},updateFrom:function(){}},e.Overlays.Arrow=function(t){this.type="Arrow",r.apply(this,arguments),this.isAppendedAtTopLevel=!1;var s=this;this.length=(t=t||{}).length||20,this.width=t.width||20,this.id=t.id,this.direction=(t.direction||1)<0?-1:1;var o=t.paintStyle||{"stroke-width":1},a=t.foldback||.623;this.computeMaxSize=function(){return 1.5*s.width},this.elementCreated=function(i){if(this.path=i,t.events)for(var n in t.events)e.on(i,n,t.events[n])},this.draw=function(t,e){var s,r,h,l;if(t.pointAlongPathFrom){if(i.isString(this.loc)||this.loc>1||this.loc<0){var c=parseInt(this.loc,10),u=this.loc<0?1:0;s=t.pointAlongPathFrom(u,c,!1),r=t.pointAlongPathFrom(u,c-this.direction*this.length/2,!1),h=n.pointOnLine(s,r,this.length)}else if(1===this.loc){if(s=t.pointOnPath(this.loc),r=t.pointAlongPathFrom(this.loc,-this.length),h=n.pointOnLine(s,r,this.length),-1===this.direction){var f=h;h=s,s=f}}else if(0===this.loc){if(h=t.pointOnPath(this.loc),r=t.pointAlongPathFrom(this.loc,this.length),s=n.pointOnLine(h,r,this.length),-1===this.direction){var p=h;h=s,s=p}}else s=t.pointAlongPathFrom(this.loc,this.direction*this.length/2),r=t.pointOnPath(this.loc),h=n.pointOnLine(s,r,this.length);return{component:t,d:{hxy:s,tail:l=n.perpendicularLineTo(s,h,this.width),cxy:n.pointOnLine(s,h,a*this.length)},"stroke-width":o.strokeWidth||e.strokeWidth,stroke:o.stroke||e.stroke,fill:o.fill||e.stroke,minX:Math.min(s.x,l[0].x,l[1].x),maxX:Math.max(s.x,l[0].x,l[1].x),minY:Math.min(s.y,l[0].y,l[1].y),maxY:Math.max(s.y,l[0].y,l[1].y)}}return{component:t,minX:0,maxX:0,minY:0,maxY:0}}},i.extend(e.Overlays.Arrow,r,{updateFrom:function(t){this.length=t.length||this.length,this.width=t.width||this.width,this.direction=null!=t.direction?t.direction:this.direction,this.foldback=t.foldback||this.foldback},cleanup:function(){this.path&&this.canvas&&this.canvas.removeChild(this.path)}}),e.Overlays.PlainArrow=function(t){var i=e.extend(t=t||{},{foldback:1});e.Overlays.Arrow.call(this,i),this.type="PlainArrow"},i.extend(e.Overlays.PlainArrow,e.Overlays.Arrow),e.Overlays.Diamond=function(t){var i=e.extend(t=t||{},{length:(t.length||40)/2,foldback:2});e.Overlays.Arrow.call(this,i),this.type="Diamond"},i.extend(e.Overlays.Diamond,e.Overlays.Arrow);var a=function(t,e){return(null==t._jsPlumb.cachedDimensions||e)&&(t._jsPlumb.cachedDimensions=t.getDimensions()),t._jsPlumb.cachedDimensions},h=function(t){e.jsPlumbUIComponent.apply(this,arguments),r.apply(this,arguments);var n=this.fire;this.fire=function(){n.apply(this,arguments),this.component&&this.component.fire.apply(this.component,arguments)},this.detached=!1,this.id=t.id,this._jsPlumb.div=null,this._jsPlumb.initialised=!1,this._jsPlumb.component=t.component,this._jsPlumb.cachedDimensions=null,this._jsPlumb.create=t.create,this._jsPlumb.initiallyInvisible=!1===t.visible,this.getElement=function(){if(null==this._jsPlumb.div){var i=this._jsPlumb.div=e.getElement(this._jsPlumb.create(this._jsPlumb.component));i.style.position="absolute",jsPlumb.addClass(i,this._jsPlumb.instance.overlayClass+" "+(this.cssClass?this.cssClass:t.cssClass?t.cssClass:"")),this._jsPlumb.instance.appendElement(i),this._jsPlumb.instance.getId(i),this.canvas=i;var n="translate(-50%, -50%)";i.style.webkitTransform=n,i.style.mozTransform=n,i.style.msTransform=n,i.style.oTransform=n,i.style.transform=n,i._jsPlumb=this,!1===t.visible&&(i.style.display="none")}return this._jsPlumb.div},this.draw=function(t,e,n){var s=a(this);if(null!=s&&2===s.length){var o={x:0,y:0};if(n)o={x:n[0],y:n[1]};else if(t.pointOnPath){var r=this.loc,h=!1;(i.isString(this.loc)||this.loc<0||this.loc>1)&&(r=parseInt(this.loc,10),h=!0),o=t.pointOnPath(r,h)}else{var l=this.loc.constructor===Array?this.loc:this.endpointLoc;o={x:l[0]*t.w,y:l[1]*t.h}}var c=o.x-s[0]/2,u=o.y-s[1]/2;return{component:t,d:{minx:c,miny:u,td:s,cxy:o},minX:c,maxX:c+s[0],minY:u,maxY:u+s[1]}}return{minX:0,maxX:0,minY:0,maxY:0}}};i.extend(h,[e.jsPlumbUIComponent,r],{getDimensions:function(){return[1,1]},setVisible:function(t){this._jsPlumb.div&&(this._jsPlumb.div.style.display=t?"block":"none",t&&this._jsPlumb.initiallyInvisible&&(a(this,!0),this.component.repaint(),this._jsPlumb.initiallyInvisible=!1))},clearCachedDimensions:function(){this._jsPlumb.cachedDimensions=null},cleanup:function(t){t?null!=this._jsPlumb.div&&(this._jsPlumb.div._jsPlumb=null,this._jsPlumb.instance.removeElement(this._jsPlumb.div)):(this._jsPlumb&&this._jsPlumb.div&&this._jsPlumb.div.parentNode&&this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div),this.detached=!0)},reattach:function(t){null!=this._jsPlumb.div&&t.getContainer().appendChild(this._jsPlumb.div),this.detached=!1},computeMaxSize:function(){var t=a(this);return Math.max(t[0],t[1])},paint:function(t){this._jsPlumb.initialised||(this.getElement(),t.component.appendDisplayElement(this._jsPlumb.div),this._jsPlumb.initialised=!0,this.detached&&this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div)),this._jsPlumb.div.style.left=t.component.x+t.d.minx+"px",this._jsPlumb.div.style.top=t.component.y+t.d.miny+"px"}}),e.Overlays.Custom=function(t){this.type="Custom",h.apply(this,arguments)},i.extend(e.Overlays.Custom,h),e.Overlays.GuideLines=function(){var t=this;t.length=50,t.strokeWidth=5,this.type="GuideLines",r.apply(this,arguments),e.jsPlumbUIComponent.apply(this,arguments),this.draw=function(e){var i=e.pointAlongPathFrom(t.loc,t.length/2),s=e.pointOnPath(t.loc),o=n.pointOnLine(i,s,t.length),r=n.perpendicularLineTo(i,o,40),a=n.perpendicularLineTo(o,i,20);return{connector:e,head:i,tail:o,headLine:a,tailLine:r,minX:Math.min(i.x,o.x,a[0].x,a[1].x),minY:Math.min(i.y,o.y,a[0].y,a[1].y),maxX:Math.max(i.x,o.x,a[0].x,a[1].x),maxY:Math.max(i.y,o.y,a[0].y,a[1].y)}}},e.Overlays.Label=function(t){this.labelStyle=t.labelStyle,this.cssClass=null!=this.labelStyle?this.labelStyle.cssClass:null;var i=e.extend({create:function(){return e.createElement("div")}},t);if(e.Overlays.Custom.call(this,i),this.type="Label",this.label=t.label||"",this.labelText=null,this.labelStyle){var n=this.getElement();this.labelStyle.font=this.labelStyle.font||"12px sans-serif",n.style.font=this.labelStyle.font,n.style.color=this.labelStyle.color||"black",this.labelStyle.fill&&(n.style.background=this.labelStyle.fill),this.labelStyle.borderWidth>0&&(n.style.border=this.labelStyle.borderWidth+"px solid "+(this.labelStyle.borderStyle?this.labelStyle.borderStyle:"black")),this.labelStyle.padding&&(n.style.padding=this.labelStyle.padding)}},i.extend(e.Overlays.Label,e.Overlays.Custom,{cleanup:function(t){t&&(this.div=null,this.label=null,this.labelText=null,this.cssClass=null,this.labelStyle=null)},getLabel:function(){return this.label},setLabel:function(t){this.label=t,this.labelText=null,this.clearCachedDimensions(),this.update(),this.component.repaint()},getDimensions:function(){return this.update(),h.prototype.getDimensions.apply(this,arguments)},update:function(){if("function"==typeof this.label){var t=this.label(this);this.getElement().innerHTML=t.replace(/\r\n/g,"<br/>")}else null==this.labelText&&(this.labelText=this.label,this.getElement().innerHTML=this.labelText.replace(/\r\n/g,"<br/>"))},updateFrom:function(t){null!=t.label&&this.setLabel(t.label)}})}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this,e=t.jsPlumbUtil,i=t.jsPlumbInstance,n="stop",s="revert",o="_jsPlumbGroup",r="show",a="hide",h=function(t){var i={},n={},s={},h=this;function l(e,i){for(var n=e.getMembers(),s=0;s<n.length;s++)t[i?r:a](n[s],!0)}t.bind("connection",function(t){null!=t.source[o]&&null!=t.target[o]&&t.source[o]===t.target[o]?(n[t.connection.id]=t.source[o],s[t.connection.id]=t.source[o]):(null!=t.source[o]&&(e.suggest(t.source[o].connections.source,t.connection),n[t.connection.id]=t.source[o]),null!=t.target[o]&&(e.suggest(t.target[o].connections.target,t.connection),s[t.connection.id]=t.target[o]))}),t.bind("internal.connectionDetached",function(t){!function(t){delete t.proxies;var i,o=n[t.id];null!=o&&(e.removeWithFunction(o.connections.source,i=function(e){return e.id===t.id}),e.removeWithFunction(o.connections.target,i),delete n[t.id]),null!=(o=s[t.id])&&(e.removeWithFunction(o.connections.source,i=function(e){return e.id===t.id}),e.removeWithFunction(o.connections.target,i),delete s[t.id])}(t.connection)}),t.bind("connectionMoved",function(t){var e=(0===t.index?n:s)[t.connection.id];if(e){var i=e.connections[0===t.index?"source":"target"],o=i.indexOf(t.connection);-1!==o&&i.splice(o,1)}}),this.addGroup=function(e){t.addClass(e.getEl(),"jtk-group-expanded"),i[e.id]=e,e.manager=this,f(e),t.fire("group:add",{group:e})},this.addToGroup=function(e,i,n){if(e=this.getGroup(e)){var s=e.getEl();if(i._isJsPlumbGroup)return;var o=i._jsPlumbGroup;if(o!==e){var r=t.getOffset(i,!0),a=t.getOffset(e.collapsed?s:e.getDragArea(),!0);null!=o&&(o.remove(i,!1,n,!1,e),h.updateConnectionsForGroup(o)),e.add(i,n);var l=function(t,i){var n=0===i?1:0;t.each(function(t){t.setVisible(!1),t.endpoints[n].element._jsPlumbGroup===e?(t.endpoints[n].setVisible(!1),u(t,n,e)):(t.endpoints[i].setVisible(!1),c(t,i,e))})};e.collapsed&&(l(t.select({source:i}),0),l(t.select({target:i}),1));var f=t.getId(i);t.dragManager.setParent(i,f,s,t.getId(s),r);var p={left:r.left-a.left,top:r.top-a.top};if(t.setPosition(i,p),t.dragManager.revalidateParent(i,f,r),h.updateConnectionsForGroup(e),t.revalidate(f),!n){var m={group:e,el:i,pos:p};o&&(m.sourceGroup=o),t.fire("group:addMember",m)}}}},this.removeFromGroup=function(t,e,i){(t=this.getGroup(t))&&t.remove(e,null,i)},this.getGroup=function(t){var n=t;if(e.isString(t)&&null==(n=i[t]))throw new TypeError("No such group ["+t+"]");return n},this.getGroups=function(){var t=[];for(var e in i)t.push(i[e]);return t},this.removeGroup=function(e,n,s,o){e=this.getGroup(e),this.expandGroup(e,!0);var r=e[n?"removeAll":"orphanAll"](s,o);return t.remove(e.getEl()),delete i[e.id],delete t._groups[e.id],t.fire("group:remove",{group:e}),r},this.removeAllGroups=function(t,e,n){for(var s in i)this.removeGroup(i[s],t,e,n)};var c=function(e,i,n){var s=e.endpoints[0===i?1:0].element;if(!s[o]||s[o].shouldProxy()||!s[o].collapsed){var r=n.getEl(),a=t.getId(r);t.proxyConnection(e,i,r,a,function(t,e){return n.getEndpoint(t,e)},function(t,e){return n.getAnchor(t,e)})}};this.collapseGroup=function(e){if(null!=(e=this.getGroup(e))&&!e.collapsed){var i=e.getEl();if(l(e,!1),e.shouldProxy()){var n=function(t,i){for(var n=0;n<t.length;n++)c(t[n],i,e)};n(e.connections.source,0),n(e.connections.target,1)}e.collapsed=!0,t.removeClass(i,"jtk-group-expanded"),t.addClass(i,"jtk-group-collapsed"),t.revalidate(i),t.fire("group:collapse",{group:e})}};var u=function(e,i,n){t.unproxyConnection(e,i,t.getId(n.getEl()))};function f(e){var i=e.getMembers(),o=t.getConnections({source:i,scope:"*"},!0),r=t.getConnections({target:i,scope:"*"},!0),a={};e.connections.source.length=0,e.connections.target.length=0;var h=function(t){for(var i=0;i<t.length;i++)a[t[i].id]||(a[t[i].id]=!0,t[i].source._jsPlumbGroup===e?(t[i].target._jsPlumbGroup!==e&&e.connections.source.push(t[i]),n[t[i].id]=e):t[i].target._jsPlumbGroup===e&&(e.connections.target.push(t[i]),s[t[i].id]=e))};h(o),h(r)}this.expandGroup=function(e,i){if(null!=(e=this.getGroup(e))&&e.collapsed){var n=e.getEl();if(l(e,!0),e.shouldProxy()){var s=function(t,i){for(var n=0;n<t.length;n++)u(t[n],i,e)};s(e.connections.source,0),s(e.connections.target,1)}e.collapsed=!1,t.addClass(n,"jtk-group-expanded"),t.removeClass(n,"jtk-group-collapsed"),t.revalidate(n),this.repaintGroup(e),i||t.fire("group:expand",{group:e})}},this.repaintGroup=function(e){for(var i=(e=this.getGroup(e)).getMembers(),n=0;n<i.length;n++)t.revalidate(i[n])},this.updateConnectionsForGroup=f,this.refreshAllGroups=function(){for(var e in i)f(i[e]),t.dragManager.updateOffsets(t.getId(i[e].getEl()))}},l=function(i,r){var a=this,h=r.el;this.getEl=function(){return h},this.id=r.id||e.uuid(),h._isJsPlumbGroup=!0;var l=this.getDragArea=function(){var t=i.getSelector(h,"[jtk-group-content]");return t&&t.length>0?t[0]:h},c=!0===r.ghost,u=c||!0===r.constrain,f=!1!==r.revert,p=!0===r.orphan,m=!0===r.prune,d=!0===r.dropOverride,y=!1!==r.proxied,v=[];if(this.connections={source:[],target:[],internal:[]},this.getAnchor=function(){return r.anchor||"Continuous"},this.getEndpoint=function(){return r.endpoint||["Dot",{radius:10}]},this.collapsed=!1,!1!==r.draggable){var b={stop:function(t){i.fire("groupDragStop",jsPlumb.extend(t,{group:a}))},scope:"_jsPlumbGroupDrag"};r.dragOptions&&t.jsPlumb.extend(b,r.dragOptions),i.draggable(r.el,b)}!1!==r.droppable&&i.droppable(r.el,{drop:function(t){var e=t.drag.el;if(!e._isJsPlumbGroup){var n=e._jsPlumbGroup;if(n!==a){if(null!=n&&n.overrideDrop(e,a))return;i.getGroupManager().addToGroup(a,e,!1)}}}});var x=function(t,e){for(var i=null==t.nodeType?t:[t],n=0;n<i.length;n++)e(i[n])};function g(t,e){var n=function(t){return t.offsetParent}(t),s=i.getSize(n),o=i.getSize(t),r=e[0],a=e[1];return r+o[0]>0&&r<s[0]&&a+o[1]>0&&a<s[1]}function T(t){var e=i.getId(t),n=i.getOffset(t);return t.parentNode.removeChild(t),i.getContainer().appendChild(t),i.setPosition(t,n),delete t._jsPlumbGroup,C(t),i.dragManager.clearParent(t,e),[e,n]}function w(t){var e=null;if(!g(t.el,t.pos)){var n=t.el._jsPlumbGroup;m?i.remove(t.el):e=T(t.el),n.remove(t.el)}return e}function j(t){var e=i.getId(t);i.revalidate(t),i.dragManager.revalidateParent(t,e)}function C(t){t._katavorioDrag&&((m||p)&&t._katavorioDrag.off(n,w),m||p||!f||(t._katavorioDrag.off(s,j),t._katavorioDrag.setRevert(null)))}function N(t){t._katavorioDrag&&((m||p)&&t._katavorioDrag.on(n,w),u&&t._katavorioDrag.setConstrain(!0),c&&t._katavorioDrag.setUseGhostProxy(!0),m||p||!f||(t._katavorioDrag.on(s,j),t._katavorioDrag.setRevert(function(t,e){return!g(t,e)})))}this.overrideDrop=function(){return d&&(f||m||p)},this.add=function(t,e){var n=l();x(t,function(t){if(null!=t._jsPlumbGroup){if(t._jsPlumbGroup===a)return;t._jsPlumbGroup.remove(t,!0,e,!1)}t._jsPlumbGroup=a,v.push(t),i.isAlreadyDraggable(t)&&N(t),t.parentNode!==n&&n.appendChild(t)}),i.getGroupManager().updateConnectionsForGroup(a)},this.remove=function(t,n,s,o,r){x(t,function(t){if(delete t._jsPlumbGroup,e.removeWithFunction(v,function(e){return e===t}),n)try{a.getDragArea().removeChild(t)}catch(t){jsPlumbUtil.log("Could not remove element from Group "+t)}if(C(t),!s){var o={group:a,el:t};r&&(o.targetGroup=r),i.fire("group:removeMember",o)}}),o||i.getGroupManager().updateConnectionsForGroup(a)},this.removeAll=function(t,e){for(var n=0,s=v.length;n<s;n++){var o=v[0];a.remove(o,t,e,!0),i.remove(o,!0)}v.length=0,i.getGroupManager().updateConnectionsForGroup(a)},this.orphanAll=function(){for(var t={},e=0;e<v.length;e++){var i=T(v[e]);t[i[0]]=i[1]}return v.length=0,t},this.getMembers=function(){return v},h[o]=this,i.bind("elementDraggable",function(t){t.el._jsPlumbGroup===this&&N(t.el)}.bind(this)),this.shouldProxy=function(){return y},i.getGroupManager().addGroup(this)};i.prototype.addGroup=function(t){var e=this;if(e._groups=e._groups||{},null!=e._groups[t.id])throw new TypeError("cannot create Group ["+t.id+"]; a Group with that ID exists");if(null!=t.el[o])throw new TypeError("cannot create Group ["+t.id+"]; the given element is already a Group");var i=new l(e,t);return e._groups[i.id]=i,t.collapsed&&this.collapseGroup(i),i},i.prototype.addToGroup=function(t,e,i){var n=function(e){var n=this.getId(e);this.manage(n,e),this.getGroupManager().addToGroup(t,e,i)}.bind(this);if(Array.isArray(e))for(var s=0;s<e.length;s++)n(e[s]);else n(e)},i.prototype.removeFromGroup=function(t,e,i){this.getGroupManager().removeFromGroup(t,e,i)},i.prototype.removeGroup=function(t,e,i,n){return this.getGroupManager().removeGroup(t,e,i,n)},i.prototype.removeAllGroups=function(t,e,i){this.getGroupManager().removeAllGroups(t,e,i)},i.prototype.getGroup=function(t){return this.getGroupManager().getGroup(t)},i.prototype.getGroups=function(){return this.getGroupManager().getGroups()},i.prototype.expandGroup=function(t){this.getGroupManager().expandGroup(t)},i.prototype.collapseGroup=function(t){this.getGroupManager().collapseGroup(t)},i.prototype.repaintGroup=function(t){this.getGroupManager().repaintGroup(t)},i.prototype.toggleGroup=function(t){null!=(t=this.getGroupManager().getGroup(t))&&this.getGroupManager()[t.collapsed?"expandGroup":"collapseGroup"](t)},i.prototype.getGroupManager=function(){var t=this._groupManager;return null==t&&(t=this._groupManager=new h(this)),t},i.prototype.removeGroupManager=function(){delete this._groupManager},i.prototype.getGroupFor=function(t){if(t=this.getElement(t))return t[o]}}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,e=this.jsPlumbUtil;t.Connectors.Flowchart=function(e){this.type="Flowchart",(e=e||{}).stub=null==e.stub?30:e.stub;var i,n=t.Connectors.AbstractConnector.apply(this,arguments),s=null==e.midpoint?.5:e.midpoint,o=!0===e.alwaysRespectStubs,r=null,a=null,h=null!=e.cornerRadius?e.cornerRadius:0,l=function(t){return t<0?-1:0===t?0:1},c=function(t){return[l(t[2]-t[0]),l(t[3]-t[1])]},u=function(t,e,i,n){if(r!==e||a!==i){var s=null==r?n.sx:r,o=null==a?n.sy:a;r=e,a=i,t.push([s,o,e,i,s===e?"v":"h"])}},f=function(t){return Math.sqrt(Math.pow(t[0]-t[2],2)+Math.pow(t[1]-t[3],2))},p=function(t){var e=[];return e.push.apply(e,t),e},m=function(t,e,i){for(var s,o,r,a=null,l=0;l<e.length-1;l++){if(a=a||p(e[l]),s=p(e[l+1]),o=c(a),r=c(s),h>0&&a[4]!==s[4]){var u=Math.min(f(a),f(s)),m=Math.min(h,u/2);a[2]-=o[0]*m,a[3]-=o[1]*m,s[0]+=r[0]*m,s[1]+=r[1]*m;var d=o[1]===r[0]&&1===r[0]||o[1]===r[0]&&0===r[0]&&o[0]!==r[1]||o[1]===r[0]&&-1===r[0],y=(s[1]>a[3]?1:-1)==(s[0]>a[2]?1:-1),v=y&&d||!y&&!d?s[0]:a[2],b=y&&d||!y&&!d?a[3]:s[1];n.addSegment(t,"Straight",{x1:a[0],y1:a[1],x2:a[2],y2:a[3]}),n.addSegment(t,"Arc",{r:m,x1:a[2],y1:a[3],x2:s[0],y2:s[1],cx:v,cy:b,ac:d})}else{var x=a[2]===a[0]?0:a[2]>a[0]?i.lw/2:-i.lw/2,g=a[3]===a[1]?0:a[3]>a[1]?i.lw/2:-i.lw/2;n.addSegment(t,"Straight",{x1:a[0]-x,y1:a[1]-g,x2:a[2]+x,y2:a[3]+g})}a=s}null!=s&&n.addSegment(t,"Straight",{x1:s[0],y1:s[1],x2:s[2],y2:s[3]})};this._compute=function(t,e){i=[],r=null,a=null;var h=function(){return[t.startStubX,t.startStubY,t.endStubX,t.endStubY]},l={perpendicular:h,orthogonal:h,opposite:function(e){var i=t,n="x"===e?0:1;return!o&&{x:function(){return 1===i.so[n]&&(i.startStubX>i.endStubX&&i.tx>i.startStubX||i.sx>i.endStubX&&i.tx>i.sx)||-1===i.so[n]&&(i.startStubX<i.endStubX&&i.tx<i.startStubX||i.sx<i.endStubX&&i.tx<i.sx)},y:function(){return 1===i.so[n]&&(i.startStubY>i.endStubY&&i.ty>i.startStubY||i.sy>i.endStubY&&i.ty>i.sy)||-1===i.so[n]&&(i.startStubY<i.endStubY&&i.ty<i.startStubY||i.sy<i.endStubY&&i.ty<i.sy)}}[e]()?{x:[(t.sx+t.tx)/2,t.startStubY,(t.sx+t.tx)/2,t.endStubY],y:[t.startStubX,(t.sy+t.ty)/2,t.endStubX,(t.sy+t.ty)/2]}[e]:[t.startStubX,t.startStubY,t.endStubX,t.endStubY]}}[t.anchorOrientation](t.sourceAxis),c="x"===t.sourceAxis?0:1,f="x"===t.sourceAxis?1:0,p=l[c],d=l[f],y=l[c+2],v=l[f+2];u(i,l[0],l[1],t);var b=t.startStubX+(t.endStubX-t.startStubX)*s,x=t.startStubY+(t.endStubY-t.startStubY)*s,g={x:[0,1],y:[1,0]},T={perpendicular:function(e){var i={x:[[t.startStubX,t.endStubX],null,[t.endStubX,t.startStubX]],y:[[t.startStubY,t.endStubY],null,[t.endStubY,t.startStubY]]},n={x:[t.startStubY,t.endStubY],y:[t.startStubX,t.endStubX]},s=g[e][1],o=t.so[g[e][0]]+1,r=-1===t.to[s]&&n[e][1]<n[e][0]||1===t.to[s]&&n[e][1]>n[e][0],a=i[e][o][0],h=i[e][o][1],l={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[e][o][t.to[s]+1];return t.segment===l[3]||t.segment===l[2]&&r?{x:[[b,t.startStubY],[b,t.endStubY]],y:[[t.startStubX,x],[t.endStubX,x]]}[e]:t.segment===l[2]&&h<a?{x:[[t.endStubX,t.startStubY]],y:[[t.startStubX,t.endStubY]]}[e]:t.segment===l[2]&&h>=a||t.segment===l[1]&&!r?{x:[[t.startStubX,x],[t.endStubX,x],[t.endStubX,t.endStubY]],y:[[b,t.startStubY],[b,t.endStubY],[t.endStubX,t.endStubY]]}[e]:t.segment===l[0]||t.segment===l[1]&&r?{x:[[t.startStubX,t.endStubY],[t.endStubX,t.endStubY]],y:[[t.endStubX,t.startStubY],[t.endStubX,t.endStubY]]}[e]:void 0},orthogonal:function(e,i,n,s,o){var r=t,a={x:-1===r.so[0]?Math.min(i,s):Math.max(i,s),y:-1===r.so[1]?Math.min(i,s):Math.max(i,s)}[e];return{x:[[a,n],[a,o],[s,o]],y:[[n,a],[o,a],[o,s]]}[e]},opposite:function(i,s,o,r){var a=t,h={x:"y",y:"x"}[i],l={x:"height",y:"width"}[i],u=a["is"+i.toUpperCase()+"GreaterThanStubTimes2"];if(e.sourceEndpoint.elementId===e.targetEndpoint.elementId){var f=o+(1-e.sourceEndpoint.anchor[h])*e.sourceInfo[l]+n.maxStub;return{x:[[s,f],[r,f]],y:[[f,s],[f,r]]}[i]}return!u||1===a.so[c]&&s>r||-1===a.so[c]&&s<r?{x:[[s,x],[r,x]],y:[[b,s],[b,r]]}[i]:1===a.so[c]&&s<r||-1===a.so[c]&&s>r?{x:[[b,a.sy],[b,a.ty]],y:[[a.sx,x],[a.tx,x]]}[i]:void 0}}[t.anchorOrientation](t.sourceAxis,p,d,y,v);if(T)for(var w=0;w<T.length;w++)u(i,T[w][0],T[w][1],t);u(i,l[2],l[3],t),u(i,t.tx,t.ty,t),m(this,i,t)}},e.extend(t.Connectors.Flowchart,t.Connectors.AbstractConnector)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,e=this.jsPlumbUtil;t.Connectors.AbstractBezierConnector=function(e){var i,n=!1!==(e=e||{}).showLoopback,s=e.margin||5,o=e.orientation&&"clockwise"===e.orientation,r=e.loopbackRadius||25;return this._compute=function(t,e){var a=e.sourcePos,h=e.targetPos,l=Math.abs(a[0]-h[0]),c=Math.abs(a[1]-h[1]);if(n&&e.sourceEndpoint.elementId===e.targetEndpoint.elementId){var u=e.sourcePos[0],f=e.sourcePos[1]-s,p=u,m=f-r,d=p-r,y=m-r;l=2*r,c=2*r,t.points[0]=d,t.points[1]=y,t.points[2]=l,t.points[3]=c,i.addSegment(this,"Arc",{loopback:!0,x1:u-d+4,y1:f-y,startAngle:0,endAngle:2*Math.PI,r,ac:!o,x2:u-d-4,y2:f-y,cx:p-d,cy:m-y})}else this._computeBezier(t,e,a,h,l,c)},i=t.Connectors.AbstractConnector.apply(this,arguments)},e.extend(t.Connectors.AbstractBezierConnector,t.Connectors.AbstractConnector);var i=function(e){e=e||{},this.type="Bezier";var i=t.Connectors.AbstractBezierConnector.apply(this,arguments),n=e.curviness||150,s=10;this.getCurviness=function(){return n},this._findControlPoint=function(t,e,i,o,r,a,h){var l=[];return a[0]!==h[0]||a[1]===h[1]?(l.push(0===h[0]?i[0]<e[0]?t[0]+s:t[0]-s:t[0]+n*h[0]),l.push(0===h[1]?i[1]<e[1]?t[1]+s:t[1]-s:t[1]+n*a[1])):(l.push(0===a[0]?e[0]<i[0]?t[0]+s:t[0]-s:t[0]-n*a[0]),l.push(0===a[1]?e[1]<i[1]?t[1]+s:t[1]-s:t[1]+n*h[1])),l},this._computeBezier=function(t,e,n,s,o,r){var a,h,l=n[0]<s[0]?o:0,c=n[1]<s[1]?r:0,u=n[0]<s[0]?0:o,f=n[1]<s[1]?0:r;a=this._findControlPoint([l,c],n,s,e.sourceEndpoint,e.targetEndpoint,t.so,t.to),h=this._findControlPoint([u,f],s,n,e.targetEndpoint,e.sourceEndpoint,t.to,t.so),i.addSegment(this,"Bezier",{x1:l,y1:c,x2:u,y2:f,cp1x:a[0],cp1y:a[1],cp2x:h[0],cp2y:h[1]})}};t.Connectors.Bezier=i,e.extend(i,t.Connectors.AbstractBezierConnector)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,e=this.jsPlumbUtil,i=function(t,e,i,n){return t<=i&&n<=e?1:t<=i&&e<=n?2:i<=t&&n>=e?3:4},n=function(t,e,i,n,s,o,r,a,h){return a<=h?[t,e]:1===i?n[3]<=0&&s[3]>=1?[t+(n[2]<.5?-1*o:o),e]:n[2]>=1&&s[2]<=0?[t,e+(n[3]<.5?-1*r:r)]:[t+-1*o,e+-1*r]:2===i?n[3]>=1&&s[3]<=0?[t+(n[2]<.5?-1*o:o),e]:n[2]>=1&&s[2]<=0?[t,e+(n[3]<.5?-1*r:r)]:[t+o,e+-1*r]:3===i?n[3]>=1&&s[3]<=0?[t+(n[2]<.5?-1*o:o),e]:n[2]<=0&&s[2]>=1?[t,e+(n[3]<.5?-1*r:r)]:[t+-1*o,e+-1*r]:4===i?n[3]<=0&&s[3]>=1?[t+(n[2]<.5?-1*o:o),e]:n[2]<=0&&s[2]>=1?[t,e+(n[3]<.5?-1*r:r)]:[t+o,e+-1*r]:void 0},s=function(e){e=e||{},this.type="StateMachine";var s,o=t.Connectors.AbstractBezierConnector.apply(this,arguments),r=e.curviness||10,a=e.margin||5,h=e.proximityLimit||80;this._computeBezier=function(t,e,l,c,u,f){var p=e.sourcePos[0]<e.targetPos[0]?0:u,m=e.sourcePos[1]<e.targetPos[1]?0:f,d=e.sourcePos[0]<e.targetPos[0]?u:0,y=e.sourcePos[1]<e.targetPos[1]?f:0;0===e.sourcePos[2]&&(p-=a),1===e.sourcePos[2]&&(p+=a),0===e.sourcePos[3]&&(m-=a),1===e.sourcePos[3]&&(m+=a),0===e.targetPos[2]&&(d-=a),1===e.targetPos[2]&&(d+=a),0===e.targetPos[3]&&(y-=a),1===e.targetPos[3]&&(y+=a);var v=(p+d)/2,b=(m+y)/2,x=i(p,m,d,y),g=Math.sqrt(Math.pow(d-p,2)+Math.pow(y-m,2));s=n(v,b,x,e.sourcePos,e.targetPos,r,r,g,h),o.addSegment(this,"Bezier",{x1:d,y1:y,x2:p,y2:m,cp1x:s[0],cp1y:s[1],cp2x:s[0],cp2y:s[1]})}};t.Connectors.StateMachine=s,e.extend(s,t.Connectors.AbstractBezierConnector)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,e=this.jsPlumbUtil,i=function(){this.type="Straight";var e=t.Connectors.AbstractConnector.apply(this,arguments);this._compute=function(t){e.addSegment(this,"Straight",{x1:t.sx,y1:t.sy,x2:t.startStubX,y2:t.startStubY}),e.addSegment(this,"Straight",{x1:t.startStubX,y1:t.startStubY,x2:t.endStubX,y2:t.endStubY}),e.addSegment(this,"Straight",{x1:t.endStubX,y1:t.endStubY,x2:t.tx,y2:t.ty})}};t.Connectors.Straight=i,e.extend(i,t.Connectors.AbstractConnector)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t=this.jsPlumb,e=this.jsPlumbUtil,i={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},n="http://www.w3.org/2000/svg",s=function(t,e){for(var i in e)t.setAttribute(i,""+e[i])},o=function(e,i){return(i=i||{}).version="1.1",i.xmlns=n,t.createElementNS(n,e,null,null,i)},r=function(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"},a=function(t){for(var e=t.querySelectorAll(" defs,linearGradient,radialGradient"),i=0;i<e.length;i++)e[i].parentNode.removeChild(e[i])},h=function(t,e,n,s,r){if(e.setAttribute("fill",n.fill?n.fill:"none"),e.setAttribute("stroke",n.stroke?n.stroke:"none"),n.gradient?function(t,e,i,n,s){var r,h="jsplumb_gradient_"+s._jsPlumb.instance.idstamp();a(t),r=i.gradient.offset?o("radialGradient",{id:h}):o("linearGradient",{id:h,gradientUnits:"userSpaceOnUse"});var l=o("defs");t.appendChild(l),l.appendChild(r);for(var c=0;c<i.gradient.stops.length;c++){var u=i.gradient.stops[1===s.segment||2===s.segment?c:i.gradient.stops.length-1-c][1],f=o("stop",{offset:Math.floor(100*i.gradient.stops[c][0])+"%","stop-color":u});r.appendChild(f)}e.setAttribute(i.stroke?"stroke":"fill","url(#"+h+")")}(t,e,n,0,r):(a(t),e.setAttribute("style","")),n.strokeWidth&&e.setAttribute("stroke-width",n.strokeWidth),n.dashstyle&&n.strokeWidth&&!n["stroke-dasharray"]){var h=-1===n.dashstyle.indexOf(",")?" ":",",l=n.dashstyle.split(h),c="";l.forEach(function(t){c+=Math.floor(t*n.strokeWidth)+h}),e.setAttribute("stroke-dasharray",c)}else n["stroke-dasharray"]&&e.setAttribute("stroke-dasharray",n["stroke-dasharray"]);for(var u in i)n[u]&&e.setAttribute(i[u],n[u])},l=function(t,e,i){t.childNodes.length>i?t.insertBefore(e,t.childNodes[i]):t.appendChild(e)};e.svg={node:o,attr:s,pos:r};var c=function(i){var n=i.pointerEventsSpec||"all",a={};t.jsPlumbUIComponent.apply(this,i.originalArgs),this.canvas=null,this.path=null,this.svg=null,this.bgCanvas=null;var h=i.cssClass+" "+(i.originalArgs[0].cssClass||"");this.svg=o("svg",{style:"",width:0,height:0,"pointer-events":n,position:"absolute"}),i.useDivWrapper?(this.canvas=t.createElement("div",{position:"absolute"}),e.sizeElement(this.canvas,0,0,1,1),this.canvas.className=h):(s(this.svg,{class:h}),this.canvas=this.svg),i._jsPlumb.appendElement(this.canvas,i.originalArgs[0].parent),i.useDivWrapper&&this.canvas.appendChild(this.svg);var l=[this.canvas];return this.getDisplayElements=function(){return l},this.appendDisplayElement=function(t){l.push(t)},this.paint=function(t,n,o){if(null!=t){var h,l=[this.x,this.y],c=[this.w,this.h];null!=o&&(o.xmin<0&&(l[0]+=o.xmin),o.ymin<0&&(l[1]+=o.ymin),c[0]=o.xmax+(o.xmin<0?-o.xmin:0),c[1]=o.ymax+(o.ymin<0?-o.ymin:0)),i.useDivWrapper?(e.sizeElement(this.canvas,l[0],l[1],c[0],c[1]),l[0]=0,l[1]=0,h=r([0,0])):h=r([l[0],l[1]]),a.paint.apply(this,arguments),s(this.svg,{style:h,width:c[0]||0,height:c[1]||0})}},{renderer:a}};e.extend(c,t.jsPlumbUIComponent,{cleanup:function(t){t||null==this.typeId?(this.canvas&&(this.canvas._jsPlumb=null),this.svg&&(this.svg._jsPlumb=null),this.bgCanvas&&(this.bgCanvas._jsPlumb=null),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.bgCanvas&&this.bgCanvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.svg=null,this.canvas=null,this.path=null,this.group=null):(this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.bgCanvas&&this.bgCanvas.parentNode&&this.bgCanvas.parentNode.removeChild(this.bgCanvas))},reattach:function(t){var e=t.getContainer();this.canvas&&null==this.canvas.parentNode&&e.appendChild(this.canvas),this.bgCanvas&&null==this.bgCanvas.parentNode&&e.appendChild(this.bgCanvas)},setVisible:function(t){this.canvas&&(this.canvas.style.display=t?"block":"none")}}),t.ConnectorRenderers.svg=function(e){var i=this,n=c.apply(this,[{cssClass:e._jsPlumb.connectorClass,originalArgs:arguments,pointerEventsSpec:"none",_jsPlumb:e._jsPlumb}]);n.renderer.paint=function(n,r,a){var c=i.getSegments(),u=[0,0];if(a.xmin<0&&(u[0]=-a.xmin),a.ymin<0&&(u[1]=-a.ymin),c.length>0){var f={d:i.getPathData(),transform:"translate("+u[0]+","+u[1]+")","pointer-events":e["pointer-events"]||"visibleStroke"},p=null;if(n.outlineStroke){var m=n.strokeWidth+2*(n.outlineWidth||1);delete(p=t.extend({},n)).gradient,p.stroke=n.outlineStroke,p.strokeWidth=m,null==i.bgPath?(i.bgPath=o("path",f),t.addClass(i.bgPath,t.connectorOutlineClass),l(i.svg,i.bgPath,0)):s(i.bgPath,f),h(i.svg,i.bgPath,p,0,i)}null==i.path?(i.path=o("path",f),l(i.svg,i.path,n.outlineStroke?1:0)):s(i.path,f),h(i.svg,i.path,n,0,i)}}},e.extend(t.ConnectorRenderers.svg,c);var u=t.SvgEndpoint=function(e){var i=c.apply(this,[{cssClass:e._jsPlumb.endpointClass,originalArgs:arguments,pointerEventsSpec:"all",useDivWrapper:!0,_jsPlumb:e._jsPlumb}]);i.renderer.paint=function(e){var i=t.extend({},e);i.outlineStroke&&(i.stroke=i.outlineStroke),null==this.node?(this.node=this.makeNode(i),this.svg.appendChild(this.node)):null!=this.updateNode&&this.updateNode(this.node),h(this.svg,this.node,i,0,this)}.bind(this)};e.extend(u,c),t.Endpoints.svg.Dot=function(){t.Endpoints.Dot.apply(this,arguments),u.apply(this,arguments),this.makeNode=function(){return o("circle",{cx:this.w/2,cy:this.h/2,r:this.radius})},this.updateNode=function(t){s(t,{cx:this.w/2,cy:this.h/2,r:this.radius})}},e.extend(t.Endpoints.svg.Dot,[t.Endpoints.Dot,u]),t.Endpoints.svg.Rectangle=function(){t.Endpoints.Rectangle.apply(this,arguments),u.apply(this,arguments),this.makeNode=function(){return o("rect",{width:this.w,height:this.h})},this.updateNode=function(t){s(t,{width:this.w,height:this.h})}},e.extend(t.Endpoints.svg.Rectangle,[t.Endpoints.Rectangle,u]),t.Endpoints.svg.Image=t.Endpoints.Image,t.Endpoints.svg.Blank=t.Endpoints.Blank,t.Overlays.svg.Label=t.Overlays.Label,t.Overlays.svg.Custom=t.Overlays.Custom;var f=function(e,i){e.apply(this,i),t.jsPlumbUIComponent.apply(this,i),this.isAppendedAtTopLevel=!1,this.path=null,this.paint=function(t,e){if(t.component.svg&&e){null==this.path&&(this.path=o("path",{"pointer-events":"all"}),t.component.svg.appendChild(this.path),this.elementCreated&&this.elementCreated(this.path,t.component),this.canvas=t.component.svg);var r=i&&1===i.length&&i[0].cssClass||"",a=[0,0];e.xmin<0&&(a[0]=-e.xmin),e.ymin<0&&(a[1]=-e.ymin),s(this.path,{d:n(t.d),class:r,stroke:t.stroke?t.stroke:null,fill:t.fill?t.fill:null,transform:"translate("+a[0]+","+a[1]+")"})}};var n=function(t){return isNaN(t.cxy.x)||isNaN(t.cxy.y)?"":"M"+t.hxy.x+","+t.hxy.y+" L"+t.tail[0].x+","+t.tail[0].y+" L"+t.cxy.x+","+t.cxy.y+" L"+t.tail[1].x+","+t.tail[1].y+" L"+t.hxy.x+","+t.hxy.y};this.transfer=function(t){t.canvas&&this.path&&this.path.parentNode&&(this.path.parentNode.removeChild(this.path),t.canvas.appendChild(this.path))}};e.extend(f,[t.jsPlumbUIComponent,t.Overlays.AbstractOverlay],{cleanup:function(t){null!=this.path&&(t?this._jsPlumb.instance.removeElement(this.path):this.path.parentNode&&this.path.parentNode.removeChild(this.path))},reattach:function(t,e){this.path&&e.canvas&&e.canvas.appendChild(this.path)},setVisible:function(t){null!=this.path&&(this.path.style.display=t?"block":"none")}}),t.Overlays.svg.Arrow=function(){f.apply(this,[t.Overlays.Arrow,arguments])},e.extend(t.Overlays.svg.Arrow,[t.Overlays.Arrow,f]),t.Overlays.svg.PlainArrow=function(){f.apply(this,[t.Overlays.PlainArrow,arguments])},e.extend(t.Overlays.svg.PlainArrow,[t.Overlays.PlainArrow,f]),t.Overlays.svg.Diamond=function(){f.apply(this,[t.Overlays.Diamond,arguments])},e.extend(t.Overlays.svg.Diamond,[t.Overlays.Diamond,f]),t.Overlays.svg.GuideLines=function(){var e,i,n=null,r=this;t.Overlays.GuideLines.apply(this,arguments),this.paint=function(t,h){null==n&&(n=o("path"),t.connector.svg.appendChild(n),r.attachListeners(n,t.connector),r.attachListeners(n,r),e=o("path"),t.connector.svg.appendChild(e),r.attachListeners(e,t.connector),r.attachListeners(e,r),i=o("path"),t.connector.svg.appendChild(i),r.attachListeners(i,t.connector),r.attachListeners(i,r));var l=[0,0];h.xmin<0&&(l[0]=-h.xmin),h.ymin<0&&(l[1]=-h.ymin),s(n,{d:a(t.head,t.tail),stroke:"red",fill:null,transform:"translate("+l[0]+","+l[1]+")"}),s(e,{d:a(t.tailLine[0],t.tailLine[1]),stroke:"blue",fill:null,transform:"translate("+l[0]+","+l[1]+")"}),s(i,{d:a(t.headLine[0],t.headLine[1]),stroke:"green",fill:null,transform:"translate("+l[0]+","+l[1]+")"})};var a=function(t,e){return"M "+t.x+","+t.y+" L"+e.x+","+e.y}},e.extend(t.Overlays.svg.GuideLines,t.Overlays.GuideLines)}.call("undefined"!=typeof window?window:commonjsGlobal),function(){var t,e,i=this,n=i.jsPlumb,s=i.jsPlumbUtil,o=i.Katavorio,r=i.Biltong,a=function(t,e){var i="_katavorio_"+(e=e||"main"),s=t[i],a=t.getEventManager();return s||((s=new o({bind:a.on,unbind:a.off,getSize:n.getSize,getConstrainingRectangle:function(t){return[t.parentNode.scrollWidth,t.parentNode.scrollHeight]},getPosition:function(e,i){var n=t.getOffset(e,i,e._katavorioDrag?e.offsetParent:null);return[n.left,n.top]},setPosition:function(t,e){t.style.left=e[0]+"px",t.style.top=e[1]+"px"},addClass:n.addClass,removeClass:n.removeClass,intersects:r.intersects,indexOf:function(t,e){return t.indexOf(e)},scope:t.getDefaultScope(),css:{noSelect:t.dragSelectClass,droppable:"jtk-droppable",draggable:"jtk-draggable",drag:"jtk-drag",selected:"jtk-drag-selected",active:"jtk-drag-active",hover:"jtk-drag-hover",ghostProxy:"jtk-ghost-proxy"}})).setZoom(t.getZoom()),t[i]=s,t.bind("zoom",s.setZoom)),s},h=function(t,e){if(null==e)return[0,0];var i=p(e),n=f(i,0);return[n[t+"X"],n[t+"Y"]]},l=h.bind(this,"page"),c=h.bind(this,"screen"),u=h.bind(this,"client"),f=function(t,e){return t.item?t.item(e):t[e]},p=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},m=function(t){var e={},i=[],n={},s={},o={};this.register=function(r){var a,h=t.getId(r);e[h]||(e[h]=r,i.push(r),n[h]={});var l=function(e){if(e)for(var i=0;i<e.childNodes.length;i++)if(3!==e.childNodes[i].nodeType&&8!==e.childNodes[i].nodeType){var c=jsPlumb.getElement(e.childNodes[i]),u=t.getId(e.childNodes[i],null,!0);if(u&&s[u]&&s[u]>0){a||(a=t.getOffset(r));var f=t.getOffset(c);n[h][u]={id:u,offset:{left:f.left-a.left,top:f.top-a.top}},o[u]=h}l(e.childNodes[i])}};l(r)},this.updateOffsets=function(e,i){if(null!=e){i=i||{};var s,r=jsPlumb.getElement(e),a=t.getId(r),h=n[a];if(h)for(var l in h)if(h.hasOwnProperty(l)){var c=jsPlumb.getElement(l),u=i[l]||t.getOffset(c);if(null==c.offsetParent&&null!=n[a][l])continue;s||(s=t.getOffset(r)),n[a][l]={id:l,offset:{left:u.left-s.left,top:u.top-s.top}},o[l]=a}}},this.endpointAdded=function(i,r){r=r||t.getId(i);var a=document.body,h=i.parentNode;for(s[r]=s[r]?s[r]+1:1;null!=h&&h!==a;){var l=t.getId(h,null,!0);if(l&&e[l]){var c=t.getOffset(h);if(null==n[l][r]){var u=t.getOffset(i);n[l][r]={id:r,offset:{left:u.left-c.left,top:u.top-c.top}},o[r]=l}break}h=h.parentNode}},this.endpointDeleted=function(t){if(s[t.elementId]&&(s[t.elementId]--,s[t.elementId]<=0))for(var e in n)n.hasOwnProperty(e)&&n[e]&&(delete n[e][t.elementId],delete o[t.elementId])},this.changeId=function(t,e){n[e]=n[t],n[t]={},o[e]=o[t],o[t]=null},this.getElementsForDraggable=function(t){return n[t]},this.elementRemoved=function(t){var e=o[t];e&&(delete n[e][t],delete o[t])},this.reset=function(){e={},i=[],n={},s={}},this.dragEnded=function(e){if(null!=e.offsetParent){var i=t.getId(e),n=o[i];n&&this.updateOffsets(n)}},this.setParent=function(e,i,s,r,a){var h=o[i];n[r]||(n[r]={});var l=t.getOffset(s),c=a||t.getOffset(e);h&&n[h]&&delete n[h][i],n[r][i]={id:i,offset:{left:c.left-l.left,top:c.top-l.top}},o[i]=r},this.clearParent=function(t,e){var i=o[e];i&&(delete n[i][e],delete o[e])},this.revalidateParent=function(e,i,n){var s=o[i];if(s){var r={};r[i]=n,this.updateOffsets(s,r),t.revalidate(s)}},this.getDragAncestor=function(e){var i=jsPlumb.getElement(e),n=t.getId(i),s=o[n];return s?jsPlumb.getElement(s):null}},d=function(t,e,i){e=s.fastTrim(e),void 0!==t.className.baseVal?t.className.baseVal=e:t.className=e;try{var n=t.classList;if(null!=n){for(;n.length>0;)n.remove(n.item(0));for(var o=0;o<i.length;o++)i[o]&&n.add(i[o])}}catch(t){s.log("JSPLUMB: cannot set class list",t)}},y=function(t){return void 0===t.className.baseVal?t.className:t.className.baseVal},v=function(t,e,i){e=null==e?[]:s.isArray(e)?e:e.split(/\s+/),i=null==i?[]:s.isArray(i)?i:i.split(/\s+/);var n=y(t).split(/\s+/),o=function(t,e){for(var i=0;i<e.length;i++)if(t)-1===n.indexOf(e[i])&&n.push(e[i]);else{var s=n.indexOf(e[i]);-1!==s&&n.splice(s,1)}};o(!0,e),o(!1,i),d(t,n.join(" "),n)};i.jsPlumb.extend(i.jsPlumbInstance.prototype,{headless:!1,pageLocation:l,screenLocation:c,clientLocation:u,getDragManager:function(){return null==this.dragManager&&(this.dragManager=new m(this)),this.dragManager},recalculateOffsets:function(t){this.getDragManager().updateOffsets(t)},createElement:function(t,e,i,n){return this.createElementNS(null,t,e,i,n)},createElementNS:function(t,e,i,n,s){var o,r=null==t?document.createElement(e):document.createElementNS(t,e);for(o in i=i||{})r.style[o]=i[o];for(o in n&&(r.className=n),s=s||{})r.setAttribute(o,""+s[o]);return r},getAttribute:function(t,e){return null!=t.getAttribute?t.getAttribute(e):null},setAttribute:function(t,e,i){null!=t.setAttribute&&t.setAttribute(e,i)},setAttributes:function(t,e){for(var i in e)e.hasOwnProperty(i)&&t.setAttribute(i,e[i])},appendToRoot:function(t){document.body.appendChild(t)},getRenderModes:function(){return["svg"]},getClass:y,addClass:function(t,e){jsPlumb.each(t,function(t){v(t,e)})},hasClass:function(t,e){return(t=jsPlumb.getElement(t)).classList?t.classList.contains(e):-1!==y(t).indexOf(e)},removeClass:function(t,e){jsPlumb.each(t,function(t){v(t,null,e)})},toggleClass:function(t,e){jsPlumb.hasClass(t,e)?jsPlumb.removeClass(t,e):jsPlumb.addClass(t,e)},updateClasses:function(t,e,i){jsPlumb.each(t,function(t){v(t,e,i)})},setClass:function(t,e){null!=e&&jsPlumb.each(t,function(t){d(t,e,e.split(/\s+/))})},setPosition:function(t,e){t.style.left=e.left+"px",t.style.top=e.top+"px"},getPosition:function(t){var e=function(e){var i=t.style[e];return i?i.substring(0,i.length-2):0};return{left:e("left"),top:e("top")}},getStyle:function(t,e){return void 0!==window.getComputedStyle?getComputedStyle(t,null).getPropertyValue(e):t.currentStyle[e]},getSelector:function(t,e){return 1===arguments.length?null!=t.nodeType?t:document.querySelectorAll(t):t.querySelectorAll(e)},getOffset:function(t,e,i){t=jsPlumb.getElement(t),i=i||this.getContainer();for(var n={left:t.offsetLeft,top:t.offsetTop},s=e||null!=i&&t!==i&&t.offsetParent!==i?t.offsetParent:null,o=function(t){null!=t&&t!==document.body&&(t.scrollTop>0||t.scrollLeft>0)&&(n.left-=t.scrollLeft,n.top-=t.scrollTop)}.bind(this);null!=s;)n.left+=s.offsetLeft,n.top+=s.offsetTop,o(s),s=e?s.offsetParent:s.offsetParent===i?null:s.offsetParent;if(null!=i&&!e&&(i.scrollTop>0||i.scrollLeft>0)){var r=null!=t.offsetParent?this.getStyle(t.offsetParent,"position"):"static",a=this.getStyle(t,"position");"absolute"!==a&&"fixed"!==a&&"absolute"!==r&&"fixed"!==r&&(n.left-=i.scrollLeft,n.top-=i.scrollTop)}return n},getPositionOnElement:function(t,e,i){var n=void 0!==e.getBoundingClientRect?e.getBoundingClientRect():{left:0,top:0,width:0,height:0},s=document.body,o=document.documentElement,r=window.pageYOffset||o.scrollTop||s.scrollTop,a=window.pageXOffset||o.scrollLeft||s.scrollLeft,h=n.top+r-(o.clientTop||s.clientTop||0)+0*i,l=n.left+a-(o.clientLeft||s.clientLeft||0)+0*i,c=jsPlumb.pageLocation(t);return[(c[0]-l)/(n.width||e.offsetWidth*i),(c[1]-h)/(n.height||e.offsetHeight*i)]},getAbsolutePosition:function(t){var e=function(e){var i=t.style[e];if(i)return parseFloat(i.substring(0,i.length-2))};return[e("left"),e("top")]},setAbsolutePosition:function(t,e,i,n){i?this.animate(t,{left:"+="+(e[0]-i[0]),top:"+="+(e[1]-i[1])},n):(t.style.left=e[0]+"px",t.style.top=e[1]+"px")},getSize:function(t){return[t.offsetWidth,t.offsetHeight]},getWidth:function(t){return t.offsetWidth},getHeight:function(t){return t.offsetHeight},getRenderMode:function(){return"svg"},draggable:function(t,e){var i;return t=s.isArray(t)||null!=t.length&&!s.isString(t)?t:[t],Array.prototype.slice.call(t).forEach(function(t){(i=this.info(t)).el&&this._initDraggableIfNecessary(i.el,!0,e,i.id,!0)}.bind(this)),this},initDraggable:function(t,e,i){a(this,i).draggable(t,e),t._jsPlumbDragOptions=e},destroyDraggable:function(t,e){a(this,e).destroyDraggable(t),delete t._jsPlumbDragOptions},unbindDraggable:function(t,e,i,n){a(this,n).destroyDraggable(t,e,i)},setDraggable:function(t,e){return jsPlumb.each(t,function(t){this.isDragSupported(t)&&(this._draggableStates[this.getAttribute(t,"id")]=e,this.setElementDraggable(t,e))}.bind(this))},_draggableStates:{},toggleDraggable:function(t){var e;return jsPlumb.each(t,function(t){var i=this.getAttribute(t,"id");return this._draggableStates[i]=e=!(e=null!=this._draggableStates[i]&&this._draggableStates[i]),this.setDraggable(t,e),e}.bind(this)),e},_initDraggableIfNecessary:function(t,e,i,n,o){if(!jsPlumb.headless&&null!=e&&e&&jsPlumb.isDragSupported(t,this)){var r=i||this.Defaults.DragOptions;if(r=jsPlumb.extend({},r),jsPlumb.isAlreadyDraggable(t,this))i.force&&this.initDraggable(t,r);else{var a=jsPlumb.dragEvents.drag,h=jsPlumb.dragEvents.stop,l=jsPlumb.dragEvents.start;this.manage(n,t),r[l]=s.wrap(r[l],function(t){var e=t.el._jsPlumbDragOptions,i=!0;return e.canDrag&&(i=e.canDrag()),i&&(this.setHoverSuspended(!0),this.select({source:t.el}).addClass(this.elementDraggingClass+" "+this.sourceElementDraggingClass,!0),this.select({target:t.el}).addClass(this.elementDraggingClass+" "+this.targetElementDraggingClass,!0),this.setConnectionBeingDragged(!0)),i}.bind(this)),r[a]=s.wrap(r[a],function(t){var e=this.getUIPosition(arguments,this.getZoom());if(null!=e){var i=t.el._jsPlumbDragOptions;this.draw(t.el,e,null,!0),i._dragging&&this.addClass(t.el,"jtk-dragged"),i._dragging=!0}}.bind(this)),r[h]=s.wrap(r[h],function(t){for(var e,i=t.selection,n=function(t){null!=t[1]&&(e=this.getUIPosition([{el:t[2].el,pos:[t[1].left,t[1].top]}]),this.draw(t[2].el,e)),delete t[0]._jsPlumbDragOptions._dragging,this.removeClass(t[0],"jtk-dragged"),this.select({source:t[2].el}).removeClass(this.elementDraggingClass+" "+this.sourceElementDraggingClass,!0),this.select({target:t[2].el}).removeClass(this.elementDraggingClass+" "+this.targetElementDraggingClass,!0),this.getDragManager().dragEnded(t[2].el)}.bind(this),s=0;s<i.length;s++)n(i[s]);this.setHoverSuspended(!1),this.setConnectionBeingDragged(!1)}.bind(this));var c=this.getId(t);this._draggableStates[c]=!0;var u=this._draggableStates[c];r.disabled=null!=u&&!u,this.initDraggable(t,r),this.getDragManager().register(t),o&&this.fire("elementDraggable",{el:t,options:r})}}},animationSupported:!0,getElement:function(t){return null==t?null:"string"==typeof(t="string"==typeof t?t:null!=t.length&&null==t.enctype?t[0]:t)?document.getElementById(t):t},removeElement:function(t){a(this).elementRemoved(t),this.getEventManager().remove(t)},doAnimate:function(t,e,i){i=i||{};var o=this.getOffset(t),r=function(t,e){var i=function(i){if(null!=e[i]){if(s.isString(e[i])){var n=e[i].match(/-=/)?-1:1,o=e[i].substring(2);return t[i]+n*o}return e[i]}return t[i]};return[i("left"),i("top")]}(o,e),a=i.duration||250,h=a/15,l=15/a*(r[0]-o.left),c=15/a*(r[1]-o.top),u=0,f=setInterval(function(){n.setPosition(t,{left:o.left+l*(u+1),top:o.top+c*(u+1)}),null!=i.step&&i.step(u,Math.ceil(h)),++u>=h&&(window.clearInterval(f),null!=i.complete&&i.complete())},15)},destroyDroppable:function(t,e){a(this,e).destroyDroppable(t)},unbindDroppable:function(t,e,i,n){a(this,n).destroyDroppable(t,e,i)},droppable:function(t,e){var i;return t=s.isArray(t)||null!=t.length&&!s.isString(t)?t:[t],(e=e||{}).allowLoopback=!1,Array.prototype.slice.call(t).forEach(function(t){(i=this.info(t)).el&&this.initDroppable(i.el,e)}.bind(this)),this},initDroppable:function(t,e,i){a(this,i).droppable(t,e)},isAlreadyDraggable:function(t){return null!=t._katavorioDrag},isDragSupported:function(){return!0},isDropSupported:function(){return!0},isElementDraggable:function(t){return(t=n.getElement(t))._katavorioDrag&&t._katavorioDrag.isEnabled()},getDragObject:function(t){return t[0].drag.getDragElement()},getDragScope:function(t){return t._katavorioDrag&&t._katavorioDrag.scopes.join(" ")||""},getDropEvent:function(t){return t[0].e},getUIPosition:function(t){var e=t[0].el;if(null==e.offsetParent)return null;var i=t[0].finalPos||t[0].pos,n={left:i[0],top:i[1]};if(e._katavorioDrag&&e.offsetParent!==this.getContainer()){var s=this.getOffset(e.offsetParent);n.left+=s.left,n.top+=s.top}return n},setDragFilter:function(t,e,i){t._katavorioDrag&&t._katavorioDrag.setFilter(e,i)},setElementDraggable:function(t,e){(t=n.getElement(t))._katavorioDrag&&t._katavorioDrag.setEnabled(e)},setDragScope:function(t,e){t._katavorioDrag&&t._katavorioDrag.k.setDragScope(t,e)},setDropScope:function(t,e){t._katavorioDrop&&t._katavorioDrop.length>0&&t._katavorioDrop[0].k.setDropScope(t,e)},addToPosse:function(t,e){var i=Array.prototype.slice.call(arguments,1),s=a(this);n.each(t,function(t){(t=[n.getElement(t)]).push.apply(t,i),s.addToPosse.apply(s,t)})},setPosse:function(t,e){var i=Array.prototype.slice.call(arguments,1),s=a(this);n.each(t,function(t){(t=[n.getElement(t)]).push.apply(t,i),s.setPosse.apply(s,t)})},removeFromPosse:function(t,e){var i=Array.prototype.slice.call(arguments,1),s=a(this);n.each(t,function(t){(t=[n.getElement(t)]).push.apply(t,i),s.removeFromPosse.apply(s,t)})},removeFromAllPosses:function(t){var e=a(this);n.each(t,function(t){e.removeFromAllPosses(n.getElement(t))})},setPosseState:function(t,e,i){var s=a(this);n.each(t,function(t){s.setPosseState(n.getElement(t),e,i)})},dragEvents:{start:"start",stop:"stop",drag:"drag",step:"step",over:"over",out:"out",drop:"drop",complete:"complete",beforeStart:"beforeStart"},animEvents:{step:"step",complete:"complete"},stopDrag:function(t){t._katavorioDrag&&t._katavorioDrag.abort()},addToDragSelection:function(t){a(this).select(t)},removeFromDragSelection:function(t){a(this).deselect(t)},clearDragSelection:function(){a(this).deselectAll()},trigger:function(t,e,i,n){this.getEventManager().trigger(t,e,i,n)},doReset:function(){for(var t in this)0===t.indexOf("_katavorio_")&&this[t].reset()},getEventManager:function(){return(t=this._mottle)||(t=this._mottle=new i.Mottle),t;var t},on:function(t,e,i){return this.getEventManager().on.apply(this,arguments),this},off:function(t,e,i){return this.getEventManager().off.apply(this,arguments),this}}),t=n.init,(e=function(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?t():setTimeout(e,9)})()}.call("undefined"!=typeof window?window:commonjsGlobal)}),jsplumb_6=jsplumb.jsPlumb,rng;class JsPlumbUtils{}JsPlumbUtils.createInstance=(t,e)=>jsplumb_6.getInstance({ConnectionsDetachable:!e,DragOptions:{cursor:"pointer",zIndex:2e3},ConnectionOverlays:[["Arrow",{location:1,visible:!0,width:11,length:11}],["Label",{location:.5,id:"label",cssClass:"connection-label"}]],Container:t}),JsPlumbUtils.createEndpointUuid=(t,e)=>`activity-${t}-${e}`,JsPlumbUtils.colorEndpoint=t=>{var e="#7da7f2";switch(t){case"Done":case"True":e="#7CFC00";break;case"False":case"Fail":e="#FF4500";break;case"Call":e="#1E90FF";break;case"Other":e="#FFEBCD";break;case"OnOverdue":e="#FFD700";break;case"OnError":e="#B22222"}return e},JsPlumbUtils.getSourceEndpointOptions=(t,e,i)=>{const n=JsPlumbUtils.colorEndpoint(e),s=i?"#6faa44":"#999999";return{type:"Dot",anchor:"Continuous",paintStyle:{stroke:n,fill:n,strokeWidth:2},isSource:!0,connector:["Flowchart",{stub:[40,60],gap:0,cornerRadius:5,alwaysRespectStubs:!0}],connectorStyle:{strokeWidth:2,stroke:s},connectorHoverStyle:{strokeWidth:2,stroke:s},connectorOverlays:[["Label",{location:[3,-1.5],cssClass:"endpointSourceLabel"}]],hoverPaintStyle:{fill:n,stroke:n},dragOptions:{},uuid:JsPlumbUtils.createEndpointUuid(t,e),parameters:{outcome:e},scope:null,reattachConnections:!0,maxConnections:1}};var crypto=void 0!==commonjsGlobal&&(commonjsGlobal.crypto||commonjsGlobal.msCrypto);if(crypto&&crypto.getRandomValues){var rnds8=new Uint8Array(16);rng=function(){return crypto.getRandomValues(rnds8),rnds8}}if(!rng){var rnds=new Array(16);rng=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),rnds[e]=t>>>((3&e)<<3)&255;return rnds}}for(var rngBrowser=rng,byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);function bytesToUuid(t,e){var i=e||0;return byteToHex[t[i++]]+byteToHex[t[i++]]+byteToHex[t[i++]]+byteToHex[t[i++]]+"-"+byteToHex[t[i++]]+byteToHex[t[i++]]+"-"+byteToHex[t[i++]]+byteToHex[t[i++]]+"-"+byteToHex[t[i++]]+byteToHex[t[i++]]+"-"+byteToHex[t[i++]]+byteToHex[t[i++]]+byteToHex[t[i++]]+byteToHex[t[i++]]+byteToHex[t[i++]]+byteToHex[t[i++]]}var bytesToUuid_1=bytesToUuid;function v4(t,e,i){var n=e&&i||0;"string"==typeof t&&(e="binary"==t?new Array(16):null,t=null);var s=(t=t||{}).random||(t.rng||rngBrowser)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e)for(var o=0;o<16;++o)e[n+o]=s[o];return e||bytesToUuid_1(s)}var v4_1=v4;function deepClone(t){const e=JSON.stringify(t);return JSON.parse(e)}class Designer{constructor(t){registerInstance(this,t),this.activityDefinitions=[],this.workflow={activities:[],connections:[]},this.lastClickedLocation=null,this.elem=()=>this.el,this.renderContextMenu=()=>this.readonly?null:[h("wf-context-menu",{target:this.elem()},h("wf-context-menu-item",{text:"Add",onClick:this.onAddActivityClick})),h("wf-context-menu",{ref:t=>this.activityContextMenu=t},h("wf-context-menu-item",{text:"Edit",onClick:this.onEditActivityClick}),h("wf-context-menu-item",{text:"Delete",onClick:this.onDeleteActivityClick}))],this.deleteActivity=async t=>{const e=this.workflow.activities.filter(e=>e.id!==t.id),i=this.workflow.connections.filter(e=>e.sourceActivityId!=t.id&&e.destinationActivityId!=t.id);this.workflow=Object.assign({},this.workflow,{activities:e,connections:i})},this.setupJsPlumb=()=>{this.jsPlumb.reset(),this.setupJsPlumbEventHandlers(),this.jsPlumb.batch(()=>{this.getActivityElements().forEach(this.setupActivityElement),this.setupConnections()}),this.jsPlumb.repaintEverything()},this.setupPopovers=()=>{$('[data-toggle="popover"]').popover({})},this.setupActivityElement=t=>{this.readonly||this.setupDragDrop(t),this.setupTargets(t),this.setupOutcomes(t),this.jsPlumb.revalidate(t)},this.setupDragDrop=t=>{let e=null,i=!1;this.jsPlumb.draggable(t,{containment:"true",start:t=>{e={left:t.e.screenX,top:t.e.screenY}},stop:async n=>{if(!(i=e.left!==n.e.screenX||e.top!==n.e.screenY))return;const s=Object.assign({},this.findActivityByElement(t));s.left=n.pos[0],s.top=n.pos[1],await this.updateActivityInternal(s)}})},this.setupConnections=()=>{for(let t of this.workflow.connections){const e=JsPlumbUtils.createEndpointUuid(t.sourceActivityId,t.outcome),i=this.jsPlumb.getEndpoint(e);this.jsPlumb.connect({source:i,target:`wf-activity-${t.destinationActivityId}`})}},this.findActivityByElement=t=>{const e=Designer.getActivityId(t);return this.findActivityById(e)},this.findActivityById=t=>this.workflow.activities.find(e=>e.id===t),this.updateActivityInternal=async t=>{const e=[...this.workflow.activities],i=e.findIndex(e=>e.id==t.id);e[i]=Object.assign({},t),this.workflow=Object.assign({},this.workflow,{activities:e})},this.setupJsPlumbEventHandlers=()=>{this.jsPlumb.bind("connection",this.connectionCreated),this.jsPlumb.bind("connectionDetached",this.connectionDetached)},this.connectionCreated=async t=>{const e=t.connection,i=t.sourceEndpoint.getParameter("outcome");e.getOverlay("label").setLabel(i);const n=this.findActivityByElement(t.source),s=this.findActivityByElement(t.target);if(!this.workflow.connections.find(t=>t.sourceActivityId===n.id&&t.destinationActivityId==s.id)){const t=[...this.workflow.connections,{sourceActivityId:n.id,destinationActivityId:s.id,outcome:i}];this.workflow=Object.assign({},this.workflow,{connections:t})}},this.connectionDetached=async t=>{const e=t.sourceEndpoint.getParameter("outcome"),i=this.findActivityByElement(t.source),n=this.findActivityByElement(t.target),s=this.workflow.connections.filter(t=>!(t.sourceActivityId===i.id&&t.destinationActivityId===n.id&&t.outcome===e));this.workflow=Object.assign({},this.workflow,{connections:s})},this.onAddActivityClick=t=>{const e=this.elem();this.lastClickedLocation={left:t.pageX-e.offsetLeft,top:t.pageY-e.offsetTop},this.addActivityEvent.emit()},this.onDeleteActivityClick=async()=>{await this.deleteActivity(this.selectedActivity)},this.onEditActivityClick=()=>{this.onEditActivity(this.selectedActivity)},this.editActivityEvent=createEvent(this,"edit-activity",7),this.addActivityEvent=createEvent(this,"add-activity",7),this.workflowChanged=createEvent(this,"workflowChanged",7)}onWorkflowChanged(t){this.workflowChanged.emit(deepClone(t))}async newWorkflow(){this.workflow={activities:[],connections:[]}}async getWorkflow(){return deepClone(this.workflow)}async addActivity(t){const e=this.lastClickedLocation?this.lastClickedLocation.left:150,i=this.lastClickedLocation?this.lastClickedLocation.top:150,n={id:v4_1(),top:i,left:e,type:t.type,state:{}};this.lastClickedLocation=null;const s=[...this.workflow.activities,n];this.workflow=Object.assign({},this.workflow,{activities:s})}async updateActivity(t){await this.updateActivityInternal(t)}componentWillLoad(){this.jsPlumb=JsPlumbUtils.createInstance(".workflow-canvas",this.readonly)}componentDidRender(){this.setupJsPlumb(),this.setupPopovers()}render(){const t=this.createActivityModels();return h("host",{class:"workflow-canvas",ref:t=>this.canvas=t,style:{height:this.canvasHeight}},t.map(t=>{const e=t.activity,i={left:`${e.left}px`,top:`${e.top}px`},n={activity:!0,"activity-blocking":!!e.blocking,"activity-executed":!!e.executed,"activity-faulted":e.faulted};if(this.readonly){n.noselect=!0;const s={};return e.message&&(s["data-toggle"]="popover",s["data-trigger"]="hover",s.title=e.message.title,s["data-content"]=e.message.content),h("div",Object.assign({id:`wf-activity-${e.id}`,"data-activity-id":e.id,class:n,style:i},s),h("wf-activity-renderer",{activity:e,activityDefinition:t.definition,displayMode:ActivityDisplayMode.Design}))}return h("div",{id:`wf-activity-${e.id}`,"data-activity-id":e.id,class:n,style:i,onDblClick:()=>this.onEditActivity(e),onContextMenu:t=>this.onActivityContextMenu(t,e)},h("wf-activity-renderer",{activity:e,activityDefinition:t.definition,displayMode:ActivityDisplayMode.Design}))}),this.renderContextMenu())}createActivityModels(){const t=this.activityDefinitions||[];return(this.workflow||{activities:[],connections:[]}).activities.map(e=>{const i=t.find(t=>t.type==e.type);return{activity:e,definition:i}})}setupTargets(t){this.jsPlumb.makeTarget(t,{dropOptions:{hoverClass:"hover"},anchor:"Continuous",endpoint:["Blank",{radius:4}]})}setupOutcomes(t){const e=this.findActivityByElement(t),i=this.activityDefinitions.find(t=>t.type==e.type),n=ActivityManager$1.getOutcomes(e,i),s=e.executed;for(let i of n){const n=JsPlumbUtils.getSourceEndpointOptions(e.id,i,s);this.jsPlumb.addEndpoint(t,{connectorOverlays:[["Label",{label:i,cssClass:"connection-label"}]]},n)}}getActivityElements(){return this.elem().querySelectorAll(".activity")}static getActivityId(t){return t.attributes["data-activity-id"].value}onEditActivity(t){const e=deepClone(t);this.editActivityEvent.emit(e)}async onActivityContextMenu(t,e){this.selectedActivity=e,await this.activityContextMenu.handleContextMenuEvent(t)}get el(){return getElement(this)}static get watchers(){return{workflow:["onWorkflowChanged"]}}static get style(){return".jtk-group,.jtk-node{position:absolute}.jtk-group{overflow:visible}[jtk-group-content]{position:relative}.katavorio-clone-drag{pointer-events:none}.jtk-surface{overflow:hidden!important;position:relative;cursor:move;cursor:-moz-grab;cursor:-webkit-grab;-ms-touch-action:none;touch-action:none}.jtk-surface-panning{cursor:-moz-grabbing;cursor:-webkit-grabbing;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.jtk-surface-canvas{overflow:visible!important}.jtk-surface-droppable-node{-ms-touch-action:none;touch-action:none}.jtk-surface-nopan{overflow:scroll!important;cursor:default}.jtk-surface-tile{border:none;outline:none;margin:0;-webkit-transition:opacity .3s ease .15s;-moz-transition:opacity .3s ease .15s;-o-transition:opacity .3s ease .15s;-ms-transition:opacity .3s ease .15s;transition:opacity .3s ease .15s}.jtk-lasso{border:2px solid #3177b8;background-color:#f5f5f5;opacity:.5;display:none;z-index:20000;position:absolute}.jtk-lasso-select-defeat *{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.jtk-lasso-mask{position:fixed;z-index:20000;display:none;opacity:.5;background-color:#07234e;top:0;bottom:0;left:0;right:0}.jtk-surface-selected-element{border:2px dashed #f76258!important}.jtk-surface-pan{background-color:azure;opacity:.4;text-align:center;cursor:pointer;z-index:2;-webkit-transition:background-color .15s ease-in;-moz-transition:background-color .15s ease-in;-o-transition:background-color .15s ease-in;transition:background-color .15s ease-in}.jtk-surface-pan-bottom,.jtk-surface-pan-top{width:100%;height:20px}.jtk-surface-pan-bottom:hover,.jtk-surface-pan-left:hover,.jtk-surface-pan-right:hover,.jtk-surface-pan-top:hover{opacity:.6;background-color:#3177b8;color:#fff;font-weight:700}.jtk-surface-pan-left,.jtk-surface-pan-right{width:20px;height:100%;line-height:40}.jtk-surface-pan-active,.jtk-surface-pan-active:hover{background-color:#f76258}.jtk-miniview{overflow:hidden!important;width:125px;height:125px;position:relative;background-color:#b2c9cd;border:1px solid #e2e6cd;border-radius:4px;opacity:.8}.jtk-miniview-panner{border:5px dotted #f5f5f5;opacity:.4;background-color:#4f6f7e;cursor:move;cursor:-moz-grab;cursor:-webkit-grab}.jtk-miniview-panning{cursor:-moz-grabbing;cursor:-webkit-grabbing}.jtk-miniview-element{background-color:#607a86;position:absolute}.jtk-miniview-group-element{background:transparent;border:2px solid #607a86}.jtk-miniview-collapse{color:#f5f5f5;position:absolute;font-size:18px;top:-1px;right:3px;cursor:pointer;font-weight:700}.jtk-miniview-collapse:before{content:\"\\2012\"}.jtk-miniview-collapsed{background-color:#449ea6;border-radius:4px;height:22px;margin-right:0;padding:4px;width:21px}.jtk-miniview-collapsed .jtk-miniview-element,.jtk-miniview-collapsed .jtk-miniview-panner{visibility:hidden}.jtk-miniview-collapsed .jtk-miniview-collapse:before{content:\"+\"}.jtk-miniview-collapse:hover{color:#e4f013}.jtk-dialog-underlay{left:0;right:0;top:0;bottom:0;position:fixed;z-index:100000;opacity:.8;background-color:#ccc;display:none}.jtk-dialog-overlay{position:fixed;z-index:100001;display:none;background-color:#fff;font-family:Open Sans,sans-serif;padding:7px;-webkit-box-shadow:0 0 5px grey;box-shadow:0 0 5px grey;overflow:hidden}.jtk-dialog-overlay-x{max-height:0;transition:max-height .5s ease-in;-moz-transition:max-height .5s ease-in;-ms-transition:max-height .5s ease-in;-o-transition:max-height .5s ease-in;-webkit-transition:max-height .5s ease-in}.jtk-dialog-overlay-y{max-width:0;transition:max-width .5s ease-in;-moz-transition:max-width .5s ease-in;-ms-transition:max-width .5s ease-in;-o-transition:max-width .5s ease-in;-webkit-transition:max-width .5s ease-in}.jtk-dialog-overlay-top{top:20px}.jtk-dialog-overlay-bottom{bottom:20px}.jtk-dialog-overlay-left{left:20px}.jtk-dialog-overlay-right{right:20px}.jtk-dialog-overlay-x.jtk-dialog-overlay-visible{max-height:1000px}.jtk-dialog-overlay-y.jtk-dialog-overlay-visible{max-width:1000px}.jtk-dialog-buttons{text-align:right;margin-top:5px}.jtk-dialog-button{border:none;cursor:pointer;margin-right:5px;min-width:56px;background-color:#fff;outline:1px solid #ccc}.jtk-dialog-button:hover{color:#fff;background-color:#234b5e}.jtk-dialog-title{text-align:left;font-size:14px;margin-bottom:9px}.jtk-dialog-content{font-size:12px;text-align:left;min-width:250px;margin:0 14px}.jtk-dialog-content ul{width:100%;padding-left:0}.jtk-dialog-content label{cursor:pointer;font-weight:inherit}.jtk-dialog-overlay input,.jtk-dialog-overlay textarea{background-color:#fff;border:1px solid #ccc;color:#333;font-size:14px;font-style:normal;outline:none;padding:6px 4px;margin-right:6px}.jtk-dialog-overlay input:focus,.jtk-dialog-overlay textarea:focus{background-color:#cbeae1;border:1px solid #83b8a8;color:#333;font-size:14px;font-style:normal;outline:none}.jtk-draw-skeleton{position:absolute;left:0;right:0;top:0;bottom:0;outline:2px solid #84acb3;opacity:.8}.jtk-draw-handle{position:absolute;width:7px;height:7px;background-color:#84acb3}.jtk-draw-handle-tl{left:0;top:0;cursor:nw-resize}.jtk-draw-handle-tr{right:0;top:0;cursor:ne-resize}.jtk-draw-handle-bl{left:0;bottom:0;cursor:sw-resize}.jtk-draw-handle-br{bottom:0;right:0;cursor:se-resize}.jtk-draw-drag{display:none;position:absolute;left:50%;top:50%;margin-left:-10px;margin-top:-10px;width:20px;height:20px;background-color:#84acb3;cursor:move}.jtk-drag-select-defeat *{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.workflow-canvas{position:relative;display:block;-ms-touch-action:none;touch-action:none;width:auto;height:100vh}.workflow-canvas .noselect{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.workflow-canvas .activity{display:block;border:1px solid #ccc;-webkit-box-shadow:2px 2px 19px #aaa;box-shadow:2px 2px 19px #aaa;border-radius:.5em;opacity:.8;min-width:80px;min-height:80px;max-width:250px;text-align:left;z-index:20;position:absolute;background-color:#f1f1f1;color:#3d3d3d;font-family:helvetica,sans-serif;padding:1em;font-size:.7em;cursor:default;-webkit-transition:-webkit-box-shadow .15s ease-in;transition:-webkit-box-shadow .15s ease-in;transition:box-shadow .15s ease-in;transition:box-shadow .15s ease-in,-webkit-box-shadow .15s ease-in}.workflow-canvas .activity .activity-status{position:absolute;right:4px;bottom:4px;cursor:pointer}.workflow-canvas .activity .activity-status i{font-size:2em}.workflow-canvas .activity.activity-definition{border:1px solid #5a8fee}.workflow-canvas .activity.activity-executed{border:1px solid #6faa44;background-color:#6faa44;color:#fff}.workflow-canvas .activity.activity-executed h5,.workflow-canvas .activity.activity-executed h5 i{color:#fff}.workflow-canvas .activity.activity-blocking{border:1px solid #5a8fee;background-color:#5a8fee;color:#fff}.workflow-canvas .activity.activity-blocking h5,.workflow-canvas .activity.activity-blocking h5 i{color:#fff}.workflow-canvas .activity.activity-faulted{border:1px solid #d23c3c;background-color:#d23c3c;color:#fff}.workflow-canvas .activity.activity-faulted h5,.workflow-canvas .activity.activity-faulted h5 i{color:#fff}.jtk-connector{z-index:4}.endpointSourceLabel,.endpointTargetLabel,.jtk-endpoint{z-index:21;cursor:pointer}.endpointSourceLabel,.endpointTargetLabel{font-size:8px}.jtk-overlay{background-color:transparent}.connection-label{z-index:31;border:1px solid #ccc;padding:0 .5em;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;background-color:#fff}"}}var dragscroll=createCommonjsModule(function(t,e){!function(t){var e,i,n=window,s=document,o="mousemove",r="mouseup",a="mousedown",h="EventListener",l="add"+h,c="remove"+h,u=[],f=function(t,h){for(t=0;t<u.length;)(h=(h=u[t++]).container||h)[c](a,h.md,0),n[c](r,h.mu,0),n[c](o,h.mm,0);for(u=[].slice.call(s.getElementsByClassName("dragscroll")),t=0;t<u.length;)!function(t,h,c,u,f,p){(p=t.container||t)[l](a,p.md=function(e){t.hasAttribute("nochilddrag")&&s.elementFromPoint(e.pageX,e.pageY)!=p||(u=1,h=e.clientX,c=e.clientY,e.preventDefault())},0),n[l](r,p.mu=function(){u=0},0),n[l](o,p.mm=function(n){u&&((f=t.scroller||t).scrollLeft-=e=-h+(h=n.clientX),f.scrollTop-=i=-c+(c=n.clientY),t==s.body&&((f=s.documentElement).scrollLeft-=e,f.scrollTop-=i))},0)}(u[t++])};"complete"==s.readyState?f():n[l]("load",f,0),t.reset=f}(e)});class BooleanFieldDriver{constructor(){this.displayEditor=(t,e)=>{const i=e.name;return`<wf-boolean-field name="${i}" label="${e.label}" hint="${e.hint}" checked="${"true"===t.state[i]}"></wf-boolean-field>`},this.updateEditor=(t,e,i)=>{t.state[e.name]=i.get(e.name)}}}class ExpressionFieldDriver{constructor(){this.displayEditor=(t,e)=>{const i=e.name,n=e.label,s=t.state[i]||{expression:"",syntax:"Eval"},o=(e.options||{}).multiline||!1,r=s.expression.replace(/"/g,"&quot;");return`<wf-expression-field name="${i}" label="${n}" hint="${e.hint}" value="${r}" syntax="${s.syntax}" multiline="${o}"></wf-expression-field>`},this.updateEditor=(t,e,i)=>{const n=`${e.name}.syntax`,s=i.get(`${e.name}.expression`).toString().trim(),o=i.get(n).toString();t.state[e.name]={expression:s,syntax:o}}}}class ListFieldDriver{constructor(){this.displayEditor=(t,e)=>{const i=e.name,n=e.label,s=(t.state[i]||[]).join(", ");return`<wf-list-field name="${i}" label="${n}" hint="${e.hint}" items="${s}"></wf-list-field>`},this.updateEditor=(t,e,i)=>{const n=i.get(e.name).toString();t.state[e.name]=n.split(",").map(t=>t.trim())}}}class TextFieldDriver{constructor(){this.displayEditor=(t,e)=>{const i=e.name;return`<wf-text-field name="${i}" label="${e.label}" hint="${e.hint}" value="${t.state[i]||""}"></wf-text-field>`},this.updateEditor=(t,e,i)=>{t.state[e.name]=i.get(e.name).toString().trim()}}}class SelectFieldDriver{constructor(){this.displayEditor=(t,e)=>{const i=e.name,n=e.label,s=t.state[i]||"",o=encodeURI(JSON.stringify(e.options.items||[]));return`<wf-select-field name="${i}" label="${n}" hint="${e.hint}" data-items="${o}" value="${s}"></wf-select-field>`},this.updateEditor=(t,e,i)=>{const n=i.get(e.name).toString();t.state[e.name]=n.trim()}}}class WorkflowPluginStore{constructor(){this.plugins=[],this.add=t=>{this.plugins=[...this.plugins,t]},this.list=()=>[...this.plugins]}}const pluginStore=new WorkflowPluginStore,win=window,elsa=win.elsa||{};var OutcomeNames;elsa.pluginStore=pluginStore,win.elsa=elsa,function(t){t.Done="Done",t.True="True",t.False="False",t.Fail="Fail",t.Call="Call",t.Other="Other",t.OnOverdue="OnOverdue",t.OnError="OnError"}(OutcomeNames||(OutcomeNames={}));class ConsoleActivities{constructor(){this.getName=()=>"ConsoleActivities",this.getActivityDefinitions=()=>[this.readLine(),this.writeLine()],this.readLine=()=>({type:"ReadLine",displayName:"Read Line",description:"Read text from standard in.",runtimeDescription:"a => !!a.state.variableName ? `Read text from standard in and store into <strong>${ a.state.variableName }</strong>.` : 'Read text from standard in.'",outcomes:[OutcomeNames.Done],category:ConsoleActivities.Category,icon:"fas fa-terminal",properties:[{name:"variableName",type:"text",label:"Variable Name",hint:"The name of the variable to store the value into."}]}),this.writeLine=()=>({type:"WriteLine",displayName:"Write Line",description:"Write text to standard out.",category:ConsoleActivities.Category,icon:"fas fa-terminal",runtimeDescription:"x => !!x.state.textExpression ? `Write <strong>${ x.state.textExpression.expression }</strong> to standard out.` : x.definition.description",outcomes:[OutcomeNames.Done],properties:[{name:"textExpression",type:"expression",label:"Text",hint:"The text to write."}]})}}ConsoleActivities.Category="Console",pluginStore.add(new ConsoleActivities);class ControlFlowActivities{constructor(){this.getName=()=>"ControlFlowActivities",this.getActivityDefinitions=()=>[this.fork(),this.ifElse(),this.join(),this.switch()],this.fork=()=>({type:"Fork",displayName:"Fork",description:"Fork workflow execution into multiple branches.",category:ControlFlowActivities.Category,icon:"fas fa-code-branch fa-rotate-180",outcomes:"x => x.state.branches",properties:[{name:"branches",type:"slist",label:"Branches",hint:"Enter one or more names representing branches, separated with a space. Example: main overflow other"}]}),this.ifElse=()=>({type:"IfElse",displayName:"If/Else",description:"Evaluate a Boolean expression and continue execution depending on the result.",category:ControlFlowActivities.Category,runtimeDescription:"x => !!x.state.expression ? `Evaluate <strong>${ x.state.expression.expression }</strong> and continue execution depending on the result.` : x.definition.description",outcomes:[OutcomeNames.True,OutcomeNames.False],properties:[{name:"expression",type:"expression",label:"Expression",hint:"The expression to evaluate. The evaluated value will be used to switch on."}]}),this.join=()=>({type:"Join",displayName:"Join",description:"Merge workflow execution back into a single branch.",category:ControlFlowActivities.Category,icon:"fas fa-code-branch",runtimeDescription:"x => !!x.state.joinMode ? `Merge workflow execution back into a single branch using mode <strong>${ x.state.joinMode }</strong>` : x.definition.description",outcomes:[OutcomeNames.Done],properties:[{name:"joinMode",type:"text",label:"Join Mode",hint:"Either 'WaitAll' or 'WaitAny'"}]}),this.switch=()=>({type:"Switch",displayName:"Switch",description:"Switch execution based on a given expression.",category:ControlFlowActivities.Category,icon:"far fa-list-alt",runtimeDescription:"x => !!x.state.expression ? `Switch execution based on <strong>${ x.state.expression.expression }</strong>.` : x.definition.description",outcomes:"x => x.state.cases.map(c => c.toString())",properties:[{name:"expression",type:"expression",label:"Expression",hint:"The expression to evaluate. The evaluated value will be used to switch on."},{name:"cases",type:"list",label:"Cases",hint:"A comma-separated list of possible outcomes of the expression."}]})}}ControlFlowActivities.Category="Control Flow",pluginStore.add(new ControlFlowActivities);class EmailActivities{constructor(){this.getName=()=>"EmailActivities",this.getActivityDefinitions=()=>[this.sendEmail()],this.sendEmail=()=>({type:"SendEmail",displayName:"Send Email",description:"Send an email message.",category:EmailActivities.Category,icon:"far fa-envelope",outcomes:[OutcomeNames.Done],properties:[{name:"from",type:"expression",label:"From",hint:"The sender's email address"},{name:"to",type:"expression",label:"To",hint:"The recipient's email address"},{name:"subject",type:"expression",label:"Subject",hint:"The subject of the email message."},{name:"body",type:"expression",label:"Body",hint:"The body of the email message.",options:{multiline:!0}}]})}}EmailActivities.Category="Email",pluginStore.add(new EmailActivities);class HttpActivities{constructor(){this.getName=()=>"HttpActivities",this.getActivityDefinitions=()=>[this.sendHttpRequest(),this.sendHttpResponse(),this.handleHttpRequest()],this.sendHttpRequest=()=>({type:"HttpRequestAction",displayName:"Send HTTP Request",description:"Send an HTTP request.",category:HttpActivities.Category,icon:"fas fa-cloud",properties:[{name:"url",type:"text",label:"URL",hint:"The URL to send the HTTP request to."},{name:"method",type:"select",label:"Method",hint:"The HTTP method to use when making the request.",options:{items:["GET","POST","PUT","DELETE","OPTIONS","HEAD"]}},{name:"content",type:"expression",label:"Content",hint:"The HTTP content to send along with the request."},{name:"statusCodes",type:"list",label:"Status Codes",hint:"A list of possible HTTP status codes to handle, comma-separated. Example: 200, 400, 404"}],outcomes:"x => !!x.state.statusCodes ? x.state.statusCodes : []"}),this.handleHttpRequest=()=>({type:"HttpRequestEvent",displayName:"Handle HTTP Request",description:"Handle an incoming HTTP request.",category:HttpActivities.Category,icon:"fas fa-cloud",properties:[{name:"path",type:"text",label:"Path",hint:"The relative path that triggers this activity."},{name:"method",type:"select",label:"Method",hint:"The HTTP method that triggers this activity.",options:{items:["GET","POST","PUT","DELETE","OPTIONS","HEAD"]}},{name:"readContent",type:"boolean",label:"Read Content",hint:"Check if the HTTP request content body should be read and stored as part of the HTTP request model. The stored format depends on the content-type header."}],runtimeDescription:"x => !!x.state.path ? `Handle <strong>${ x.state.method } ${ x.state.path }</strong>.` : x.definition.description",outcomes:[OutcomeNames.Done]}),this.sendHttpResponse=()=>({type:"HttpResponseAction",displayName:"Send HTTP Response",description:"Send an HTTP response.",category:HttpActivities.Category,icon:"fas fa-cloud",properties:[{name:"statusCode",type:"select",label:"Status Code",hint:"The HTTP status code to write.",options:{items:[{label:"2xx",options:[200,201,202,203,204]},{label:"3xx",options:[301,302,304,307,308]},{label:"4xx",options:[400,401,402,403,404,405,409,410,412,413,415,417,418,420,428,429]}]}},{name:"content",type:"expression",label:"Content",hint:"The HTTP content to write.",options:{multiline:!0}},{name:"contentType",type:"select",label:"Content Type",hint:"The HTTP content type header to write.",options:{items:["text/plain","text/html","application/json","application/xml"]}},{name:"responseHeaders",type:"expression",label:"Response Headers",hint:"The headers to send along with the response. One 'header: value' pair per line.",options:{multiline:!0}}],runtimeDescription:"x => !!x.state.statusCode ? `Send an HTTP <strong>${ x.state.statusCode }</strong><br/><br/> ${ x.state.contentType }</strong><br/>${ !!x.state.content ? x.state.content.expression ? x.state.content.expression.substr(0,100) + '...' : '' : '' }` : x.definition.description",outcomes:[OutcomeNames.Done]})}}HttpActivities.Category="HTTP",pluginStore.add(new HttpActivities);class MassTransitActivities{constructor(){this.getName=()=>"MassTransitActivities",this.getActivityDefinitions=()=>[this.receiveMassTransitMessage(),this.sendMassTransitMessage()],this.receiveMassTransitMessage=()=>({type:"ReceiveMassTransitMessage",displayName:"Receive MassTransit Message",description:"Receive a message via MassTransit.",category:MassTransitActivities.Category,icon:"fas fa-envelope-open-text",properties:[{name:"messageType",type:"text",label:"Message Type",hint:"The assembly-qualified type name of the message to receive."}],outcomes:[OutcomeNames.Done]}),this.sendMassTransitMessage=()=>({type:"SendMassTransitMessage",displayName:"Send MassTransit Message",description:"Send a message via MassTransit.",category:MassTransitActivities.Category,icon:"fas fa-envelope",properties:[{name:"messageType",type:"text",label:"Message Type",hint:"The assembly-qualified type name of the message to send."},{name:"message",type:"expression",label:"Message",hint:"An expression that evaluates to the message to send."}],outcomes:[OutcomeNames.Done]})}}MassTransitActivities.Category="MassTransit",pluginStore.add(new MassTransitActivities);class PrimitiveActivities{constructor(){this.getName=()=>"PrimitiveActivities",this.getActivityDefinitions=()=>[this.log(),this.setVariable()],this.log=()=>({type:"Log",displayName:"Log",description:"Log a message.",category:PrimitiveActivities.Category,icon:"fas fa-feather-alt",properties:[{name:"message",type:"text",label:"Message",hint:"The text to log."},{name:"logLevel",type:"text",label:"Log Level",hint:"The log level to use."}],runtimeDescription:"x => !!x.state.message ? `Log <strong>${x.state.logLevel}: ${x.state.message}</strong>` : x.definition.description",outcomes:[OutcomeNames.Done]}),this.setVariable=()=>({type:"SetVariable",displayName:"Set Variable",description:"Set a variable on the workflow.",category:PrimitiveActivities.Category,properties:[{name:"variableName",type:"text",label:"Variable Name",hint:"The name of the variable to store the value into."},{name:"expression",type:"expression",label:"Variable Expression",hint:"An expression that evaluates to the value to store in the variable."}],runtimeDescription:"x => !!x.state.variableName ? `${x.state.expression.syntax}: <strong>${x.state.variableName}</strong> = <strong>${x.state.expression.expression}</strong>` : x.definition.description",outcomes:[OutcomeNames.Done]})}}PrimitiveActivities.Category="Primitives",pluginStore.add(new PrimitiveActivities);class TimerActivities{constructor(){this.getName=()=>"TimerActivities",this.getActivityDefinitions=()=>[this.timerEvent()],this.timerEvent=()=>({type:"TimerEvent",displayName:"Timer Event",description:"Triggers after a specified amount of time.",category:TimerActivities.Category,icon:"fas fa-hourglass-start",properties:[{name:"expression",type:"expression",label:"Timeout Expression",hint:"The amount of time to wait before this timer event is triggered. Format: 'd.HH:mm:ss'."},{name:"name",type:"text",label:"Name",hint:"Optionally provide a name for this activity. You can reference named activities from expressions."},{name:"title",type:"text",label:"Title",hint:"Optionally provide a custom title for this activity."},{name:"description",type:"text",label:"Description",hint:"Optionally provide a custom description for this activity."}],runtimeDescription:"x => !!x.state.expression ? `Triggers after <strong>${ x.state.expression.expression }</strong>` : x.definition.description",outcomes:[OutcomeNames.Done]})}}TimerActivities.Category="Timers",pluginStore.add(new TimerActivities);class TaskActivities{constructor(){this.getName=()=>"TaskActivities",this.getActivityDefinitions=()=>[this.noop(),this.addressgeocode(),this.addressvalidate(),this.arrayappend(),this.arrayeach(),this.arraypop(),this.arraypush(),this.arrayshift(),this.arrayunshift(),this.arrayuse(),this.textaddtext(),this.textaddword(),this.textappendparagraph(),this.textadddoclist(),this.textinsertparagraph(),this.textload(),this.texttext(),this.textuse(),this.msgactionadd(),this.msgattachmentadd(),this.msgtoadd(),this.msgactionsclear(),this.msgattachmentsclear(),this.msgtosclear(),this.msgcreate(),this.msgremove(),this.msgsettemplateemail(),this.msgsetfooter(),this.msgsetitem(),this.msgsetmessage(),this.msgsetpost(),this.msgsettemplatesms(),this.msgsetsubject(),this.msguse(),this.send(),this.doclistadd(),this.doclistclear(),this.doclistdelete(),this.doclisteach(),this.doclistobj(),this.doclistremove(),this.docadd(),this.docclear(),this.doccopy(),this.docdelete(),this.docremove(),this.docrename(),this.docsave(),this.mergedoc(),this.python(),this.sendtweet(),this.call(),this.end(),this.switch(),this.objlist(),this.objlistadd(),this.objlistclear(),this.objlistdelete(),this.objlisteach(),this.objlistpick(),this.objlistremove(),this.objadd(),this.objaddlink(),this.objaddparent(),this.objalias(),this.objapply(),this.objcopy(),this.objcreate(),this.objdelete(),this.objdoccopy(),this.objdoclist(),this.objeach(),this.objlu(),this.objorganizer(),this.objpick(),this.objremove(),this.objsave(),this.objset(),this.objtouch(),this.objuse(),this.objloadstore(),this.setlink(),this.setparent(),this.continueon(),this.onerror(),this.pdfone(),this.pdfsplit(),this.queryuse(),this.queryadd(),this.storeclear(),this.storeeach(),this.storeloadchanges(),this.storeloadobject(),this.storeloadstring(),this.storeremove(),this.storeuse(),this.decr(),this.incr(),this.set(),this.ttcontinue(),this.ttfreeze(),this.ttstart(),this.ttstop(),this.trace(),this.traceend(),this.tracesend(),this.uspsvalidate(),this.uspszip(),this.uspscitystate(),this.ftpchangedir(),this.ftpclose(),this.ftpdelete(),this.ftpdownload(),this.ftpdownloadlist(),this.ftpopen(),this.ftpupload(),this.ftpuse(),this.httpcookieget(),this.httpcookieset(),this.httpget(),this.httpuse(),this.workflowend(),this.workflowstart(),this.docpdf(),this.wordpop(),this.wordpush(),this.wordshift(),this.wordunshift()],this.noop=()=>({type:"noop",displayName:"noop,",description:"Does nothing,",category:"Flow",icon:"fas fa-code-branch",outcomes:[OutcomeNames.Done],properties:[]}),this.addressgeocode=()=>({type:"address.geocode",displayName:"address.geocode,",description:"Gets the latitude and longitude of an address,",category:"Address",icon:"fas fa-map-marker-alt",outcomes:[OutcomeNames.Done],properties:[{name:"addr",type:"expression",label:"Addr",hint:"The address field"},{name:"city",type:"expression",label:"City",hint:"The city field"},{name:"state",type:"expression",label:"State",hint:"The state field"},{name:"zip",type:"expression",label:"Zip",hint:"The zip field"},{name:"lat",type:"expression",label:"Lat",hint:"The latitude field"},{name:"long",type:"expression",label:"Long",hint:"The longitude field"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.addressvalidate=()=>({type:"address.validate",displayName:"address.validate,",description:"Validates an address,",category:"Address",icon:"fas fa-map-marker-alt",outcomes:[OutcomeNames.Done],properties:[{name:"addr",type:"expression",label:"Addr",hint:"The address field"},{name:"city",type:"expression",label:"City",hint:"The city field"},{name:"state",type:"expression",label:"State",hint:"The state field"},{name:"zip",type:"expression",label:"Zip",hint:"The zip field"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.arrayappend=()=>({type:"array.append",displayName:"array.append,",description:"Appends word or words from a value,",category:"Array",icon:"fas fa-layer-group",outcomes:[OutcomeNames.Done],properties:[{name:"array",type:"expression",label:"Array",hint:"The name of the array"},{name:"value",type:"expression",label:"Value",hint:"The value"},{name:"split",type:"expression",label:"Split",hint:"If true, the value is broken by spaces"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.arrayeach=()=>({type:"array.each",displayName:"array.each,",description:"Calls a task for each object in the list.  The working object is found at [*l:listobj] and the count is at [*l:listcount],",category:"Array",icon:"fas fa-layer-group",outcomes:[OutcomeNames.Done,OutcomeNames.Call],properties:[{name:"array",type:"expression",label:"Array",hint:"The name of the array"},{name:"field",type:"expression",label:"Field",hint:"The field to use for the current value"},{name:"store",type:"expression",label:"Store",hint:"The store to use for the current value"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.arraypop=()=>({type:"array.pop",displayName:"array.pop,",description:"Pops a store from an array (remove last),",category:"Array",icon:"fas fa-layer-group",outcomes:[OutcomeNames.Done],properties:[{name:"array",type:"expression",label:"Array",hint:"The name of the array"},{name:"store",type:"expression",label:"Store",hint:"The store name"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.arraypush=()=>({type:"array.push",displayName:"array.push,",description:"Pushes a store into an array (add last),",category:"Array",icon:"fas fa-layer-group",outcomes:[OutcomeNames.Done],properties:[{name:"array",type:"expression",label:"Array",hint:"The name of the array"},{name:"store",type:"expression",label:"Store",hint:"The store name"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.arrayshift=()=>({type:"array.shift",displayName:"array.shift,",description:"Shift a store from an array (remove first),",category:"Array",icon:"fas fa-layer-group",outcomes:[OutcomeNames.Done],properties:[{name:"array",type:"expression",label:"Array",hint:"The name of the array"},{name:"store",type:"expression",label:"Store",hint:"The store name"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.arrayunshift=()=>({type:"array.unshift",displayName:"array.unshift,",description:"Unshift a store from an array (add first),",category:"Array",icon:"fas fa-layer-group",outcomes:[OutcomeNames.Done],properties:[{name:"array",type:"expression",label:"Array",hint:"The name of the array"},{name:"store",type:"expression",label:"Store",hint:"The store name"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.arrayuse=()=>({type:"array.use",displayName:"array.use,",description:"Sets the default array,",category:"Array",icon:"fas fa-layer-group",outcomes:[OutcomeNames.Done],properties:[{name:"array",type:"expression",label:"Array",hint:"The name of the array"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.textaddtext=()=>({type:"text.add.text",displayName:"text.add.text,",description:"Adds text to a text line,",category:"Text",icon:"fas fa-paragraph",outcomes:[OutcomeNames.Done],properties:[{name:"text",type:"expression",label:"Text",hint:"The text name"},{name:"value",type:"expression",label:"Value",hint:"The text"},{name:"line",type:"expression",label:"Line",hint:"The row"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.textaddword=()=>({type:"text.add.word",displayName:"text.add.word,",description:"Adds text to a text line,",category:"Text",icon:"fas fa-paragraph",outcomes:[OutcomeNames.Done],properties:[{name:"text",type:"expression",label:"Text",hint:"The text name"},{name:"value",type:"expression",label:"Value",hint:"The text"},{name:"line",type:"expression",label:"Line",hint:"The row"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.textappendparagraph=()=>({type:"text.append.paragraph",displayName:"text.append.paragraph,",description:"Appends a new word to a text,",category:"Text",icon:"fas fa-paragraph",outcomes:[OutcomeNames.Done],properties:[{name:"text",type:"expression",label:"Text",hint:"The text name"},{name:"value",type:"expression",label:"Value",hint:"The text"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.textadddoclist=()=>({type:"text.add.doclist",displayName:"text.add.doclist,",description:"Appends a block of doc names to a memo,",category:"Text",icon:"fas fa-paragraph",outcomes:[OutcomeNames.Done],properties:[{name:"text",type:"expression",label:"Text",hint:"The text name"},{name:"list",type:"expression",label:"List",hint:"The list"},{name:"line",type:"expression",label:"Line",hint:"The row"},{name:"delim",type:"expression",label:"Delim",hint:"The delimiter"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.textinsertparagraph=()=>({type:"text.insert.paragraph",displayName:"text.insert.paragraph,",description:"Inserts a new paragraph to a text,",category:"Text",icon:"fas fa-paragraph",outcomes:[OutcomeNames.Done],properties:[{name:"text",type:"expression",label:"Text",hint:"The text name"},{name:"value",type:"expression",label:"Value",hint:"The text"},{name:"line",type:"expression",label:"Line",hint:"The row to insert before"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.textload=()=>({type:"text.load",displayName:"text.load,",description:"Copies a value into a text area,",category:"Text",icon:"fas fa-paragraph",outcomes:[OutcomeNames.Done],properties:[{name:"text",type:"expression",label:"Text",hint:"The text name"},{name:"value",type:"expression",label:"Value",hint:"The value"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.texttext=()=>({type:"text.text",displayName:"text.text,",description:"Copies text into a field,",category:"Text",icon:"fas fa-paragraph",outcomes:[OutcomeNames.Done],properties:[{name:"text",type:"expression",label:"Text",hint:"The text name"},{name:"field",type:"expression",label:"Field",hint:"The field"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.textuse=()=>({type:"text.use",displayName:"text.use,",description:"Sets the default text,",category:"Text",icon:"fas fa-paragraph",outcomes:[OutcomeNames.Done],properties:[{name:"text",type:"expression",label:"Text",hint:"The text name"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgactionadd=()=>({type:"msg.action.add",displayName:"msg.action.add,",description:"Adds an action to the message,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to use"},{name:"task",type:"expression",label:"Task",hint:"The task"},{name:"name",type:"expression",label:"Name",hint:"The name to display"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgattachmentadd=()=>({type:"msg.attachment.add",displayName:"msg.attachment.add,",description:"Adds an attachment to the message,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to use"},{name:"doc",type:"expression",label:"Doc",hint:"The document"},{name:"name",type:"expression",label:"Name",hint:"The name to display"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgtoadd=()=>({type:"msg.to.add",displayName:"msg.to.add,",description:"Adds an addressee to the message,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to use"},{name:"to",type:"expression",label:"To",hint:"The to"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgactionsclear=()=>({type:"msg.actions.clear",displayName:"msg.actions.clear,",description:"Removes all actions from the message,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to use"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgattachmentsclear=()=>({type:"msg.attachments.clear",displayName:"msg.attachments.clear,",description:"Removes all attachments from the message,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to use"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgtosclear=()=>({type:"msg.tos.clear",displayName:"msg.tos.clear,",description:"Removes all tos from the message,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to use"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgcreate=()=>({type:"msg.create",displayName:"msg.create,",description:"Creates a message in the stack,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to remove"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgremove=()=>({type:"msg.remove",displayName:"msg.remove,",description:"Removes the message from the stack,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to remove"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgsettemplateemail=()=>({type:"msg.set.template.email",displayName:"msg.set.template.email,",description:"Sets the message EMail template,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to use"},{name:"value",type:"expression",label:"Value",hint:"The template"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgsetfooter=()=>({type:"msg.set.footer",displayName:"msg.set.footer,",description:"Sets the message footer text,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to use"},{name:"value",type:"expression",label:"Value",hint:"The footer text"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgsetitem=()=>({type:"msg.set.item",displayName:"msg.set.item,",description:"Sets the message item text,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to use"},{name:"item",type:"expression",label:"Item",hint:"The  item"},{name:"value",type:"expression",label:"Value",hint:"The  text"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgsetmessage=()=>({type:"msg.set.message",displayName:"msg.set.message,",description:"Sets the message text,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to use"},{name:"value",type:"expression",label:"Value",hint:"The body text"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgsetpost=()=>({type:"msg.set.post",displayName:"msg.set.post,",description:"Sets the message post text,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to use"},{name:"value",type:"expression",label:"Value",hint:"The post text"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgsettemplatesms=()=>({type:"msg.set.template.sms",displayName:"msg.set.template.sms,",description:"Sets the message SMS template,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to use"},{name:"value",type:"expression",label:"Value",hint:"The template"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msgsetsubject=()=>({type:"msg.set.subject",displayName:"msg.set.subject,",description:"Sets the message subject,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to use"},{name:"value",type:"expression",label:"Value",hint:"The subject"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.msguse=()=>({type:"msg.use",displayName:"msg.use,",description:"Sets the default message,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to use"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.send=()=>({type:"send",displayName:"send,",description:"Sends a message,",category:"Comm",icon:"fas fa-tty",outcomes:[OutcomeNames.Done],properties:[{name:"msg",type:"expression",label:"Msg",hint:"The message to be sent"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.doclistadd=()=>({type:"doc.list.add",displayName:"doc.list.add,",description:"Adds a document to the list,",category:"Document List",icon:"fas fa-folder",outcomes:[OutcomeNames.Done],properties:[{name:"doc",type:"expression",label:"Doc",hint:"The document name to add"},{name:"list",type:"expression",label:"List",hint:"The list"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.doclistclear=()=>({type:"doc.list.clear",displayName:"doc.list.clear,",description:"Empties a list,",category:"Document List",icon:"fas fa-folder",outcomes:[OutcomeNames.Done],properties:[{name:"list",type:"expression",label:"List",hint:"The list to be emptied"},{name:"remove",type:"expression",label:"Remove",hint:"Remove documents"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.doclistdelete=()=>({type:"doc.list.delete",displayName:"doc.list.delete,",description:"Deletes all the documents in list,",category:"Document List",icon:"fas fa-folder",outcomes:[OutcomeNames.Done],properties:[{name:"list",type:"expression",label:"List",hint:"The list"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.doclisteach=()=>({type:"doc.list.each",displayName:"doc.list.each,",description:"Calls code for each document in the list,",category:"Document List",icon:"fas fa-folder",outcomes:[OutcomeNames.Done,OutcomeNames.OnError,OutcomeNames.Call],properties:[{name:"list",type:"expression",label:"List",hint:"The list"},{name:"doc",type:"expression",label:"Doc",hint:"The field to put the document name"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.doclistobj=()=>({type:"doc.list.obj",displayName:"doc.list.obj,",description:"Creates a document list from an objects folder,",category:"Document List",icon:"fas fa-folder",outcomes:[OutcomeNames.Done],properties:[{name:"list",type:"expression",label:"List",hint:"The list"},{name:"obj",type:"expression",label:"Obj",hint:"The source object"},{name:"folder",type:"expression",label:"Folder",hint:"The folder"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.doclistremove=()=>({type:"doc.list.remove",displayName:"doc.list.remove,",description:"Removes a document from the list,",category:"Document List",icon:"fas fa-folder",outcomes:[OutcomeNames.Done],properties:[{name:"doc",type:"expression",label:"Doc",hint:"The document name to remove"},{name:"list",type:"expression",label:"List",hint:"The list"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.docadd=()=>({type:"doc.add",displayName:"doc.add,",description:"Adds a document to the working set,",category:"Document",icon:"fas fa-file",outcomes:[OutcomeNames.Done],properties:[{name:"name",type:"expression",label:"Name",hint:"The name to be used"},{name:"obj",type:"expression",label:"Obj",hint:"The name of the object which is the parent"},{name:"path",type:"expression",label:"Path",hint:"The path of the document"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.docclear=()=>({type:"doc.clear",displayName:"doc.clear,",description:"Clears all documents,",category:"Document",icon:"fas fa-file",outcomes:[OutcomeNames.Done],properties:[{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.doccopy=()=>({type:"doc.copy",displayName:"doc.copy,",description:"Copies a document,",category:"Document",icon:"fas fa-file",outcomes:[OutcomeNames.Done],properties:[{name:"from",type:"expression",label:"From",hint:"The source document name"},{name:"to",type:"expression",label:"To",hint:"The target document name"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.docdelete=()=>({type:"doc.delete",displayName:"doc.delete,",description:"Removes a document from the list and deletes it from storage,",category:"Document",icon:"fas fa-file",outcomes:[OutcomeNames.Done],properties:[{name:"doc",type:"expression",label:"Doc",hint:"The name of the document to be deleted"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.docremove=()=>({type:"doc.remove",displayName:"doc.remove,",description:"Removes a document from the list,",category:"Document",icon:"fas fa-file",outcomes:[OutcomeNames.Done],properties:[{name:"doc",type:"expression",label:"Doc",hint:"The document to be removed"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.docrename=()=>({type:"doc.rename",displayName:"doc.rename,",description:"Renames a document,",category:"Document",icon:"fas fa-file",outcomes:[OutcomeNames.Done],properties:[{name:"from",type:"expression",label:"From",hint:"The source document name"},{name:"as",type:"expression",label:"As",hint:"The target document physical name"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.docsave=()=>({type:"doc.save",displayName:"doc.save,",description:"Saves a document,",category:"Document",icon:"fas fa-file",outcomes:[OutcomeNames.Done],properties:[{name:"doc",type:"expression",label:"Doc",hint:"The name of the document to be saved"},{name:"text",type:"expression",label:"Text",hint:"The text"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.mergedoc=()=>({type:"merge.doc",displayName:"merge.doc,",description:"Merges a .DOCX or .PDF file with values from the context,",category:"Document",icon:"fas fa-file",outcomes:[OutcomeNames.Done],properties:[{name:"doc",type:"expression",label:"Doc",hint:"The document to be merged"},{name:"to",type:"expression",label:"To",hint:"The merged PDF document"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.python=()=>({type:"python",displayName:"python,",description:"Runs a python script,",category:"External",icon:"fas fa-concierge-bell",outcomes:[OutcomeNames.Done],properties:[{name:"code",type:"expression",label:"Code",hint:"Document that holds the python script.  Entry point should have two args, env - the workign environment and args - the parameters passed"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.sendtweet=()=>({type:"send.tweet",displayName:"send.tweet,",description:"Sends a tweet,",category:"External",icon:"fas fa-concierge-bell",outcomes:[OutcomeNames.Done],properties:[{name:"consumerKey",type:"expression",label:"ConsumerKey",hint:"Your consumer key from Twitter"},{name:"consumerSecret",type:"expression",label:"ConsumerSecret",hint:"Your secret key from Twitter"},{name:"accessToken",type:"expression",label:"AccessToken",hint:"Your access token from Twitter"},{name:"accessTokenSecret",type:"expression",label:"AccessTokenSecret",hint:"Your access token secret from Twitter"},{name:"msg",type:"expression",label:"Msg",hint:"The message to be tweeted"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.call=()=>({type:"call",displayName:"call,",description:"Calls a task, returning to calling task on exit,",category:"Flow",icon:"fas fa-code-branch",outcomes:[OutcomeNames.Done],properties:[{name:"task",type:"expression",label:"Task",hint:"The task to be called"},{name:"store",type:"expression",label:"Store",hint:"Store to pass as passed"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.end=()=>({type:"end",displayName:"end,",description:"Ends a task,",category:"Flow",icon:"fas fa-code-branch",outcomes:[OutcomeNames.Done],properties:[{name:"store",type:"expression",label:"Store",hint:"Store to return"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.switch=()=>({type:"switch",displayName:"switch,",description:"Switch execution based on a given expression,",runtimeDescription:"x => !!x.state.expression ? `Switch execution based on <strong>${ x.state.expression.expression }</strong>.` : x.definition.description",category:"Flow",icon:"fas fa-code-branch",outcomes:"x => x.state.cases",properties:[{name:"expression",type:"expression",label:"Expression",hint:"The expression to evaluate. The evaluated value will be used to switch on"},{name:"cases",type:"list",label:"Cases",hint:"A comma-separated list of possible outcomes of the expression"}]}),this.objlist=()=>({type:"obj.list",displayName:"obj.list,",description:"Creates a list of objects using a query,",category:"Object List",icon:"fas fa-object-group",outcomes:[OutcomeNames.Done],properties:[{name:"list",type:"expression",label:"List",hint:"The list"},{name:"ds",type:"expression",label:"Ds",hint:"The dataset of the object"},{name:"query",type:"expression",label:"Query",hint:"The store that is the query"},{name:"sortby",type:"expression",label:"Sortby",hint:"Sort by"},{name:"limit",type:"expression",label:"Limit",hint:"Max number of objects to return"},{name:"skip",type:"expression",label:"Skip",hint:"Number of objects to skip"},{name:"dir",type:"expression",label:"Dir",hint:"Direction of sort (asc/desc)"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objlistadd=()=>({type:"obj.list.add",displayName:"obj.list.add,",description:"Adds an object to the list,",category:"Object List",icon:"fas fa-object-group",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The object name to add"},{name:"list",type:"expression",label:"List",hint:"The list"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objlistclear=()=>({type:"obj.list.clear",displayName:"obj.list.clear,",description:"Empties a list,",category:"Object List",icon:"fas fa-object-group",outcomes:[OutcomeNames.Done],properties:[{name:"list",type:"expression",label:"List",hint:"The list to be emptied"},{name:"remove",type:"expression",label:"Remove",hint:"Remove objects"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objlistdelete=()=>({type:"obj.list.delete",displayName:"obj.list.delete,",description:"Deletes all objects in the list,",category:"Object List",icon:"fas fa-object-group",outcomes:[OutcomeNames.Done],properties:[{name:"list",type:"expression",label:"List",hint:"The list"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objlisteach=()=>({type:"obj.list.each",displayName:"obj.list.each,",description:"Calls a chore for each object in the list.  The working object is found at [*l:listobj] and the count is at [*l:listcount],",category:"Object List",icon:"fas fa-object-group",outcomes:[OutcomeNames.Done,OutcomeNames.OnError,OutcomeNames.Call],properties:[{name:"list",type:"expression",label:"List",hint:"The list"},{name:"obj",type:"expression",label:"Obj",hint:"The object name to use inside the chore"},{name:"store",type:"expression",label:"Store",hint:"Store to pass as passed"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objlistpick=()=>({type:"obj.list.pick",displayName:"obj.list.pick,",description:"Creates an object list using a query,",category:"Object List",icon:"fas fa-object-group",outcomes:[OutcomeNames.Done],properties:[{name:"list",type:"expression",label:"List",hint:"The name of the list"},{name:"ds",type:"expression",label:"Ds",hint:"The dataset of the object"},{name:"query",type:"expression",label:"Query",hint:"The store that is the query"},{name:"sortby",type:"expression",label:"Sortby",hint:"Sort by"},{name:"limit",type:"expression",label:"Limit",hint:"Max number of objects to return"},{name:"skip",type:"expression",label:"Skip",hint:"Number of objects to skip"},{name:"dir",type:"expression",label:"Dir",hint:"Direction of sort (asc/desc)"},{name:"merge",type:"expression",label:"Merge",hint:"True if lists are merged"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objlistremove=()=>({type:"obj.list.remove",displayName:"obj.list.remove,",description:"Removes an object from the list,",category:"Object List",icon:"fas fa-object-group",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The object name to remove"},{name:"list",type:"expression",label:"List",hint:"The list"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objadd=()=>({type:"obj.add",displayName:"obj.add,",description:"Adds an object to the working stack,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"ds",type:"expression",label:"Ds",hint:"The dataset of the object"},{name:"id",type:"expression",label:"Id",hint:"The id of the object"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objaddlink=()=>({type:"obj.add.link",displayName:"obj.add.link,",description:"Adds a link of an object to the working stack,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"field",type:"expression",label:"Field",hint:"The link field"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objaddparent=()=>({type:"obj.add.parent",displayName:"obj.add.parent,",description:"Adds the parent of an object to the working stack,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"from",type:"expression",label:"From",hint:"The name of the source object"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objalias=()=>({type:"obj.alias",displayName:"obj.alias,",description:"Aliases an object to the working stack,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"from",type:"expression",label:"From",hint:"The curent object name"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objapply=()=>({type:"obj.apply",displayName:"obj.apply,",description:"Applies a store to an object,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"store",type:"expression",label:"Store",hint:"The source object"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objcopy=()=>({type:"obj.copy",displayName:"obj.copy,",description:"Copies one object to another,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the source object"},{name:"to",type:"expression",label:"To",hint:"The name of the target object"},{name:"flds",type:"expression",label:"Flds",hint:"Fields to include"},{name:"excl",type:"expression",label:"Excl",hint:"Fields to exclude"},{name:"ext",type:"expression",label:"Ext",hint:"Copy extensions"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objcreate=()=>({type:"obj.create",displayName:"obj.create,",description:"Creates a new working object,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"ds",type:"expression",label:"Ds",hint:"The dataset of the object"},{name:"store",type:"expression",label:"Store",hint:"The store holding the values"},{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"parent",type:"expression",label:"Parent",hint:"The name of the parent object"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objdelete=()=>({type:"obj.delete",displayName:"obj.delete,",description:"Deletes the object from the database and from the working set,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objdoccopy=()=>({type:"obj.doc.copy",displayName:"obj.doc.copy,",description:"Copies all documents from an object,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The object to use"},{name:"to",type:"expression",label:"To",hint:"The target object"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objdoclist=()=>({type:"obj.doc.list",displayName:"obj.doc.list,",description:"Creates a document list from an object,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The object to use"},{name:"list",type:"expression",label:"List",hint:"The list"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objeach=()=>({type:"obj.each",displayName:"obj.each,",description:"Call code for each object in a query,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done,OutcomeNames.OnError,OutcomeNames.Call],properties:[{name:"list",type:"expression",label:"List",hint:"The list"},{name:"ds",type:"expression",label:"Ds",hint:"The dataset of the object"},{name:"query",type:"expression",label:"Query",hint:"The store that is the query"},{name:"sortby",type:"expression",label:"Sortby",hint:"Sort by"},{name:"limit",type:"expression",label:"Limit",hint:"Max number of objects to return"},{name:"skip",type:"expression",label:"Skip",hint:"Number of objects to skip"},{name:"dir",type:"expression",label:"Dir",hint:"Direction of sort (asc/desc)"},{name:"as",type:"expression",label:"As",hint:"The name of the passed object"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objlu=()=>({type:"obj.lu",displayName:"obj.lu,",description:"Carries out lookup on a field,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"field",type:"expression",label:"Field",hint:"The field"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objorganizer=()=>({type:"obj.organizer",displayName:"obj.organizer,",description:"Creates an organizer for the object,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The object to use"},{name:"options",type:"expression",label:"Options",hint:"The dataset options"},{name:"doc",type:"expression",label:"Doc",hint:"The document"},{name:"folder",type:"expression",label:"Folder",hint:"The folder"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objpick=()=>({type:"obj.pick",displayName:"obj.pick,",description:"Gets or creates an object using a query,",category:"Object List",icon:"fas fa-object-group",outcomes:[OutcomeNames.Done],properties:[{name:"name",type:"expression",label:"Name",hint:"The name of the object"},{name:"ds",type:"expression",label:"Ds",hint:"The dataset of the object"},{name:"query",type:"expression",label:"Query",hint:"The store that is the query"},{name:"sortby",type:"expression",label:"Sortby",hint:"Sort by"},{name:"limit",type:"expression",label:"Limit",hint:"Max number of objects to return"},{name:"skip",type:"expression",label:"Skip",hint:"Number of objects to skip"},{name:"dir",type:"expression",label:"Dir",hint:"Direction of sort (asc/desc)"},{name:"store",type:"expression",label:"Store",hint:"The store holding the values"},{name:"parent",type:"expression",label:"Parent",hint:"The name of the parent object"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objremove=()=>({type:"obj.remove",displayName:"obj.remove,",description:"Removes the object from working set,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objsave=()=>({type:"obj.save",displayName:"obj.save,",description:"Saves the working object,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"tasks",type:"expression",label:"Tasks",hint:"If true (non zero) allow tasks, otherwise disallow"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objset=()=>({type:"obj.set",displayName:"obj.set,",description:"Sets a value in a field of an object,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"field",type:"expression",label:"Field",hint:"The field to set"},{name:"value",type:"expression",label:"Value",hint:"The value"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objtouch=()=>({type:"obj.touch",displayName:"obj.touch,",description:"Flags the field as changed,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The object to use"},{name:"field",type:"expression",label:"Field",hint:"The field"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objuse=()=>({type:"obj.use",displayName:"obj.use,",description:"Sets the default object,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The object to use"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.objloadstore=()=>({type:"obj.load.store",displayName:"obj.load.store,",description:"Copies a store into an object,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"store",type:"expression",label:"Store",hint:"The store to use"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.setlink=()=>({type:"set.link",displayName:"set.link,",description:"Sets a link to an object,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"field",type:"expression",label:"Field",hint:"The field"},{name:"link",type:"expression",label:"Link",hint:"The linked object"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.setparent=()=>({type:"set.parent",displayName:"set.parent,",description:"Sets the parent of an object,",category:"Object",icon:"fas fa-vector-square",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"link",type:"expression",label:"Link",hint:"The linked object"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.continueon=()=>({type:"continue.on",displayName:"continue.on,",description:"Continues an an on.xxx call,",category:"Flow",icon:"fas fa-code-branch",outcomes:[],properties:[{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.onerror=()=>({type:"on.error",displayName:"on.error,",description:"Sets the default process to handle errors,",category:"Flow",icon:"fas fa-code-branch",outcomes:[OutcomeNames.Done,OutcomeNames.OnError],properties:[{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.pdfone=()=>({type:"pdf.one",displayName:"pdf.one,",description:"Merges multiple .PDF files into one,",category:"PDF",icon:"fas fa-file-pdf",outcomes:[OutcomeNames.Done],properties:[{name:"doclist",type:"expression",label:"Doclist",hint:"The document list to be merged"},{name:"to",type:"expression",label:"To",hint:"The merged document"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.pdfsplit=()=>({type:"pdf.split",displayName:"pdf.split,",description:"Splits one .PDF file into multiple by page count,",category:"PDF",icon:"fas fa-file-pdf",outcomes:[OutcomeNames.Done],properties:[{name:"doc",type:"expression",label:"Doc",hint:"The document to be split"},{name:"pages",type:"expression",label:"Pages",hint:"The page count (<0 if skip, * if pages left over)"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.queryuse=()=>({type:"query.use",displayName:"query.use,",description:"Sets the default query,",category:"Query",icon:"fas fa-question",outcomes:[OutcomeNames.Done],properties:[{name:"query",type:"expression",label:"Query",hint:"The query to use"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.queryadd=()=>({type:"query.add",displayName:"query.add,",description:"Sets a query expression,",category:"Query",icon:"fas fa-question",outcomes:[OutcomeNames.Done],properties:[{name:"query",type:"expression",label:"Query",hint:"The query"},{name:"field",type:"expression",label:"Field",hint:"The field"},{name:"op",type:"expression",label:"Op",hint:"The operation"},{name:"value",type:"expression",label:"Value",hint:"The value"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.storeclear=()=>({type:"store.clear",displayName:"store.clear,",description:"Clears all values in the store,",category:"Store",icon:"fas fa-database",outcomes:[OutcomeNames.Done],properties:[{name:"store",type:"expression",label:"Store",hint:"The store to clear"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.storeeach=()=>({type:"store.each",displayName:"store.each,",description:"Calls code, passing an element of the array,",category:"Store",icon:"fas fa-database",outcomes:[OutcomeNames.Done,OutcomeNames.OnError,OutcomeNames.Call],properties:[{name:"store",type:"expression",label:"Store",hint:"Store to use"},{name:"field",type:"expression",label:"Field",hint:"Field in to use to pass name"},{name:"value",type:"expression",label:"Value",hint:"Field in to use to pass value"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.storeloadchanges=()=>({type:"store.load.changes",displayName:"store.load.changes,",description:"Loads a store from changes in object,",category:"Store",icon:"fas fa-database",outcomes:[OutcomeNames.Done],properties:[{name:"store",type:"expression",label:"Store",hint:"The store to load"},{name:"obj",type:"expression",label:"Obj",hint:"The object"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.storeloadobject=()=>({type:"store.load.object",displayName:"store.load.object,",description:"Loads a store from object,",category:"Store",icon:"fas fa-database",outcomes:[OutcomeNames.Done],properties:[{name:"store",type:"expression",label:"Store",hint:"The store to load"},{name:"obj",type:"expression",label:"Obj",hint:"The object"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.storeloadstring=()=>({type:"store.load.string",displayName:"store.load.string,",description:"Loads a store from a string,",category:"Store",icon:"fas fa-database",outcomes:[OutcomeNames.Done],properties:[{name:"store",type:"expression",label:"Store",hint:"The store to load"},{name:"value",type:"expression",label:"Value",hint:"The value"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.storeremove=()=>({type:"store.remove",displayName:"store.remove,",description:"Removes the store from the stack,",category:"Store",icon:"fas fa-database",outcomes:[OutcomeNames.Done],properties:[{name:"store",type:"expression",label:"Store",hint:"The store to remove"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.storeuse=()=>({type:"store.use",displayName:"store.use,",description:"Sets the default store,",category:"Store",icon:"fas fa-database",outcomes:[OutcomeNames.Done],properties:[{name:"store",type:"expression",label:"Store",hint:"The store to use"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.decr=()=>({type:"decr",displayName:"decr,",description:"Decrements a field,",category:"Ops",icon:"fas fa-plus-square",outcomes:[OutcomeNames.Done],properties:[{name:"field",type:"expression",label:"Field",hint:"The field"},{name:"value",type:"expression",label:"Value",hint:"The value to decrement by"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.incr=()=>({type:"incr",displayName:"incr,",description:"Increments a field,",category:"Ops",icon:"fas fa-plus-square",outcomes:[OutcomeNames.Done],properties:[{name:"field",type:"expression",label:"Field",hint:"The field"},{name:"value",type:"expression",label:"Value",hint:"The value to increment by"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.set=()=>({type:"set",displayName:"set,",description:"Sets a value,",category:"Ops",icon:"fas fa-plus-square",outcomes:[OutcomeNames.Done],properties:[{name:"field",type:"expression",label:"Field",hint:"The field"},{name:"value",type:"expression",label:"Value",hint:"The value"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.ttcontinue=()=>({type:"tt.continue",displayName:"tt.continue,",description:"Continues time tracking,",category:"Time Track",icon:"fas fa-clock",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"type",type:"expression",label:"Type",hint:"The type of tag"},{name:"user",type:"expression",label:"User",hint:"The user"},{name:"reason",type:"expression",label:"Reason",hint:"The reason of the freeze"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.ttfreeze=()=>({type:"tt.freeze",displayName:"tt.freeze,",description:"Freezes time tracking,",category:"Time Track",icon:"fas fa-clock",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"type",type:"expression",label:"Type",hint:"The type of tag"},{name:"user",type:"expression",label:"User",hint:"The user"},{name:"reason",type:"expression",label:"Reason",hint:"The reason of the freeze"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.ttstart=()=>({type:"tt.start",displayName:"tt.start,",description:"Starts time tracking,",category:"Time Track",icon:"fas fa-clock",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"type",type:"expression",label:"Type",hint:"The type of tag"},{name:"user",type:"expression",label:"User",hint:"The user"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.ttstop=()=>({type:"tt.stop",displayName:"tt.stop,",description:"Stops time tracking,",category:"Time Track",icon:"fas fa-clock",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"type",type:"expression",label:"Type",hint:"The type of tag"},{name:"user",type:"expression",label:"User",hint:"The user"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.trace=()=>({type:"trace",displayName:"trace,",description:"Starts the trace mode,",category:"Trace",icon:"fas fa-search",outcomes:[OutcomeNames.Done],properties:[{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.traceend=()=>({type:"trace.end",displayName:"trace.end,",description:"Ends the trace mode,",category:"Trace",icon:"fas fa-search",outcomes:[OutcomeNames.Done],properties:[{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.tracesend=()=>({type:"trace.send",displayName:"trace.send,",description:"Sends the trace,",category:"Trace",icon:"fas fa-search",outcomes:[OutcomeNames.Done],properties:[{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.uspsvalidate=()=>({type:"usps.validate",displayName:"usps.validate,",description:"Validates an address,",category:"USPS",icon:"fas fa-envelope",outcomes:[OutcomeNames.Done],properties:[{name:"address",type:"expression",label:"Address",hint:"The address"},{name:"city",type:"expression",label:"City",hint:"The city"},{name:"state",type:"expression",label:"State",hint:"The state"},{name:"zip",type:"expression",label:"Zip",hint:"The zip"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.uspszip=()=>({type:"usps.zip",displayName:"usps.zip,",description:"Returns the ZIP for an address,",category:"USPS",icon:"fas fa-envelope",outcomes:[OutcomeNames.Done],properties:[{name:"city",type:"expression",label:"City",hint:"The city"},{name:"state",type:"expression",label:"State",hint:"The state"},{name:"zip",type:"expression",label:"Zip",hint:"The zip"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.uspscitystate=()=>({type:"usps.citystate",displayName:"usps.citystate,",description:"Returns the city and state for an address,",category:"USPS",icon:"fas fa-envelope",outcomes:[OutcomeNames.Done],properties:[{name:"address",type:"expression",label:"Address",hint:"The address"},{name:"city",type:"expression",label:"City",hint:"The city"},{name:"state",type:"expression",label:"State",hint:"The state"},{name:"zip",type:"expression",label:"Zip",hint:"The zip"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.ftpchangedir=()=>({type:"ftp.changedir",displayName:"ftp.changedir,",description:"Changes the current directory,",category:"FTP",icon:"fas fa-server",outcomes:[OutcomeNames.Done],properties:[{name:"conn",type:"expression",label:"Conn",hint:"The connection to use"},{name:"dir",type:"expression",label:"Dir",hint:"The directory name"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.ftpclose=()=>({type:"ftp.close",displayName:"ftp.close,",description:"Closes the sftp connection,",category:"FTP",icon:"fas fa-server",outcomes:[OutcomeNames.Done],properties:[{name:"conn",type:"expression",label:"Conn",hint:"The connection to use"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.ftpdelete=()=>({type:"ftp.delete",displayName:"ftp.delete,",description:"Deletes a file from the server,",category:"FTP",icon:"fas fa-server",outcomes:[OutcomeNames.Done],properties:[{name:"conn",type:"expression",label:"Conn",hint:"The connection to use"},{name:"file",type:"expression",label:"File",hint:"The file name at the server"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.ftpdownload=()=>({type:"ftp.download",displayName:"ftp.download,",description:"Downloads a file from the server,",category:"FTP",icon:"fas fa-server",outcomes:[OutcomeNames.Done],properties:[{name:"conn",type:"expression",label:"Conn",hint:"The connection to use"},{name:"file",type:"expression",label:"File",hint:"The file name at the server"},{name:"doc",type:"expression",label:"Doc",hint:"The document name"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.ftpdownloadlist=()=>({type:"ftp.download.list",displayName:"ftp.download.list,",description:"Downloads a set of files from the server,",category:"FTP",icon:"fas fa-server",outcomes:[OutcomeNames.Done],properties:[{name:"conn",type:"expression",label:"Conn",hint:"The connection to use"},{name:"list",type:"expression",label:"List",hint:"The list to store the files"},{name:"obj",type:"expression",label:"Obj",hint:"The object to store the files under"},{name:"folder",type:"expression",label:"Folder",hint:"The folder"},{name:"del",type:"expression",label:"Del",hint:"If true, delete when downloaded"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.ftpopen=()=>({type:"ftp.open",displayName:"ftp.open,",description:"Opens an sftp connection,",category:"FTP",icon:"fas fa-server",outcomes:[OutcomeNames.Done],properties:[{name:"conn",type:"expression",label:"Conn",hint:"The connection to use"},{name:"url",type:"expression",label:"Url",hint:"The URl to connect to"},{name:"port",type:"expression",label:"Port",hint:"The port"},{name:"user",type:"expression",label:"User",hint:"The user name"},{name:"pwd",type:"expression",label:"Pwd",hint:"The user password"},{name:"sftp",type:"expression",label:"Sftp",hint:"True if SFTP"},{name:"cert",type:"expression",label:"Cert",hint:"The SSH certificate if SFTP (from system wallet)"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.ftpupload=()=>({type:"ftp.upload",displayName:"ftp.upload,",description:"Uploads a file to the server,",category:"FTP",icon:"fas fa-server",outcomes:[OutcomeNames.Done],properties:[{name:"conn",type:"expression",label:"Conn",hint:"The connection to use"},{name:"file",type:"expression",label:"File",hint:"The file name at the server"},{name:"doc",type:"expression",label:"Doc",hint:"The document name"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.ftpuse=()=>({type:"ftp.use",displayName:"ftp.use,",description:"Sets the default sftp connection,",category:"FTP",icon:"fas fa-server",outcomes:[OutcomeNames.Done],properties:[{name:"conn",type:"expression",label:"Conn",hint:"The connection to use"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.httpcookieget=()=>({type:"http.cookie.get",displayName:"http.cookie.get,",description:"Closes the sftp connection,",category:"HTTP",icon:"fas fa-desktop",outcomes:[OutcomeNames.Done],properties:[{name:"conn",type:"expression",label:"Conn",hint:"The connection to use"},{name:"domain",type:"expression",label:"Domain",hint:"The domain"},{name:"key",type:"expression",label:"Key",hint:"The key"},{name:"to",type:"expression",label:"To",hint:"The location of the value"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.httpcookieset=()=>({type:"http.cookie.set",displayName:"http.cookie.set,",description:"Sets a cookie value in the connection,",category:"HTTP",icon:"fas fa-desktop",outcomes:[OutcomeNames.Done],properties:[{name:"conn",type:"expression",label:"Conn",hint:"The connection to use"},{name:"domain",type:"expression",label:"Domain",hint:"The domain"},{name:"key",type:"expression",label:"Key",hint:"The key"},{name:"value",type:"expression",label:"Value",hint:"The value"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.httpget=()=>({type:"http.get",displayName:"http.get,",description:"Does an HTTP Get,",category:"HTTP",icon:"fas fa-desktop",outcomes:[OutcomeNames.Done],properties:[{name:"conn",type:"expression",label:"Conn",hint:"The connection to use"},{name:"url",type:"expression",label:"Url",hint:"The URL"},{name:"storeout",type:"expression",label:"Storeout",hint:"The store to use as parameters"},{name:"storein",type:"expression",label:"Storein",hint:"The store to use as return"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.httpuse=()=>({type:"http.use",displayName:"http.use,",description:"Sets the default http connection,",category:"HTTP",icon:"fas fa-desktop",outcomes:[OutcomeNames.Done],properties:[{name:"conn",type:"expression",label:"Conn",hint:"The connection to use"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.workflowend=()=>({type:"workflow.end",displayName:"workflow.end,",description:"Ends a workflow on a given object,",category:"Workflow",icon:"fas fa-network-wired",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"wf",type:"expression",label:"Wf",hint:"The workflow to start"},{name:"name",type:"expression",label:"Name",hint:"The user defined name"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.workflowstart=()=>({type:"workflow.start",displayName:"workflow.start,",description:"Starts a workflow on a given object,",category:"Workflow",icon:"fas fa-network-wired",outcomes:[OutcomeNames.Done],properties:[{name:"obj",type:"expression",label:"Obj",hint:"The name of the object"},{name:"wf",type:"expression",label:"Wf",hint:"The workflow to start"},{name:"name",type:"text",label:"Name",hint:"The user defined name"},{name:"store",type:"expression",label:"Store",hint:"The store to pass"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.docpdf=()=>({type:"doc.pdf",displayName:"doc.pdf,",description:"Converts to PDF,",category:"Document",icon:"fas fa-file",outcomes:[OutcomeNames.Done],properties:[{name:"doc",type:"expression",label:"Doc",hint:"The document to be merged"},{name:"to",type:"expression",label:"To",hint:"The PDF document"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.wordpop=()=>({type:"word.pop",displayName:"word.pop,",description:"Remove word from end of string,",category:"Word",icon:"fas fa-keyboard",outcomes:[OutcomeNames.Done],properties:[{name:"string",type:"expression",label:"String",hint:"The string"},{name:"value",type:"expression",label:"Value",hint:"The text"},{name:"delim",type:"expression",label:"Delim",hint:"The delimiter"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.wordpush=()=>({type:"word.push",displayName:"word.push,",description:"Adds text to end of string,",category:"Word",icon:"fas fa-keyboard",outcomes:[OutcomeNames.Done],properties:[{name:"string",type:"expression",label:"String",hint:"The string"},{name:"value",type:"expression",label:"Value",hint:"The text"},{name:"delim",type:"expression",label:"Delim",hint:"The delimiter"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.wordshift=()=>({type:"word.shift",displayName:"word.shift,",description:"Remove text from front of string,",category:"Word",icon:"fas fa-keyboard",outcomes:[OutcomeNames.Done],properties:[{name:"string",type:"expression",label:"String",hint:"The string"},{name:"value",type:"expression",label:"Value",hint:"The text"},{name:"delim",type:"expression",label:"Delim",hint:"The delimiter"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.wordunshift=()=>({type:"word.unshift",displayName:"word.unshift,",description:"Adds text to front of string,",category:"Word",icon:"fas fa-keyboard",outcomes:[OutcomeNames.Done],properties:[{name:"string",type:"expression",label:"String",hint:"The string"},{name:"value",type:"expression",label:"Value",hint:"The text"},{name:"delim",type:"expression",label:"Delim",hint:"The delimiter"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]})}}TaskActivities.Category="Activity",pluginStore.add(new TaskActivities);class WorkflowActivities{constructor(){this.getName=()=>"WorkflowActivities",this.getActivityDefinitions=()=>[this.call(),this.delay(),this.end(),this.fork(),this.ifelse(),this.join(),this.switch(),this.task(),this.continueon(),this.onerror(),this.onoverdue(),this.do(),this.storeuse(),this.set()],this.call=()=>({type:"call",displayName:"call,",description:"Starts a workflow,",runtimeDescription:"x => !!x.state.workflow ? `Starts <strong>${ x.state.workflow.expression }</strong>` : x.definition.description",category:"Action",icon:"fas fa-dot-circle",outcomes:[OutcomeNames.Done,OutcomeNames.OnError],properties:[{name:"workflow",type:"expression",label:"Workflow",hint:"The workflow to start"},{name:"name",type:"text",label:"Name",hint:"The user defined name"},{name:"store",type:"expression",label:"Store",hint:"The store to pass"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.delay=()=>({type:"delay",displayName:"delay,",description:"Delays for a specified duration,",runtimeDescription:"x => !!x.state.duration ? `Delay for <strong>${ x.state.duration.expression }</strong>` : x.definition.description",category:"Action",icon:"fas fa-dot-circle",outcomes:[OutcomeNames.Done],properties:[{name:"duration",type:"expression",label:"Duration",hint:"The duration length"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.end=()=>({type:"end",displayName:"end,",description:"Ends the workflow,",category:"Flow",icon:"fas fa-code-branch",outcomes:[],properties:[{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.fork=()=>({type:"fork",displayName:"fork,",description:"Fork workflow execution into multiple branches,",category:"Flow",icon:"fas fa-code-branch",outcomes:"x => x.state.branches",properties:[{name:"branches",type:"list",label:"Branches",hint:"A comma-separated list of names representing branches"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.ifelse=()=>({type:"ifelse",displayName:"ifelse,",description:"Evaluate a Boolean expression and continue execution depending on the result,",runtimeDescription:"x => !!x.state.expression ? `Evaluate <strong>${ x.state.expression.expression }</strong> and continue execution depending on the result.` : x.definition.description",category:"Flow",icon:"fas fa-code-branch",outcomes:[OutcomeNames.True,OutcomeNames.False],properties:[{name:"expression",type:"expression",label:"Expression",hint:"The expression to evaluate. The evaluated value will be used to switch on"}]}),this.join=()=>({type:"join",displayName:"join,",description:"Merge workflow execution back into a single branch,",runtimeDescription:"x => !!x.state.joinMode ? `Merge workflow execution back into a single branch using mode <strong>${ x.state.joinMode }</strong>` : x.definition.description",category:"Flow",icon:"fas fa-code-branch",outcomes:[OutcomeNames.Done],properties:[{name:"joinMode",type:"select",label:"JoinMode",options:{items:["WaitAll","WaitAny"]},hint:"Either wait for all or any"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.switch=()=>({type:"switch",displayName:"switch,",description:"Switch execution based on a given expression,",runtimeDescription:"x => !!x.state.expression ? `Switch execution based on <strong>${ x.state.expression.expression }</strong>.` : x.definition.description",category:"Flow",icon:"fas fa-code-branch",outcomes:"x => x.state.cases",properties:[{name:"expression",type:"expression",label:"Expression",hint:"The expression to evaluate. The evaluated value will be used to switch on"},{name:"cases",type:"list",label:"Cases",hint:"A comma-separated list of possible outcomes of the expression"}]}),this.task=()=>({type:"task",displayName:"task,",description:"Calls a task,",runtimeDescription:"x => !!x.state.task ? `Calls <strong>${ x.state.task.expression }</strong>` : x.definition.description",category:"Action",icon:"fas fa-dot-circle",outcomes:[OutcomeNames.Done],properties:[{name:"task",type:"expression",label:"Task",hint:"The task to call"},{name:"store",type:"expression",label:"Store",hint:"The store to pass"},{name:"return",type:"expression",label:"Return",hint:"The store to use for the return"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.continueon=()=>({type:"continue.on",displayName:"continue.on,",description:"Continues an an on.xxx call,",category:"Flow",icon:"fas fa-code-branch",outcomes:[],properties:[{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.onerror=()=>({type:"on.error",displayName:"on.error,",description:"Sets the default process to handle errors,",category:"Flow",icon:"fas fa-code-branch",outcomes:[OutcomeNames.Done,OutcomeNames.OnError],properties:[{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.onoverdue=()=>({type:"on.overdue",displayName:"on.overdue,",description:"Sets the default process to handle overdues,",category:"Flow",icon:"fas fa-code-branch",outcomes:[OutcomeNames.Done,OutcomeNames.OnOverdue],properties:[{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.do=()=>({type:"do",displayName:"do,",description:"Creates activity,",runtimeDescription:"x => !!x.state.subject ? `<strong>${ x.state.subject }</strong>` : x.definition.description",category:"Action",icon:"fas fa-dot-circle",outcomes:[OutcomeNames.Done,OutcomeNames.Fail,OutcomeNames.OnOverdue,OutcomeNames.OnError],properties:[{name:"subject",type:"expression",label:"Subject",hint:"The subject line"},{name:"message",type:"expression",label:"Message",hint:"The message line"},{name:"assignedTo",type:"expression",label:"AssignedTo",hint:"The group to whom the activity is assigned to"},{name:"duration",type:"expression",label:"Duration",hint:"The duration length"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.storeuse=()=>({type:"store.use",displayName:"store.use,",description:"Sets the default store,",category:"Store",icon:"fas fa-database",outcomes:[OutcomeNames.Done],properties:[{name:"store",type:"expression",label:"Store",hint:"The store to use"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]}),this.set=()=>({type:"set",displayName:"set,",description:"Sets a value,",category:"Ops",icon:"fas fa-plus-square",outcomes:[OutcomeNames.Done],properties:[{name:"field",type:"expression",label:"Field",hint:"The field"},{name:"value",type:"expression",label:"Value",hint:"The value"},{name:"if",type:"expression",label:"If",hint:"Execute if"},{name:"comment",type:"text",label:"Comment",hint:"What does this step accomplish"}]})}}WorkflowActivities.Category="Activity",pluginStore.add(new WorkflowActivities);class DesignerHost{constructor(t){registerInstance(this,t),this.activityDefinitions=[],this.loadActivityDefinitions=()=>{const t=(this.pluginsData||"").split(/[ ,]+/).map(t=>t.trim());return pluginStore.list().filter(e=>t.indexOf(e.getName())>-1).filter(t=>!!t.getActivityDefinitions).map(t=>t.getActivityDefinitions()).reduce((t,e)=>t.concat(e),[])},this.onWorkflowChanged=t=>{this.workflowChanged.emit(t.detail)},this.initActivityDefinitions=()=>{if(this.activityDefinitions=this.loadActivityDefinitions(),this.activityDefinitionsData){const t=JSON.parse(this.activityDefinitionsData);this.activityDefinitions=[...this.activityDefinitions,...t]}},this.initFieldDrivers=()=>{DisplayManager$1.addDriver("text",new TextFieldDriver),DisplayManager$1.addDriver("expression",new ExpressionFieldDriver),DisplayManager$1.addDriver("list",new ListFieldDriver),DisplayManager$1.addDriver("boolean",new BooleanFieldDriver),DisplayManager$1.addDriver("select",new SelectFieldDriver)},this.initWorkflow=()=>{if(this.workflowData){const t=JSON.parse(this.workflowData);t.activities||(t.activities=[]),t.connections||(t.connections=[]),this.designer.workflow=t}},this.workflowChanged=createEvent(this,"workflowChanged",7)}async newWorkflow(){await this.designer.newWorkflow()}async getWorkflow(){return await this.designer.getWorkflow()}async showActivityPicker(){await this.activityPicker.show()}async export(t){await this.importExport.export(this.designer,t)}async import(){await this.importExport.import()}async onActivityPicked(t){await this.designer.addActivity(t.detail)}async onEditActivity(t){this.activityEditor.activity=t.detail,this.activityEditor.show=!0}async onAddActivity(){await this.showActivityPicker()}async onUpdateActivity(t){await this.designer.updateActivity(t.detail)}async onExportWorkflow(t){this.importExport&&await this.importExport.export(this.designer,t.detail)}async onImportWorkflow(t){this.designer.workflow=deepClone(t.detail)}componentWillLoad(){this.initActivityDefinitions(),this.initFieldDrivers()}componentDidLoad(){this.initWorkflow()}render(){const t=this.activityDefinitions;return h("host",null,h("wf-activity-picker",{activityDefinitions:t,ref:t=>this.activityPicker=t}),h("wf-activity-editor",{activityDefinitions:t,ref:t=>this.activityEditor=t}),h("wf-import-export",{ref:t=>this.importExport=t}),h("div",{class:"workflow-designer-wrapper dragscroll"},h("wf-designer",{activityDefinitions:t,ref:t=>this.designer=t,canvasHeight:this.canvasHeight,workflow:this.workflow,readonly:this.readonly,onWorkflowChanged:this.onWorkflowChanged})))}get el(){return getElement(this)}static get style(){return".workflow-designer-wrapper{height:80vh;overflow-y:auto}"}}class ExportButton{constructor(t){registerInstance(this,t),this.workflowFormats={json:{format:"json",fileExtension:".json",mimeType:"application/json",displayName:"JSON"},yaml:{format:"yaml",fileExtension:".yaml",mimeType:"application/x-yaml",displayName:"YAML"},xml:{format:"xml",fileExtension:".xml",mimeType:"application/xml",displayName:"XML"},object:{format:"object",fileExtension:".bin",mimeType:"application/binary",displayName:"Binary"}},this.getWorkflowHost=()=>this.designerHostId?document.querySelector(`#${this.designerHostId}`):null,this.handleExportClick=async(t,e)=>{t.preventDefault(),this.exportClickedEvent.emit(e);const i=this.getWorkflowHost();i&&await i.export(e)},this.exportClickedEvent=createEvent(this,"export",7)}render(){const t=this.workflowFormats;return h("div",{class:"dropdown"},h("button",{class:"btn btn-secondary dropdown-toggle",type:"button",id:"exportButton","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"Export"),h("div",{class:"dropdown-menu","aria-labelledby":"exportButton"},Object.keys(t).map(e=>{const i=t[e];return h("a",{class:"dropdown-item",href:"#",onClick:t=>this.handleExportClick(t,i)},i.displayName)})))}get el(){return getElement(this)}}var remedial=createCommonjsModule(function(t){!function(){var e,i,n=Function("return this")(),s="Boolean Number String Function Array Date RegExp Object".split(" "),o={};for(e in s)s.hasOwnProperty(e)&&(o["[object "+(i=s[e])+"]"]=i.toLowerCase());function r(t){return null==t?String(t):o[Object.prototype.toString.call(t)]||"object"}function a(t){var e,i;if("object"===r(t))for(e in t)if(void 0!==(i=t[e])&&"function"!==r(i))return!1;return!0}String.prototype.entityify||(String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}),String.prototype.quote||(String.prototype.quote=function(){var t,e,i=this.length,n='"';for(e=0;e<i;e+=1)if((t=this.charAt(e))>=" ")"\\"!==t&&'"'!==t||(n+="\\"),n+=t;else switch(t){case"\b":n+="\\b";break;case"\f":n+="\\f";break;case"\n":n+="\\n";break;case"\r":n+="\\r";break;case"\t":n+="\\t";break;default:t=t.charCodeAt(),n+="\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16)}return n+'"'}),String.prototype.supplant||(String.prototype.supplant=function(t){return this.replace(/{([^{}]*)}/g,function(e,i){var n=t[i];return"string"==typeof n||"number"==typeof n?n:e})}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s*(\S*(?:\s+\S+)*)\s*$/,"$1")}),t.exports={typeOf:r,isEmpty:a},n.typeOf=n.typeOf||r,n.isEmpty=n.isEmpty||a}()}),json2yaml=createCommonjsModule(function(t){var e;e=remedial.typeOf,t.exports.stringify=function(t){var i,n="";return"---"+(i={undefined:function(){return"null"},null:function(){return"null"},number:function(t){return t},boolean:function(t){return t?"true":"false"},string:function(t){return JSON.stringify(t)},array:function(t){var s="";return 0===t.length?s+="[]":(n=n.replace(/$/,"  "),t.forEach(function(t){var o=i[e(t)];if(!o)throw new Error("what the crap: "+e(t));s+="\n"+n+"- "+o(t)}),n=n.replace(/  /,""),s)},object:function(t){var s="";return 0===Object.keys(t).length?s+="{}":(n=n.replace(/$/,"  "),Object.keys(t).forEach(function(o){var r=t[o],a=i[e(r)];if(void 0!==r){if(!a)throw new Error("what the crap: "+e(r));s+="\n"+n+o+": "+a(r)}}),n=n.replace(/  /,""),s)},function:function(){return"[object Function]"}})[e(t)](t)+"\n"}});class ImportExport{constructor(t){registerInstance(this,t),this.importWorkflow=()=>{const t=this.fileInput.files[0],e=new FileReader;e.onload=async()=>{const t={data:e.result,format:"json"};await this.import(t)},e.readAsText(t)},this.serialize=(t,e)=>{switch(e){case"json":return JSON.stringify(t);case"yaml":return json2yaml.stringify(t);case"xml":return JSON.stringify(t);default:return t}},this.importEvent=createEvent(this,"import-workflow",7)}async export(t,e){let i=this.blobUrl;return i&&window.URL.revokeObjectURL(i),this.serialize(t.workflow,e.format)}async download(t,e){let i=this.blobUrl;i&&window.URL.revokeObjectURL(i);const n=this.serialize(t.workflow,e.format),s=new Blob([n],{type:e.mimeType});this.blobUrl=i=window.URL.createObjectURL(s);const o=document.createElement("a");o.setAttribute("href",i),o.setAttribute("download",`workflow.${e.fileExtension}`),document.body.appendChild(o),o.click(),document.body.removeChild(o)}async import(t){if(t){const e=JSON.parse(t.data);this.importEvent.emit(e)}else this.fileInput.click()}render(){return h("host",null,h("input",{type:"file",class:"import-button",onChange:this.importWorkflow,ref:t=>this.fileInput=t}))}get el(){return getElement(this)}static get style(){return".import-button{display:none}"}}export{ActivityEditor as wf_activity_editor,ActivityPicker as wf_activity_picker,ActivityRenderer as wf_activity_renderer,ContextMenu as wf_context_menu,ContextMenuItem as wf_context_menu_item,Designer as wf_designer,DesignerHost as wf_designer_host,ExportButton as wf_export_button,ImportExport as wf_import_export};